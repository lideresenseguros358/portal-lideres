-- =====================================================
-- BULK UPLOAD COMISIONES - Primera Quincena Nov 2025
-- Generado: 2025-11-21T04:02:35.803Z
-- Total comisiones: 692
-- =====================================================

BEGIN;

-- =====================================================
-- 1. CREAR QUINCENA CERRADA (Primera quincena Nov 2025)
-- =====================================================

INSERT INTO fortnights (period_start, period_end, status, notify_brokers, created_at)
VALUES ('2025-11-01', '2025-11-15', 'PAID', false, NOW())
RETURNING id;

-- Guardar el ID en una variable (debes reemplazar 'FORTNIGHT_ID_AQUI' con el ID real)
-- O usar: WITH fortnight_created AS (INSERT INTO fortnights ... RETURNING id)

DO $$
DECLARE
  v_fortnight_id UUID;
  v_import_id UUID;
  v_client_id UUID;
  v_policy_id UUID;
  v_broker_id UUID;
  v_insurer_id UUID;
  v_percentage NUMERIC;
  v_net_amount NUMERIC;
  v_is_vida_assa BOOLEAN;
BEGIN

  -- Obtener ID de quincena recién creada
  SELECT id INTO v_fortnight_id 
  FROM fortnights 
  WHERE period_start = '2025-11-01' AND period_end = '2025-11-15' 
  ORDER BY created_at DESC 
  LIMIT 1;

  RAISE NOTICE 'Quincena ID: %', v_fortnight_id;

  -- =====================================================
  -- 2. CREAR COMM_IMPORT (agrupado por primera aseguradora)
  -- =====================================================
  
  -- Buscar primera aseguradora válida del CSV
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  INSERT INTO comm_imports (period_label, insurer_id, total_amount, is_life_insurance, created_at)
  VALUES (v_fortnight_id, v_insurer_id, 7747.32, false, NOW())
  RETURNING id INTO v_import_id;

  RAISE NOTICE 'Import ID: %', v_import_id;


  -- =====================================================
  -- FILA 1/692: 12B34565 - ALEXIS CONCEPCION ALVEO GONZALEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 2)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'amariar23@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'ACCIDENTES PERSONALES' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 22.7 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '12B34565'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-06-02', start_date),
      renewal_date = COALESCE('2026-06-02', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 12B34565';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ALEXIS CONCEPCION ALVEO GONZALEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '12B34565', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-06-02', '2026-06-02', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 12B34565';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '12B34565', 
    'ALEXIS CONCEPCION ALVEO GONZALEZ', 
    v_insurer_id, 
    v_broker_id,
    22.7,
    jsonb_build_object(
      'policy_type', 'ACCIDENTES PERSONALES',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'amariar23@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 2/692: 14B57241 - CARLOS ALCIBIADES GUERRA CASTILLO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 3)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'amariar23@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 3.3 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B57241'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-10-03', start_date),
      renewal_date = COALESCE('2026-10-03', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B57241';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CARLOS ALCIBIADES GUERRA CASTILLO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B57241', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-10-03', '2026-10-03', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B57241';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B57241', 
    'CARLOS ALCIBIADES GUERRA CASTILLO', 
    v_insurer_id, 
    v_broker_id,
    3.3,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'amariar23@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 3/692: 06-55-1317797-2 - MONTALVO VILLEGAS RIASCO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 4)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'amariar23@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.37 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '06-55-1317797-2'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-02-09', start_date),
      renewal_date = COALESCE('2026-02-09', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 06-55-1317797-2';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MONTALVO VILLEGAS RIASCO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '06-55-1317797-2', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-02-09', '2026-02-09', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 06-55-1317797-2';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '06-55-1317797-2', 
    'MONTALVO VILLEGAS RIASCO', 
    v_insurer_id, 
    v_broker_id,
    11.37,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'amariar23@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 4/692: 04-08-1407523-2 - YAMILETH BETZAIDA PINEDA RODRIGUEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 5)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'amariar23@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10.75 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-08-1407523-2'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-31', start_date),
      renewal_date = COALESCE('2026-07-31', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-08-1407523-2';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('YAMILETH BETZAIDA PINEDA RODRIGUEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-08-1407523-2', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-31', '2026-07-31', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-08-1407523-2';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-08-1407523-2', 
    'YAMILETH BETZAIDA PINEDA RODRIGUEZ', 
    v_insurer_id, 
    v_broker_id,
    10.75,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'amariar23@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 5/692: 04-08-1407523-2 - YAMILETH BETZAIDA PINEDA RODRIGUEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 6)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'amariar23@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 1.89 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-08-1407523-2'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-31', start_date),
      renewal_date = COALESCE('2026-07-31', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-08-1407523-2';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('YAMILETH BETZAIDA PINEDA RODRIGUEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-08-1407523-2', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-31', '2026-07-31', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-08-1407523-2';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-08-1407523-2', 
    'YAMILETH BETZAIDA PINEDA RODRIGUEZ', 
    v_insurer_id, 
    v_broker_id,
    1.89,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'amariar23@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 6/692: 04-04-1160993-3 - DANIEL CEFERINO SAMANIEGO CASTILLO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 7)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'amariar23@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 7.78 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-1160993-3'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-03-08', start_date),
      renewal_date = COALESCE('2026-03-08', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-1160993-3';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('DANIEL CEFERINO SAMANIEGO CASTILLO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-1160993-3', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-03-08', '2026-03-08', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-1160993-3';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-1160993-3', 
    'DANIEL CEFERINO SAMANIEGO CASTILLO', 
    v_insurer_id, 
    v_broker_id,
    7.78,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'amariar23@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 7/692: 04-04-2023935-0 - PAULA CRISTINA CUBILLA SANCHEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 8)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'amariar23@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.35 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-2023935-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-30', start_date),
      renewal_date = COALESCE('2026-09-30', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-2023935-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('PAULA CRISTINA CUBILLA SANCHEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-2023935-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-30', '2026-09-30', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-2023935-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-2023935-0', 
    'PAULA CRISTINA CUBILLA SANCHEZ', 
    v_insurer_id, 
    v_broker_id,
    11.35,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'amariar23@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 8/692: 04-55-1818370-0 - MONTALVO VILLEGAS RIASCO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 9)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'amariar23@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 45.35 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-55-1818370-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-02-09', start_date),
      renewal_date = COALESCE('2026-02-09', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-55-1818370-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MONTALVO VILLEGAS RIASCO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-55-1818370-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-02-09', '2026-02-09', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-55-1818370-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-55-1818370-0', 
    'MONTALVO VILLEGAS RIASCO', 
    v_insurer_id, 
    v_broker_id,
    45.35,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'amariar23@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 9/692: 12-30-2623 - CARLOS ALCIBIADES GUERRA CASTILLO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 10)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'amariar23@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 76.57 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '12-30-2623'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 12-30-2623';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CARLOS ALCIBIADES GUERRA CASTILLO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '12-30-2623', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 12-30-2623';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '12-30-2623', 
    'CARLOS ALCIBIADES GUERRA CASTILLO', 
    v_insurer_id, 
    v_broker_id,
    76.57,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'amariar23@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 10/692: 03030543343 - GREGORIO MARIN PEREIRA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 11)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'amariar23@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 4.44 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '03030543343'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 03030543343';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('GREGORIO MARIN PEREIRA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '03030543343', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 03030543343';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '03030543343', 
    'GREGORIO MARIN PEREIRA', 
    v_insurer_id, 
    v_broker_id,
    4.44,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'amariar23@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 11/692: 02-83-0844695-4 - JENELLE MARIN
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 12)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'amariar23@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.7 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-83-0844695-4'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-83-0844695-4';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JENELLE MARIN', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-83-0844695-4', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-83-0844695-4';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-83-0844695-4', 
    'JENELLE MARIN', 
    v_insurer_id, 
    v_broker_id,
    11.7,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'amariar23@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 12/692: 0124-05459-01 - CAROLINA HYPATIA CASTILLO CORREA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 13)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'asermusa@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 33.75 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0124-05459-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0124-05459-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CAROLINA HYPATIA CASTILLO CORREA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0124-05459-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0124-05459-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0124-05459-01', 
    'CAROLINA HYPATIA CASTILLO CORREA', 
    v_insurer_id, 
    v_broker_id,
    33.75,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'asermusa@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 13/692: 04-04-1265222-3 - JUAN CALEB DE GRACIA BORJA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 14)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'asurimnafis86@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 59.81 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-1265222-3'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-14', start_date),
      renewal_date = COALESCE('2026-11-14', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-1265222-3';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JUAN CALEB DE GRACIA BORJA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-1265222-3', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-14', '2026-11-14', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-1265222-3';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-1265222-3', 
    'JUAN CALEB DE GRACIA BORJA', 
    v_insurer_id, 
    v_broker_id,
    59.81,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'asurimnafis86@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 14/692: 04-04-1917996-0 - MIGUEL ANGEL GONDOLA VELAZCO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 15)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'asurimnafis86@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.42 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-1917996-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-05-08', start_date),
      renewal_date = COALESCE('2026-05-08', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-1917996-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MIGUEL ANGEL GONDOLA VELAZCO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-1917996-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-05-08', '2026-05-08', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-1917996-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-1917996-0', 
    'MIGUEL ANGEL GONDOLA VELAZCO', 
    v_insurer_id, 
    v_broker_id,
    11.42,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'asurimnafis86@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 15/692: 04-04-933535-5 - MARIO DE GRACIA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 16)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'asurimnafis86@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.68 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-933535-5'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-23', start_date),
      renewal_date = COALESCE('2026-07-23', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-933535-5';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MARIO DE GRACIA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-933535-5', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-23', '2026-07-23', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-933535-5';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-933535-5', 
    'MARIO DE GRACIA', 
    v_insurer_id, 
    v_broker_id,
    8.68,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'asurimnafis86@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 16/692: 13785 - BROWN BROWN JOSHUA ALEXAN
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'VIVIR' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: VIVIR (fila 17)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'asurimnafis86@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('VIVIR' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 12.1 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '13785'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 13785';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('BROWN BROWN JOSHUA ALEXAN', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '13785', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 13785';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '13785', 
    'BROWN BROWN JOSHUA ALEXAN', 
    v_insurer_id, 
    v_broker_id,
    12.1,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'asurimnafis86@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 17/692: 02B251359 - CARMEN ISELLE RIOS OSORIO DE VON CHONG
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 18)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'carlosfoot777@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 7.95 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B251359'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-01', start_date),
      renewal_date = COALESCE('2026-11-01', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B251359';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CARMEN ISELLE RIOS OSORIO DE VON CHONG', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B251359', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-01', '2026-11-01', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B251359';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B251359', 
    'CARMEN ISELLE RIOS OSORIO DE VON CHONG', 
    v_insurer_id, 
    v_broker_id,
    7.95,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'carlosfoot777@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 18/692: 02B3404041 - EDUARDO ALEXIS LOPEZ HURTADO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 19)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'carlosfoot777@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10.27 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3404041'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-02-07', start_date),
      renewal_date = COALESCE('2026-02-07', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3404041';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('EDUARDO ALEXIS LOPEZ HURTADO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3404041', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-02-07', '2026-02-07', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3404041';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3404041', 
    'EDUARDO ALEXIS LOPEZ HURTADO', 
    v_insurer_id, 
    v_broker_id,
    10.27,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'carlosfoot777@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 19/692: 03B55621 - ISBETH LISBETH QUIEL MURCIA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 20)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'carlosfoot777@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 1.94 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '03B55621'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-11', start_date),
      renewal_date = COALESCE('2026-07-11', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 03B55621';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ISBETH LISBETH QUIEL MURCIA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '03B55621', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-11', '2026-07-11', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 03B55621';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '03B55621', 
    'ISBETH LISBETH QUIEL MURCIA', 
    v_insurer_id, 
    v_broker_id,
    1.94,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'carlosfoot777@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 20/692: 03B67303 - ALVARO AURELIO ARCIA NU�EZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 21)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'carlosfoot777@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 2.72 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '03B67303'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-03-07', start_date),
      renewal_date = COALESCE('2026-03-07', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 03B67303';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ALVARO AURELIO ARCIA NU�EZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '03B67303', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-03-07', '2026-03-07', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 03B67303';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '03B67303', 
    'ALVARO AURELIO ARCIA NU�EZ', 
    v_insurer_id, 
    v_broker_id,
    2.72,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'carlosfoot777@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 21/692: 03B59103 - YANITHZEL YARELIS JIMENEZ DE BARRANTES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 22)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'carlosfoot777@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 1.31 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '03B59103'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-06-10', start_date),
      renewal_date = COALESCE('2026-06-10', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 03B59103';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('YANITHZEL YARELIS JIMENEZ DE BARRANTES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '03B59103', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-06-10', '2026-06-10', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 03B59103';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '03B59103', 
    'YANITHZEL YARELIS JIMENEZ DE BARRANTES', 
    v_insurer_id, 
    v_broker_id,
    1.31,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'carlosfoot777@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 22/692: 02B3396507 - MATEO PATI�O MARTINEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 23)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'carlosfoot777@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10.5 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3396507'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2024-11-08', start_date),
      renewal_date = COALESCE('2025-11-08', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3396507';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MATEO PATI�O MARTINEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3396507', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2024-11-08', '2025-11-08', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3396507';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3396507', 
    'MATEO PATI�O MARTINEZ', 
    v_insurer_id, 
    v_broker_id,
    10.5,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'carlosfoot777@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 23/692: 0220-00124-02 - NAYARI NARCISA ARANGO RIOS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 24)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'carlosfoot777@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 6.86 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0220-00124-02'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0220-00124-02';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('NAYARI NARCISA ARANGO RIOS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0220-00124-02', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0220-00124-02';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0220-00124-02', 
    'NAYARI NARCISA ARANGO RIOS', 
    v_insurer_id, 
    v_broker_id,
    6.86,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'carlosfoot777@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 24/692: 0222-03475-09 - ARNOLD KENNETH LOPEZ MONTERO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 25)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'carlosfoot777@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.13 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0222-03475-09'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0222-03475-09';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ARNOLD KENNETH LOPEZ MONTERO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0222-03475-09', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0222-03475-09';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0222-03475-09', 
    'ARNOLD KENNETH LOPEZ MONTERO', 
    v_insurer_id, 
    v_broker_id,
    11.13,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'carlosfoot777@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 25/692: 0223-00439-01 - ALBECIO  PORRAS LLIBRE
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 26)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'carlosfoot777@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 16.28 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0223-00439-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0223-00439-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ALBECIO  PORRAS LLIBRE', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0223-00439-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0223-00439-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0223-00439-01', 
    'ALBECIO  PORRAS LLIBRE', 
    v_insurer_id, 
    v_broker_id,
    16.28,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'carlosfoot777@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 26/692: 0225-00146-02 - GIUSEPPE OLONIGUIBILER VILLALAZ ARIAS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 27)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'carlosfoot777@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 40.22 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0225-00146-02'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0225-00146-02';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('GIUSEPPE OLONIGUIBILER VILLALAZ ARIAS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0225-00146-02', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0225-00146-02';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0225-00146-02', 
    'GIUSEPPE OLONIGUIBILER VILLALAZ ARIAS', 
    v_insurer_id, 
    v_broker_id,
    40.22,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'carlosfoot777@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 27/692: 0224-05203-09 - ANGEL RAUL GALLARDO SOTO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 28)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'carlosfoot777@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 12.26 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0224-05203-09'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0224-05203-09';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ANGEL RAUL GALLARDO SOTO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0224-05203-09', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0224-05203-09';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0224-05203-09', 
    'ANGEL RAUL GALLARDO SOTO', 
    v_insurer_id, 
    v_broker_id,
    12.26,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'carlosfoot777@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 28/692: 0223-03885-09 - TAHIREH BEATRIZ SODY RODRIGUEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 29)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'carlosfoot777@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10.68 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0223-03885-09'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0223-03885-09';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('TAHIREH BEATRIZ SODY RODRIGUEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0223-03885-09', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0223-03885-09';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0223-03885-09', 
    'TAHIREH BEATRIZ SODY RODRIGUEZ', 
    v_insurer_id, 
    v_broker_id,
    10.68,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'carlosfoot777@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 29/692: 9-30-33637 - LIZ ISODELINA HERNANDEZ NAVAS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 30)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'carlosfoot777@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 29.65 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '9-30-33637'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 9-30-33637';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('LIZ ISODELINA HERNANDEZ NAVAS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '9-30-33637', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 9-30-33637';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '9-30-33637', 
    'LIZ ISODELINA HERNANDEZ NAVAS', 
    v_insurer_id, 
    v_broker_id,
    29.65,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'carlosfoot777@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 30/692: 9-30-33637 - LIZ ISODELINA HERNANDEZ NAVAS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 31)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'carlosfoot777@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.13 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '9-30-33637'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 9-30-33637';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('LIZ ISODELINA HERNANDEZ NAVAS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '9-30-33637', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 9-30-33637';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '9-30-33637', 
    'LIZ ISODELINA HERNANDEZ NAVAS', 
    v_insurer_id, 
    v_broker_id,
    0.13,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'carlosfoot777@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 31/692: 9-30-35756 - YIRA MARISEL FERNANDEZ BROWN
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 32)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'carlosfoot777@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 33.27 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '9-30-35756'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 9-30-35756';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('YIRA MARISEL FERNANDEZ BROWN', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '9-30-35756', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 9-30-35756';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '9-30-35756', 
    'YIRA MARISEL FERNANDEZ BROWN', 
    v_insurer_id, 
    v_broker_id,
    33.27,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'carlosfoot777@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 32/692: 22035 - CARPIO CARDENA DARISNEL
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'VIVIR' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: VIVIR (fila 33)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'coraliaseguros@yahoo.es' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('VIVIR' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.06 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '22035'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 22035';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CARPIO CARDENA DARISNEL', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '22035', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 22035';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '22035', 
    'CARPIO CARDENA DARISNEL', 
    v_insurer_id, 
    v_broker_id,
    11.06,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'coraliaseguros@yahoo.es'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 33/692: 22033 - CARPIO CARDENA DARISNEL
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'VIVIR' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: VIVIR (fila 34)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'coraliaseguros@yahoo.es' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('VIVIR' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 12.6 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '22033'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 22033';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CARPIO CARDENA DARISNEL', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '22033', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 22033';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '22033', 
    'CARPIO CARDENA DARISNEL', 
    v_insurer_id, 
    v_broker_id,
    12.6,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'coraliaseguros@yahoo.es'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 34/692: 03B98519 - GISELA LORENA COHEN SAAVEDRA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 35)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'dicsaa72@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 3.56 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '03B98519'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-03', start_date),
      renewal_date = COALESCE('2026-09-03', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 03B98519';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('GISELA LORENA COHEN SAAVEDRA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '03B98519', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-03', '2026-09-03', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 03B98519';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '03B98519', 
    'GISELA LORENA COHEN SAAVEDRA', 
    v_insurer_id, 
    v_broker_id,
    3.56,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'dicsaa72@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 35/692: 15B100771 - GISELA LORENA COHEN SAAVEDRA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 36)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'dicsaa72@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 2.14 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '15B100771'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-10', start_date),
      renewal_date = COALESCE('2026-09-10', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 15B100771';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('GISELA LORENA COHEN SAAVEDRA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '15B100771', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-10', '2026-09-10', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 15B100771';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '15B100771', 
    'GISELA LORENA COHEN SAAVEDRA', 
    v_insurer_id, 
    v_broker_id,
    2.14,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'dicsaa72@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 36/692: 1-16-62110 - MARICARMEN ANGUIZOLA BERBEY
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 37)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'dicsaa72@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 4.73 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-62110'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-62110';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MARICARMEN ANGUIZOLA BERBEY', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-62110', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-62110';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-62110', 
    'MARICARMEN ANGUIZOLA BERBEY', 
    v_insurer_id, 
    v_broker_id,
    4.73,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'dicsaa72@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 37/692: 22514 - MANDICHE BELUCHE VANESSA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'VIVIR' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: VIVIR (fila 38)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'dicsaa72@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('VIVIR' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 4.69 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '22514'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 22514';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MANDICHE BELUCHE VANESSA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '22514', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 22514';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '22514', 
    'MANDICHE BELUCHE VANESSA', 
    v_insurer_id, 
    v_broker_id,
    4.69,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'dicsaa72@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 38/692: 1020 - "SUPREMA SAFETY
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'S.A."' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: S.A." (fila 39)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'vivir' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('S.A."' = 'ASSA' AND 'SEGUROSCONTABLESDAC@GMAIL.COM' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1020'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1020';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('"SUPREMA SAFETY', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1020', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1020';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1020', 
    '"SUPREMA SAFETY', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', 'SEGUROSCONTABLESDAC@GMAIL.COM',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'vivir'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 39/692: 1020 - "SUPREMA SAFETY
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'S.A."' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: S.A." (fila 40)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'vivir' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('S.A."' = 'ASSA' AND 'SEGUROSCONTABLESDAC@GMAIL.COM' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1020'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1020';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('"SUPREMA SAFETY', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1020', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1020';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1020', 
    '"SUPREMA SAFETY', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', 'SEGUROSCONTABLESDAC@GMAIL.COM',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'vivir'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 40/692: 1020 - "SUPREMA SAFETY
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'S.A."' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: S.A." (fila 41)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'vivir' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('S.A."' = 'ASSA' AND 'SEGUROSCONTABLESDAC@GMAIL.COM' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1020'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1020';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('"SUPREMA SAFETY', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1020', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1020';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1020', 
    '"SUPREMA SAFETY', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', 'SEGUROSCONTABLESDAC@GMAIL.COM',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'vivir'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 41/692: 04-05-1766169-1 - ELEAZER ENRRIQUE RODRIGUEZ APODACA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 42)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'fernandez_jose_08@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 13.21 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-05-1766169-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-10-23', start_date),
      renewal_date = COALESCE('2026-10-23', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-05-1766169-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ELEAZER ENRRIQUE RODRIGUEZ APODACA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-05-1766169-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-10-23', '2026-10-23', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-05-1766169-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-05-1766169-1', 
    'ELEAZER ENRRIQUE RODRIGUEZ APODACA', 
    v_insurer_id, 
    v_broker_id,
    13.21,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'fernandez_jose_08@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 42/692: 12-30-18773 - FELICIDAD ORO LU DE ALCOVE
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 43)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'fernandez_jose_08@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.49 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '12-30-18773'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 12-30-18773';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('FELICIDAD ORO LU DE ALCOVE', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '12-30-18773', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 12-30-18773';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '12-30-18773', 
    'FELICIDAD ORO LU DE ALCOVE', 
    v_insurer_id, 
    v_broker_id,
    9.49,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'fernandez_jose_08@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 43/692: 5-30-32723 - BRIGITTE JANARYS AIZPRUA SANCHEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 44)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'fernandez_jose_08@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.93 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '5-30-32723'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 5-30-32723';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('BRIGITTE JANARYS AIZPRUA SANCHEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '5-30-32723', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 5-30-32723';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '5-30-32723', 
    'BRIGITTE JANARYS AIZPRUA SANCHEZ', 
    v_insurer_id, 
    v_broker_id,
    9.93,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'fernandez_jose_08@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 44/692: 02-83-1184842-0 - JONATAN MORENO GUERRA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 45)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'fernandez_jose_08@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 14.03 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-83-1184842-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-83-1184842-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JONATAN MORENO GUERRA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-83-1184842-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-83-1184842-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-83-1184842-0', 
    'JONATAN MORENO GUERRA', 
    v_insurer_id, 
    v_broker_id,
    14.03,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'fernandez_jose_08@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 45/692: 02-93-1093197-1 - ABI MORENO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 46)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'fernandez_jose_08@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 23.34 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-93-1093197-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-93-1093197-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ABI MORENO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-93-1093197-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-93-1093197-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-93-1093197-1', 
    'ABI MORENO', 
    v_insurer_id, 
    v_broker_id,
    23.34,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'fernandez_jose_08@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 46/692: 02-92-1162715-1 - PAULA GONZALEZ DE CHAVEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 47)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'fernandez_jose_08@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 37.95 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-92-1162715-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-92-1162715-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('PAULA GONZALEZ DE CHAVEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-92-1162715-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-92-1162715-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-92-1162715-1', 
    'PAULA GONZALEZ DE CHAVEZ', 
    v_insurer_id, 
    v_broker_id,
    37.95,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'fernandez_jose_08@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 47/692: 02-83-0981161-2 - YIRA MARISOL GONZALEZ BATISTA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 48)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'fernandez_jose_08@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 5.85 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-83-0981161-2'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-83-0981161-2';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('YIRA MARISOL GONZALEZ BATISTA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-83-0981161-2', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-83-0981161-2';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-83-0981161-2', 
    'YIRA MARISOL GONZALEZ BATISTA', 
    v_insurer_id, 
    v_broker_id,
    5.85,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'fernandez_jose_08@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 48/692: 02-92-1022779-2 - VICTOR GUERRA JARAMILLO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 49)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'fernandez_jose_08@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 34.39 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-92-1022779-2'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-92-1022779-2';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('VICTOR GUERRA JARAMILLO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-92-1022779-2', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-92-1022779-2';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-92-1022779-2', 
    'VICTOR GUERRA JARAMILLO', 
    v_insurer_id, 
    v_broker_id,
    34.39,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'fernandez_jose_08@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 49/692: 02-83-1160751-1 - AZAN ABDEEL GUERRA AGUILAR
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 50)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'fernandez_jose_08@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 14.15 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-83-1160751-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-83-1160751-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('AZAN ABDEEL GUERRA AGUILAR', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-83-1160751-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-83-1160751-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-83-1160751-1', 
    'AZAN ABDEEL GUERRA AGUILAR', 
    v_insurer_id, 
    v_broker_id,
    14.15,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'fernandez_jose_08@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 50/692: 02-83-1193177-0 - ELVIN DE LOS RIOS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 51)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'fernandez_jose_08@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 7.09 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-83-1193177-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-83-1193177-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ELVIN DE LOS RIOS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-83-1193177-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-83-1193177-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-83-1193177-0', 
    'ELVIN DE LOS RIOS', 
    v_insurer_id, 
    v_broker_id,
    7.09,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'fernandez_jose_08@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 51/692: 072257898 25 - ANDRES JAVIER GUERRA SANTOS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 52)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'fernandez_jose_08@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 2.01 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '072257898 25'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 072257898 25';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ANDRES JAVIER GUERRA SANTOS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '072257898 25', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 072257898 25';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '072257898 25', 
    'ANDRES JAVIER GUERRA SANTOS', 
    v_insurer_id, 
    v_broker_id,
    2.01,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'fernandez_jose_08@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 52/692: 13-03-0591046-10 - ANDRES JAVIER GUERRA SANTOS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 53)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'fernandez_jose_08@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 3 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '13-03-0591046-10'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 13-03-0591046-10';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ANDRES JAVIER GUERRA SANTOS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '13-03-0591046-10', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 13-03-0591046-10';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '13-03-0591046-10', 
    'ANDRES JAVIER GUERRA SANTOS', 
    v_insurer_id, 
    v_broker_id,
    3,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'fernandez_jose_08@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 53/692: 02-93-1234971-0 - DAYREAN THAYS GARCIA GARCIA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 54)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'fernandez_jose_08@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.59 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-93-1234971-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-93-1234971-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('DAYREAN THAYS GARCIA GARCIA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-93-1234971-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-93-1234971-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-93-1234971-0', 
    'DAYREAN THAYS GARCIA GARCIA', 
    v_insurer_id, 
    v_broker_id,
    11.59,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'fernandez_jose_08@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 54/692: 02-92-1041269-1 - OSVALDO BERMUDEZ PINO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 55)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'fernandez_jose_08@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 5.2 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-92-1041269-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-92-1041269-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('OSVALDO BERMUDEZ PINO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-92-1041269-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-92-1041269-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-92-1041269-1', 
    'OSVALDO BERMUDEZ PINO', 
    v_insurer_id, 
    v_broker_id,
    5.2,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'fernandez_jose_08@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 55/692: 02-83-1188125-0 - LEONARDO ANTONIO CASTILLO GONZALEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 56)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'fernandez_jose_08@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.45 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-83-1188125-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-83-1188125-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('LEONARDO ANTONIO CASTILLO GONZALEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-83-1188125-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-83-1188125-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-83-1188125-0', 
    'LEONARDO ANTONIO CASTILLO GONZALEZ', 
    v_insurer_id, 
    v_broker_id,
    8.45,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'fernandez_jose_08@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 56/692: 02-93-1002149-2 - ANDRES JAVIER GUERRA SANTOS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 57)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'fernandez_jose_08@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.15 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-93-1002149-2'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-93-1002149-2';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ANDRES JAVIER GUERRA SANTOS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-93-1002149-2', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-93-1002149-2';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-93-1002149-2', 
    'ANDRES JAVIER GUERRA SANTOS', 
    v_insurer_id, 
    v_broker_id,
    9.15,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'fernandez_jose_08@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 57/692: 02-92-1237889-0 - "AUTO RENT SOLUTION
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INC."' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INC." (fila 58)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'sura' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INC."' = 'ASSA' AND 'FERNANDEZ_JOSE_08@HOTMAIL.COM' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-92-1237889-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-92-1237889-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('"AUTO RENT SOLUTION', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-92-1237889-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-92-1237889-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-92-1237889-0', 
    '"AUTO RENT SOLUTION', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', 'FERNANDEZ_JOSE_08@HOTMAIL.COM',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'sura'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 58/692: 02-92-0988877-2 - ANDRES JAVIER GUERRA SANTOS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 59)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'fernandez_jose_08@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.91 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-92-0988877-2'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-92-0988877-2';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ANDRES JAVIER GUERRA SANTOS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-92-0988877-2', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-92-0988877-2';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-92-0988877-2', 
    'ANDRES JAVIER GUERRA SANTOS', 
    v_insurer_id, 
    v_broker_id,
    9.91,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'fernandez_jose_08@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 59/692: 02-83-1189972-0 - MARCOS FIDEL PEREZ BAL
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 60)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'fernandez_jose_08@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10.34 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-83-1189972-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-83-1189972-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MARCOS FIDEL PEREZ BAL', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-83-1189972-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-83-1189972-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-83-1189972-0', 
    'MARCOS FIDEL PEREZ BAL', 
    v_insurer_id, 
    v_broker_id,
    10.34,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'fernandez_jose_08@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 60/692: 20-11-0591154-0 - ANDRES JAVIER GUERRA SANTOS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 61)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'fernandez_jose_08@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 1.23 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '20-11-0591154-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 20-11-0591154-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ANDRES JAVIER GUERRA SANTOS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '20-11-0591154-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 20-11-0591154-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '20-11-0591154-0', 
    'ANDRES JAVIER GUERRA SANTOS', 
    v_insurer_id, 
    v_broker_id,
    1.23,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'fernandez_jose_08@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 61/692: 70B11778 - YANIRE TAMANIA CHO SEGUNDO DE ZAMORA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 62)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'SALUD' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 49.7 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '70B11778'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-08-16', start_date),
      renewal_date = COALESCE('2026-08-16', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 70B11778';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('YANIRE TAMANIA CHO SEGUNDO DE ZAMORA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '70B11778', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-08-16', '2026-08-16', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 70B11778';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '70B11778', 
    'YANIRE TAMANIA CHO SEGUNDO DE ZAMORA', 
    v_insurer_id, 
    v_broker_id,
    49.7,
    jsonb_build_object(
      'policy_type', 'SALUD',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 62/692: 14B21588 - MELISSA ENITH TORIBIO MAGALLON
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 63)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.64 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B21588'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-04-28', start_date),
      renewal_date = COALESCE('2026-04-28', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B21588';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MELISSA ENITH TORIBIO MAGALLON', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B21588', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-04-28', '2026-04-28', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B21588';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B21588', 
    'MELISSA ENITH TORIBIO MAGALLON', 
    v_insurer_id, 
    v_broker_id,
    0.64,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 63/692: 14B42356 - LUZ DARY PARRA VALENCIA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 64)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.55 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B42356'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-28', start_date),
      renewal_date = COALESCE('2026-11-28', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B42356';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('LUZ DARY PARRA VALENCIA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B42356', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-28', '2026-11-28', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B42356';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B42356', 
    'LUZ DARY PARRA VALENCIA', 
    v_insurer_id, 
    v_broker_id,
    0.55,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 64/692: 12BV23741 - NELLY EDILMA RODRIGUEZ RODRIGUEZ DE VALDES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 65)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 3.55 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '12BV23741'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-03-28', start_date),
      renewal_date = COALESCE('2026-03-28', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 12BV23741';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('NELLY EDILMA RODRIGUEZ RODRIGUEZ DE VALDES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '12BV23741', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-03-28', '2026-03-28', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 12BV23741';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '12BV23741', 
    'NELLY EDILMA RODRIGUEZ RODRIGUEZ DE VALDES', 
    v_insurer_id, 
    v_broker_id,
    3.55,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 65/692: 70B15872 - CORALIA NAYADET SANCHEZ RODRIGUEZ DE RAMOS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 66)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 15.56 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '70B15872'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-02-01', start_date),
      renewal_date = COALESCE('2026-02-01', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 70B15872';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CORALIA NAYADET SANCHEZ RODRIGUEZ DE RAMOS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '70B15872', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-02-01', '2026-02-01', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 70B15872';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '70B15872', 
    'CORALIA NAYADET SANCHEZ RODRIGUEZ DE RAMOS', 
    v_insurer_id, 
    v_broker_id,
    15.56,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 66/692: 60B27823 - NERYS MARGARITA GAITAN MIRANDA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 67)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.96 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '60B27823'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-15', start_date),
      renewal_date = COALESCE('2026-09-15', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 60B27823';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('NERYS MARGARITA GAITAN MIRANDA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '60B27823', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-15', '2026-09-15', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 60B27823';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '60B27823', 
    'NERYS MARGARITA GAITAN MIRANDA', 
    v_insurer_id, 
    v_broker_id,
    0.96,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 67/692: 60B27817 - FRANK OSORIO ABADIA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 68)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 1.13 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '60B27817'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-15', start_date),
      renewal_date = COALESCE('2026-09-15', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 60B27817';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('FRANK OSORIO ABADIA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '60B27817', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-15', '2026-09-15', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 60B27817';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '60B27817', 
    'FRANK OSORIO ABADIA', 
    v_insurer_id, 
    v_broker_id,
    1.13,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 68/692: 14B28476 - DIEGO LAURENCENA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 69)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.72 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B28476'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-12-06', start_date),
      renewal_date = COALESCE('2026-12-06', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B28476';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('DIEGO LAURENCENA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B28476', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-12-06', '2026-12-06', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B28476';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B28476', 
    'DIEGO LAURENCENA', 
    v_insurer_id, 
    v_broker_id,
    0.72,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 69/692: 60B4456 - ITCIA MELIZA HAINZ DE LA ROSA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 70)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.46 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '60B4456'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-06-17', start_date),
      renewal_date = COALESCE('2026-06-17', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 60B4456';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ITCIA MELIZA HAINZ DE LA ROSA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '60B4456', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-06-17', '2026-06-17', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 60B4456';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '60B4456', 
    'ITCIA MELIZA HAINZ DE LA ROSA', 
    v_insurer_id, 
    v_broker_id,
    0.46,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 70/692: 60B6565 - CARMEN ELIDA SAMUDIO POLONIA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 71)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.3 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '60B6565'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-17', start_date),
      renewal_date = COALESCE('2026-09-17', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 60B6565';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CARMEN ELIDA SAMUDIO POLONIA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '60B6565', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-17', '2026-09-17', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 60B6565';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '60B6565', 
    'CARMEN ELIDA SAMUDIO POLONIA', 
    v_insurer_id, 
    v_broker_id,
    0.3,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 71/692: 14B29582 - SONIA ELENA PHILLIPS CAMARENA DE CASTILLO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 72)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.56 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B29582'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-11', start_date),
      renewal_date = COALESCE('2026-07-11', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B29582';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('SONIA ELENA PHILLIPS CAMARENA DE CASTILLO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B29582', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-11', '2026-07-11', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B29582';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B29582', 
    'SONIA ELENA PHILLIPS CAMARENA DE CASTILLO', 
    v_insurer_id, 
    v_broker_id,
    0.56,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 72/692: 12BV23542 - TILCIA ITZEL LLORENTE
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 73)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.87 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '12BV23542'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-07', start_date),
      renewal_date = COALESCE('2026-09-07', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 12BV23542';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('TILCIA ITZEL LLORENTE', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '12BV23542', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-07', '2026-09-07', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 12BV23542';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '12BV23542', 
    'TILCIA ITZEL LLORENTE', 
    v_insurer_id, 
    v_broker_id,
    0.87,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 73/692: 14B28989 - LUIS ALBERTO TORRES GALLARDO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 74)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 1.1 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B28989'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-03-05', start_date),
      renewal_date = COALESCE('2026-03-05', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B28989';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('LUIS ALBERTO TORRES GALLARDO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B28989', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-03-05', '2026-03-05', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B28989';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B28989', 
    'LUIS ALBERTO TORRES GALLARDO', 
    v_insurer_id, 
    v_broker_id,
    1.1,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 74/692: 14B28139 - TILCIA ITZEL LLORENTE
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 75)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.46 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B28139'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-07', start_date),
      renewal_date = COALESCE('2026-09-07', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B28139';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('TILCIA ITZEL LLORENTE', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B28139', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-07', '2026-09-07', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B28139';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B28139', 
    'TILCIA ITZEL LLORENTE', 
    v_insurer_id, 
    v_broker_id,
    0.46,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 75/692: 14B30177 - CASILDA ROCIO RAMOS MURILLO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 76)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.59 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B30177'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-27', start_date),
      renewal_date = COALESCE('2026-11-27', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B30177';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CASILDA ROCIO RAMOS MURILLO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B30177', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-27', '2026-11-27', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B30177';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B30177', 
    'CASILDA ROCIO RAMOS MURILLO', 
    v_insurer_id, 
    v_broker_id,
    0.59,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 76/692: 14B21320 - ELVIA ROSA EVERS BLEC
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 77)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.65 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B21320'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-03-26', start_date),
      renewal_date = COALESCE('2026-03-26', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B21320';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ELVIA ROSA EVERS BLEC', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B21320', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-03-26', '2026-03-26', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B21320';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B21320', 
    'ELVIA ROSA EVERS BLEC', 
    v_insurer_id, 
    v_broker_id,
    0.65,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 77/692: 14B36034 - JAVIER ANIBAL ORTEGA GONZALEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 78)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.68 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B36034'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-06-22', start_date),
      renewal_date = COALESCE('2026-06-22', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B36034';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JAVIER ANIBAL ORTEGA GONZALEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B36034', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-06-22', '2026-06-22', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B36034';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B36034', 
    'JAVIER ANIBAL ORTEGA GONZALEZ', 
    v_insurer_id, 
    v_broker_id,
    0.68,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 78/692: 12BV24919 - JAVIER ANIBAL ORTEGA GONZALEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 79)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.83 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '12BV24919'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-06-22', start_date),
      renewal_date = COALESCE('2026-06-22', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 12BV24919';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JAVIER ANIBAL ORTEGA GONZALEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '12BV24919', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-06-22', '2026-06-22', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 12BV24919';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '12BV24919', 
    'JAVIER ANIBAL ORTEGA GONZALEZ', 
    v_insurer_id, 
    v_broker_id,
    0.83,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 79/692: 12BV22344 - ELVIA ROSA EVERS BLEC
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 80)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.68 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '12BV22344'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-03-26', start_date),
      renewal_date = COALESCE('2026-03-26', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 12BV22344';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ELVIA ROSA EVERS BLEC', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '12BV22344', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-03-26', '2026-03-26', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 12BV22344';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '12BV22344', 
    'ELVIA ROSA EVERS BLEC', 
    v_insurer_id, 
    v_broker_id,
    0.68,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 80/692: 03B69966 - FRANK OSORIO ABADIA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 81)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 5.54 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '03B69966'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-12', start_date),
      renewal_date = COALESCE('2026-09-12', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 03B69966';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('FRANK OSORIO ABADIA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '03B69966', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-12', '2026-09-12', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 03B69966';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '03B69966', 
    'FRANK OSORIO ABADIA', 
    v_insurer_id, 
    v_broker_id,
    5.54,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 81/692: 15B37427 - ENRICO DESIATA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 82)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 1.71 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '15B37427'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-02-02', start_date),
      renewal_date = COALESCE('2026-02-02', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 15B37427';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ENRICO DESIATA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '15B37427', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-02-02', '2026-02-02', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 15B37427';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '15B37427', 
    'ENRICO DESIATA', 
    v_insurer_id, 
    v_broker_id,
    1.71,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 82/692: 15B37426 - ENRICO DESIATA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 83)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 1.71 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '15B37426'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-02-02', start_date),
      renewal_date = COALESCE('2026-02-02', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 15B37426';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ENRICO DESIATA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '15B37426', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-02-02', '2026-02-02', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 15B37426';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '15B37426', 
    'ENRICO DESIATA', 
    v_insurer_id, 
    v_broker_id,
    1.71,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 83/692: 02B165402 - EDITH ALLARD DE GONZALEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 84)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 3.54 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B165402'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-05-29', start_date),
      renewal_date = COALESCE('2026-05-29', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B165402';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('EDITH ALLARD DE GONZALEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B165402', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-05-29', '2026-05-29', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B165402';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B165402', 
    'EDITH ALLARD DE GONZALEZ', 
    v_insurer_id, 
    v_broker_id,
    3.54,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 84/692: 02B245514 - ETTA MIREYA JARAMILLO LAVAL DE PERIGAULT
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 85)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.93 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B245514'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-06-22', start_date),
      renewal_date = COALESCE('2026-06-22', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B245514';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ETTA MIREYA JARAMILLO LAVAL DE PERIGAULT', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B245514', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-06-22', '2026-06-22', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B245514';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B245514', 
    'ETTA MIREYA JARAMILLO LAVAL DE PERIGAULT', 
    v_insurer_id, 
    v_broker_id,
    8.93,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 85/692: 02G30471 - EIDA RAQUEL OSORIO DE RIOS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 86)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 3.89 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02G30471'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-04-19', start_date),
      renewal_date = COALESCE('2026-04-19', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02G30471';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('EIDA RAQUEL OSORIO DE RIOS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02G30471', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-04-19', '2026-04-19', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02G30471';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02G30471', 
    'EIDA RAQUEL OSORIO DE RIOS', 
    v_insurer_id, 
    v_broker_id,
    3.89,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 86/692: 60B27145 - TAMARA ELIZABETH MARTINEZ PAREDES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 87)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.82 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '60B27145'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-06', start_date),
      renewal_date = COALESCE('2026-07-06', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 60B27145';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('TAMARA ELIZABETH MARTINEZ PAREDES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '60B27145', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-06', '2026-07-06', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 60B27145';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '60B27145', 
    'TAMARA ELIZABETH MARTINEZ PAREDES', 
    v_insurer_id, 
    v_broker_id,
    0.82,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 87/692: 60B13103 - JOSE BEDOYA MOSQUERA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 88)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 1.37 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '60B13103'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-04-15', start_date),
      renewal_date = COALESCE('2026-04-15', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 60B13103';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JOSE BEDOYA MOSQUERA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '60B13103', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-04-15', '2026-04-15', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 60B13103';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '60B13103', 
    'JOSE BEDOYA MOSQUERA', 
    v_insurer_id, 
    v_broker_id,
    1.37,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 88/692: 60B51917 - ENRICO DESIATA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 89)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 24.91 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '60B51917'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-10-10', start_date),
      renewal_date = COALESCE('2026-10-10', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 60B51917';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ENRICO DESIATA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '60B51917', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-10-10', '2026-10-10', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 60B51917';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '60B51917', 
    'ENRICO DESIATA', 
    v_insurer_id, 
    v_broker_id,
    24.91,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 89/692: 60B33834 - NELLY EDILMA RODRIGUEZ RODRIGUEZ DE VALDES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 90)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 23.31 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '60B33834'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-11', start_date),
      renewal_date = COALESCE('2026-09-11', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 60B33834';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('NELLY EDILMA RODRIGUEZ RODRIGUEZ DE VALDES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '60B33834', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-11', '2026-09-11', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 60B33834';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '60B33834', 
    'NELLY EDILMA RODRIGUEZ RODRIGUEZ DE VALDES', 
    v_insurer_id, 
    v_broker_id,
    23.31,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 90/692: 60B39376 - MIGUEL ANGEL RIOS RUIZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 91)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 13.28 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '60B39376'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2024-12-24', start_date),
      renewal_date = COALESCE('2025-12-24', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 60B39376';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MIGUEL ANGEL RIOS RUIZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '60B39376', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2024-12-24', '2025-12-24', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 60B39376';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '60B39376', 
    'MIGUEL ANGEL RIOS RUIZ', 
    v_insurer_id, 
    v_broker_id,
    13.28,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 91/692: 14B56080 - ANDRY OSORIO RAMIREZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 92)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 4.5 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B56080'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-06-12', start_date),
      renewal_date = COALESCE('2026-06-12', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B56080';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ANDRY OSORIO RAMIREZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B56080', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-06-12', '2026-06-12', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B56080';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B56080', 
    'ANDRY OSORIO RAMIREZ', 
    v_insurer_id, 
    v_broker_id,
    4.5,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 92/692: 60B42389 - ERIKA DENISSE PEREZ RAMOS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 93)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 1.22 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '60B42389'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-13', start_date),
      renewal_date = COALESCE('2026-09-13', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 60B42389';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ERIKA DENISSE PEREZ RAMOS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '60B42389', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-13', '2026-09-13', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 60B42389';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '60B42389', 
    'ERIKA DENISSE PEREZ RAMOS', 
    v_insurer_id, 
    v_broker_id,
    1.22,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 93/692: 2317-00062-01 - TORNILLOS Y HERRAMIENTAS YASIEL SA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 94)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 105.72 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2317-00062-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2317-00062-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('TORNILLOS Y HERRAMIENTAS YASIEL SA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2317-00062-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2317-00062-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2317-00062-01', 
    'TORNILLOS Y HERRAMIENTAS YASIEL SA', 
    v_insurer_id, 
    v_broker_id,
    105.72,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 94/692: 1923-00174-01 - DIDIMO  SAMUDIO POLONIA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 95)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 5.54 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1923-00174-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1923-00174-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('DIDIMO  SAMUDIO POLONIA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1923-00174-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1923-00174-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1923-00174-01', 
    'DIDIMO  SAMUDIO POLONIA', 
    v_insurer_id, 
    v_broker_id,
    5.54,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 95/692: 1-4-15110 - MARCIA MARGARITA HUNT HESLOP
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 96)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.71 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-4-15110'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-4-15110';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MARCIA MARGARITA HUNT HESLOP', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-4-15110', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-4-15110';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-4-15110', 
    'MARCIA MARGARITA HUNT HESLOP', 
    v_insurer_id, 
    v_broker_id,
    0.71,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 96/692: 1-4-15111 - ADRIEL LORENZO BUTCHER BROWN
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 97)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.85 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-4-15111'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-4-15111';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ADRIEL LORENZO BUTCHER BROWN', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-4-15111', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-4-15111';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-4-15111', 
    'ADRIEL LORENZO BUTCHER BROWN', 
    v_insurer_id, 
    v_broker_id,
    0.85,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 97/692: 1-16-65317 - ENRICO DESIATA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 98)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 32.03 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-65317'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-65317';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ENRICO DESIATA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-65317', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-65317';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-65317', 
    'ENRICO DESIATA', 
    v_insurer_id, 
    v_broker_id,
    32.03,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 98/692: 1-16-32161 - WILDER PAUL CHEN GARCIA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 99)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 4.28 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-32161'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-32161';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('WILDER PAUL CHEN GARCIA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-32161', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-32161';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-32161', 
    'WILDER PAUL CHEN GARCIA', 
    v_insurer_id, 
    v_broker_id,
    4.28,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 99/692: 12-16-2554 - "INMAQUIP PANAMA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'S.A."' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: S.A." (fila 100)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'internacional' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('S.A."' = 'ASSA' AND 'DIDIMOSAMUDIO@LIDERESENSEGUROS.COM' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '12-16-2554'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 12-16-2554';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('"INMAQUIP PANAMA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '12-16-2554', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 12-16-2554';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '12-16-2554', 
    '"INMAQUIP PANAMA', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', 'DIDIMOSAMUDIO@LIDERESENSEGUROS.COM',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'internacional'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 100/692: 9441 - MOSQUERA CASTILLO CARLOS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'VIVIR' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: VIVIR (fila 101)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'didimosamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('VIVIR' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 32.34 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '9441'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 9441';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MOSQUERA CASTILLO CARLOS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '9441', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 9441';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '9441', 
    'MOSQUERA CASTILLO CARLOS', 
    v_insurer_id, 
    v_broker_id,
    32.34,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'didimosamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 101/692: 03B80316 - MELISSA RAMOS SOMARRIBA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 102)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'somarribaeisy@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 2.35 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '03B80316'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-26', start_date),
      renewal_date = COALESCE('2026-11-26', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 03B80316';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MELISSA RAMOS SOMARRIBA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '03B80316', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-26', '2026-11-26', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 03B80316';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '03B80316', 
    'MELISSA RAMOS SOMARRIBA', 
    v_insurer_id, 
    v_broker_id,
    2.35,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'somarribaeisy@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 102/692: 0225-02018-09 - RICARDO REY MORENO LAMADRID
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 103)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'somarribaeisy@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.56 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0225-02018-09'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0225-02018-09';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('RICARDO REY MORENO LAMADRID', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0225-02018-09', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0225-02018-09';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0225-02018-09', 
    'RICARDO REY MORENO LAMADRID', 
    v_insurer_id, 
    v_broker_id,
    11.56,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'somarribaeisy@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 103/692: 70B30449 - HERMELINDA ERMIS RODRIGUEZ FRIAS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 104)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'ediskatherine@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'SALUD' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 38.69 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '70B30449'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-01-04', start_date),
      renewal_date = COALESCE('2026-01-04', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 70B30449';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('HERMELINDA ERMIS RODRIGUEZ FRIAS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '70B30449', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-01-04', '2026-01-04', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 70B30449';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '70B30449', 
    'HERMELINDA ERMIS RODRIGUEZ FRIAS', 
    v_insurer_id, 
    v_broker_id,
    38.69,
    jsonb_build_object(
      'policy_type', 'SALUD',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'ediskatherine@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 104/692: 02BR2927217 - REINALDO JOSE RIVAS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 105)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'ediskatherine@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 17.46 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02BR2927217'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-07', start_date),
      renewal_date = COALESCE('2026-11-07', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02BR2927217';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('REINALDO JOSE RIVAS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02BR2927217', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-07', '2026-11-07', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02BR2927217';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02BR2927217', 
    'REINALDO JOSE RIVAS', 
    v_insurer_id, 
    v_broker_id,
    17.46,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'ediskatherine@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 105/692: 1-1-35339-0 - JOSE LUIS FERNANDEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'BANESCO' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: BANESCO (fila 106)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'ediskatherine@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('BANESCO' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 41.87 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-1-35339-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-1-35339-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JOSE LUIS FERNANDEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-1-35339-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-1-35339-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-1-35339-0', 
    'JOSE LUIS FERNANDEZ', 
    v_insurer_id, 
    v_broker_id,
    41.87,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'ediskatherine@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 106/692: 1-16-52521 - JUAN ALBERTO NAVARRO CABALLERO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 107)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'ediskatherine@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.09 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-52521'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-52521';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JUAN ALBERTO NAVARRO CABALLERO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-52521', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-52521';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-52521', 
    'JUAN ALBERTO NAVARRO CABALLERO', 
    v_insurer_id, 
    v_broker_id,
    0.09,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'ediskatherine@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 107/692: 1-16-52527 - JUAN ALBERTO NAVARRO CABALLERO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 108)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'ediskatherine@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.09 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-52527'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-52527';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JUAN ALBERTO NAVARRO CABALLERO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-52527', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-52527';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-52527', 
    'JUAN ALBERTO NAVARRO CABALLERO', 
    v_insurer_id, 
    v_broker_id,
    0.09,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'ediskatherine@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 108/692: 1-30-647734 - "SCOTIA LEASING PANAMA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'S.A."' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: S.A." (fila 109)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'internacional' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('S.A."' = 'ASSA' AND 'EDISKATHERINE@HOTMAIL.COM' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-30-647734'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-30-647734';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('"SCOTIA LEASING PANAMA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-30-647734', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-30-647734';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-30-647734', 
    '"SCOTIA LEASING PANAMA', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', 'EDISKATHERINE@HOTMAIL.COM',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'internacional'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 109/692: 1-16-48717 - GERSON ALBERTO PHILLIPS CAMARENA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 110)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'ediskatherine@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 4.73 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-48717'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-48717';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('GERSON ALBERTO PHILLIPS CAMARENA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-48717', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-48717';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-48717', 
    'GERSON ALBERTO PHILLIPS CAMARENA', 
    v_insurer_id, 
    v_broker_id,
    4.73,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'ediskatherine@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 110/692: 1-16-55997 - JEHZABEL ELENA QUINTERO LOPEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 111)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'ediskatherine@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 4.73 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-55997'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-55997';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JEHZABEL ELENA QUINTERO LOPEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-55997', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-55997';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-55997', 
    'JEHZABEL ELENA QUINTERO LOPEZ', 
    v_insurer_id, 
    v_broker_id,
    4.73,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'ediskatherine@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 111/692: 02-39-1104031-1 - SOUTHERN TRANSFER  PANAMA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 112)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'ediskatherine@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 94.29 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-39-1104031-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-39-1104031-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('SOUTHERN TRANSFER  PANAMA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-39-1104031-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-39-1104031-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-39-1104031-1', 
    'SOUTHERN TRANSFER  PANAMA', 
    v_insurer_id, 
    v_broker_id,
    94.29,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'ediskatherine@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 112/692: 013300025353 - "SERV COMPUTARIZADOS ADUANALES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'S.A."' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: S.A." (fila 113)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'sura' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('S.A."' = 'ASSA' AND 'EDISKATHERINE@HOTMAIL.COM' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '013300025353'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 013300025353';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('"SERV COMPUTARIZADOS ADUANALES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '013300025353', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 013300025353';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '013300025353', 
    '"SERV COMPUTARIZADOS ADUANALES', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', 'EDISKATHERINE@HOTMAIL.COM',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'sura'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 113/692: TR-106747 - SOUTHERN TRANSFER (PANAMA)
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 114)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'ediskatherine@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 51.28 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = 'TR-106747'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: TR-106747';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('SOUTHERN TRANSFER (PANAMA)', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      'TR-106747', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: TR-106747';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    'TR-106747', 
    'SOUTHERN TRANSFER (PANAMA)', 
    v_insurer_id, 
    v_broker_id,
    51.28,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'ediskatherine@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 114/692: 02B256629 - BEISI VANESSA CARDOZO GONZALEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 115)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'eascanio@avenirgroupla.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 6.34 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B256629'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-02-06', start_date),
      renewal_date = COALESCE('2026-02-06', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B256629';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('BEISI VANESSA CARDOZO GONZALEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B256629', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-02-06', '2026-02-06', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B256629';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B256629', 
    'BEISI VANESSA CARDOZO GONZALEZ', 
    v_insurer_id, 
    v_broker_id,
    6.34,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'eascanio@avenirgroupla.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 115/692: 03B75301 - DANIEL RAMIREZ PARMA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 116)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'eascanio@avenirgroupla.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 4.55 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '03B75301'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-02', start_date),
      renewal_date = COALESCE('2026-11-02', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 03B75301';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('DANIEL RAMIREZ PARMA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '03B75301', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-02', '2026-11-02', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 03B75301';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '03B75301', 
    'DANIEL RAMIREZ PARMA', 
    v_insurer_id, 
    v_broker_id,
    4.55,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'eascanio@avenirgroupla.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 116/692: 03B82292 - CARLOS GABRIEL DE SOUSA DA SILVA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 117)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'eascanio@avenirgroupla.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 4.94 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '03B82292'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-06-08', start_date),
      renewal_date = COALESCE('2026-06-08', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 03B82292';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CARLOS GABRIEL DE SOUSA DA SILVA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '03B82292', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-06-08', '2026-06-08', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 03B82292';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '03B82292', 
    'CARLOS GABRIEL DE SOUSA DA SILVA', 
    v_insurer_id, 
    v_broker_id,
    4.94,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'eascanio@avenirgroupla.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 117/692: 02B248681 - LUZ ANGELA ROMERO PEREZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 118)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 7.94 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B248681'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-07', start_date),
      renewal_date = COALESCE('2026-09-07', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B248681';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('LUZ ANGELA ROMERO PEREZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B248681', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-07', '2026-09-07', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B248681';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B248681', 
    'LUZ ANGELA ROMERO PEREZ', 
    v_insurer_id, 
    v_broker_id,
    7.94,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 118/692: 02-92-1148334-1 - GUILLERMO ALFREDO ESCUDERO CANTON
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 119)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'elizabetarce26@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 5 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-92-1148334-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-92-1148334-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('GUILLERMO ALFREDO ESCUDERO CANTON', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-92-1148334-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-92-1148334-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-92-1148334-1', 
    'GUILLERMO ALFREDO ESCUDERO CANTON', 
    v_insurer_id, 
    v_broker_id,
    5,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'elizabetarce26@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 119/692: 04-04-558433-9 - YOVIRA LINNETTE DE LA CRUZ CHING
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 120)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 6.14 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-558433-9'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-16', start_date),
      renewal_date = COALESCE('2026-09-16', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-558433-9';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('YOVIRA LINNETTE DE LA CRUZ CHING', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-558433-9', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-16', '2026-09-16', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-558433-9';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-558433-9', 
    'YOVIRA LINNETTE DE LA CRUZ CHING', 
    v_insurer_id, 
    v_broker_id,
    6.14,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 120/692: 04-04-599783-8 - ANTONIO  VASQUEZ NU�EZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 121)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10.38 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-599783-8'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-04-21', start_date),
      renewal_date = COALESCE('2026-04-21', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-599783-8';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ANTONIO  VASQUEZ NU�EZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-599783-8', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-04-21', '2026-04-21', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-599783-8';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-599783-8', 
    'ANTONIO  VASQUEZ NU�EZ', 
    v_insurer_id, 
    v_broker_id,
    10.38,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 121/692: 04-04-574824-9 - CESAR AUGUSTO VEGA TORRES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 122)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 3.47 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-574824-9'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-10-31', start_date),
      renewal_date = COALESCE('2026-10-31', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-574824-9';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CESAR AUGUSTO VEGA TORRES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-574824-9', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-10-31', '2026-10-31', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-574824-9';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-574824-9', 
    'CESAR AUGUSTO VEGA TORRES', 
    v_insurer_id, 
    v_broker_id,
    3.47,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 122/692: 04-04-1404213-2 - CESAR CARDENAS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 123)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.99 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-1404213-2'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-06', start_date),
      renewal_date = COALESCE('2026-07-06', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-1404213-2';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CESAR CARDENAS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-1404213-2', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-06', '2026-07-06', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-1404213-2';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-1404213-2', 
    'CESAR CARDENAS', 
    v_insurer_id, 
    v_broker_id,
    8.99,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 123/692: 04-04-599783-8 - ANTONIO  VASQUEZ NU�EZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 124)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.32 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-599783-8'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-04-21', start_date),
      renewal_date = COALESCE('2026-04-21', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-599783-8';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ANTONIO  VASQUEZ NU�EZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-599783-8', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-04-21', '2026-04-21', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-599783-8';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-599783-8', 
    'ANTONIO  VASQUEZ NU�EZ', 
    v_insurer_id, 
    v_broker_id,
    11.32,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 124/692: 16213 - QUIROZ RODRIGUEZ ERIKA MA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'VIVIR' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: VIVIR (fila 125)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('VIVIR' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 5.92 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '16213'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 16213';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('QUIROZ RODRIGUEZ ERIKA MA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '16213', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 16213';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '16213', 
    'QUIROZ RODRIGUEZ ERIKA MA', 
    v_insurer_id, 
    v_broker_id,
    5.92,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 125/692: 16214 - QUIROZ RODRIGUEZ ERIKA MA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'VIVIR' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: VIVIR (fila 126)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('VIVIR' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 7.69 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '16214'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 16214';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('QUIROZ RODRIGUEZ ERIKA MA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '16214', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 16214';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '16214', 
    'QUIROZ RODRIGUEZ ERIKA MA', 
    v_insurer_id, 
    v_broker_id,
    7.69,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 126/692: 14487 - CASTILLO GONZALEZ DANIEL
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'VIVIR' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: VIVIR (fila 127)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('VIVIR' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.31 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14487'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14487';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CASTILLO GONZALEZ DANIEL', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14487', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14487';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14487', 
    'CASTILLO GONZALEZ DANIEL', 
    v_insurer_id, 
    v_broker_id,
    8.31,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 127/692: 14474 - CASTILLO MENDIETA HUSSEIN
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'VIVIR' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: VIVIR (fila 128)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('VIVIR' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.62 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14474'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14474';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CASTILLO MENDIETA HUSSEIN', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14474', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14474';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14474', 
    'CASTILLO MENDIETA HUSSEIN', 
    v_insurer_id, 
    v_broker_id,
    9.62,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 128/692: 14541 - CASTILLO GONZALEZ DANIEL
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'VIVIR' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: VIVIR (fila 129)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('VIVIR' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 14.16 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14541'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14541';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CASTILLO GONZALEZ DANIEL', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14541', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14541';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14541', 
    'CASTILLO GONZALEZ DANIEL', 
    v_insurer_id, 
    v_broker_id,
    14.16,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 129/692: 60B29371 - GABRIEL JOSE ESCOBAR COSSU
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 130)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'xeniaaguilarpty@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 4.64 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '60B29371'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-04-04', start_date),
      renewal_date = COALESCE('2026-04-04', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 60B29371';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('GABRIEL JOSE ESCOBAR COSSU', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '60B29371', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-04-04', '2026-04-04', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 60B29371';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '60B29371', 
    'GABRIEL JOSE ESCOBAR COSSU', 
    v_insurer_id, 
    v_broker_id,
    4.64,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'xeniaaguilarpty@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 130/692: 02B3334553 - AMANDA ISABEL CONTASTI AROSEMENA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 131)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'gehcseguros@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.37 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3334553'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-03-17', start_date),
      renewal_date = COALESCE('2026-03-17', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3334553';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('AMANDA ISABEL CONTASTI AROSEMENA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3334553', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-03-17', '2026-03-17', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3334553';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3334553', 
    'AMANDA ISABEL CONTASTI AROSEMENA', 
    v_insurer_id, 
    v_broker_id,
    11.37,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'gehcseguros@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 131/692: 7-30-9590 - ENRIQUE JORGE VIVAS GONZALEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 132)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'gehcseguros@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.9 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '7-30-9590'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 7-30-9590';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ENRIQUE JORGE VIVAS GONZALEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '7-30-9590', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 7-30-9590';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '7-30-9590', 
    'ENRIQUE JORGE VIVAS GONZALEZ', 
    v_insurer_id, 
    v_broker_id,
    9.9,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'gehcseguros@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 132/692: 2012148 - "GENATIOS SEQUERA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'RICARDO EMILIO"' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: RICARDO EMILIO" (fila 133)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'regional' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('RICARDO EMILIO"' = 'ASSA' AND 'GEHCSEGUROS@GMAIL.COM' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2012148'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2012148';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('"GENATIOS SEQUERA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2012148', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2012148';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2012148', 
    '"GENATIOS SEQUERA', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', 'GEHCSEGUROS@GMAIL.COM',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'regional'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 133/692: 93462 - GEORGINA LISBETH PEREZ RODRIGUEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'OPTIMA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: OPTIMA (fila 134)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'georginalperez@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('OPTIMA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.54 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '93462'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 93462';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('GEORGINA LISBETH PEREZ RODRIGUEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '93462', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 93462';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '93462', 
    'GEORGINA LISBETH PEREZ RODRIGUEZ', 
    v_insurer_id, 
    v_broker_id,
    8.54,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'georginalperez@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 134/692: 93462 - GEORGINA LISBETH PEREZ RODRIGUEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'OPTIMA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: OPTIMA (fila 135)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'georginalperez@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('OPTIMA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.68 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '93462'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 93462';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('GEORGINA LISBETH PEREZ RODRIGUEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '93462', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 93462';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '93462', 
    'GEORGINA LISBETH PEREZ RODRIGUEZ', 
    v_insurer_id, 
    v_broker_id,
    0.68,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'georginalperez@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 135/692: 93462 - GEORGINA LISBETH PEREZ RODRIGUEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'OPTIMA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: OPTIMA (fila 136)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'georginalperez@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('OPTIMA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 6.25 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '93462'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 93462';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('GEORGINA LISBETH PEREZ RODRIGUEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '93462', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 93462';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '93462', 
    'GEORGINA LISBETH PEREZ RODRIGUEZ', 
    v_insurer_id, 
    v_broker_id,
    6.25,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'georginalperez@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 136/692: 2165799 - MARIELA DEL CARMEN  MONTERO RODRIGUEZ DE CIGARRUISTA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'REGIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: REGIONAL (fila 137)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'georginalperez@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('REGIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.58 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2165799'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2165799';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MARIELA DEL CARMEN  MONTERO RODRIGUEZ DE CIGARRUISTA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2165799', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2165799';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2165799', 
    'MARIELA DEL CARMEN  MONTERO RODRIGUEZ DE CIGARRUISTA', 
    v_insurer_id, 
    v_broker_id,
    11.58,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'georginalperez@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 137/692: 02B3383859 - MULTIBANK INC.
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 138)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'herickagonzalez@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.56 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3383859'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-06-05', start_date),
      renewal_date = COALESCE('2026-06-05', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3383859';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MULTIBANK INC.', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3383859', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-06-05', '2026-06-05', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3383859';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3383859', 
    'MULTIBANK INC.', 
    v_insurer_id, 
    v_broker_id,
    9.56,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'herickagonzalez@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 138/692: 02B3421127 - RAFAEL GUILLERMO VIZUETTE
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 139)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'herickagonzalez@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.8 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3421127'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-08-06', start_date),
      renewal_date = COALESCE('2026-08-06', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3421127';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('RAFAEL GUILLERMO VIZUETTE', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3421127', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-08-06', '2026-08-06', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3421127';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3421127', 
    'RAFAEL GUILLERMO VIZUETTE', 
    v_insurer_id, 
    v_broker_id,
    9.8,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'herickagonzalez@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 139/692: 02B3377168 - GUILLERMO ANDRES LEONES GONZALEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 140)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'herickagonzalez@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 18.1 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3377168'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-03-14', start_date),
      renewal_date = COALESCE('2026-03-14', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3377168';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('GUILLERMO ANDRES LEONES GONZALEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3377168', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-03-14', '2026-03-14', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3377168';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3377168', 
    'GUILLERMO ANDRES LEONES GONZALEZ', 
    v_insurer_id, 
    v_broker_id,
    18.1,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'herickagonzalez@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 140/692: 0125-07082-01 - RAFAEL GUILLERMO VIZUETTE
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 141)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'herickagonzalez@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 5 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0125-07082-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0125-07082-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('RAFAEL GUILLERMO VIZUETTE', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0125-07082-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0125-07082-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0125-07082-01', 
    'RAFAEL GUILLERMO VIZUETTE', 
    v_insurer_id, 
    v_broker_id,
    5,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'herickagonzalez@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 141/692: 0124-05006-01 - ANA ELIS HERBERT DE GRACIA DE FRANCO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 142)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'herickagonzalez@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10.72 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0124-05006-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0124-05006-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ANA ELIS HERBERT DE GRACIA DE FRANCO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0124-05006-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0124-05006-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0124-05006-01', 
    'ANA ELIS HERBERT DE GRACIA DE FRANCO', 
    v_insurer_id, 
    v_broker_id,
    10.72,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'herickagonzalez@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 142/692: 1-1-25880 - RAFAEL GUILLERMO VIZUETTE
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 143)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'herickagonzalez@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 3.95 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-1-25880'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-1-25880';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('RAFAEL GUILLERMO VIZUETTE', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-1-25880', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-1-25880';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-1-25880', 
    'RAFAEL GUILLERMO VIZUETTE', 
    v_insurer_id, 
    v_broker_id,
    3.95,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'herickagonzalez@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 143/692: 12-16-2694 - KATHERINE PATRICIA FRANCO ABREU
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 144)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'herickagonzalez@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 4.73 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '12-16-2694'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 12-16-2694';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('KATHERINE PATRICIA FRANCO ABREU', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '12-16-2694', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 12-16-2694';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '12-16-2694', 
    'KATHERINE PATRICIA FRANCO ABREU', 
    v_insurer_id, 
    v_broker_id,
    4.73,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'herickagonzalez@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 144/692: 76497 - LUIS EDUARDO ORTEGA RUIZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'OPTIMA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: OPTIMA (fila 145)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'herickagonzalez@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('OPTIMA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 2.95 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '76497'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 76497';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('LUIS EDUARDO ORTEGA RUIZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '76497', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 76497';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '76497', 
    'LUIS EDUARDO ORTEGA RUIZ', 
    v_insurer_id, 
    v_broker_id,
    2.95,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'herickagonzalez@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 145/692: 13929 - ROBERTZ HERNANDEZ ANDREA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'VIVIR' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: VIVIR (fila 146)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'herickagonzalez@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('VIVIR' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 5.27 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '13929'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 13929';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ROBERTZ HERNANDEZ ANDREA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '13929', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 13929';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '13929', 
    'ROBERTZ HERNANDEZ ANDREA', 
    v_insurer_id, 
    v_broker_id,
    5.27,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'herickagonzalez@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 146/692: 21413 - ROBERTZ OLIVER MICHAEL
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'VIVIR' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: VIVIR (fila 147)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'herickagonzalez@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('VIVIR' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 5.27 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '21413'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 21413';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ROBERTZ OLIVER MICHAEL', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '21413', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 21413';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '21413', 
    'ROBERTZ OLIVER MICHAEL', 
    v_insurer_id, 
    v_broker_id,
    5.27,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'herickagonzalez@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 147/692: 22614 - GONZALEZ GARCIA GEOVANNA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'VIVIR' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: VIVIR (fila 148)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'herickagonzalez@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('VIVIR' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10.37 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '22614'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 22614';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('GONZALEZ GARCIA GEOVANNA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '22614', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 22614';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '22614', 
    'GONZALEZ GARCIA GEOVANNA', 
    v_insurer_id, 
    v_broker_id,
    10.37,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'herickagonzalez@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 148/692: 20353 - ALDRETE LICONA LOURDES HA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'VIVIR' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: VIVIR (fila 149)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'herickagonzalez@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('VIVIR' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10.25 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '20353'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 20353';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ALDRETE LICONA LOURDES HA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '20353', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 20353';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '20353', 
    'ALDRETE LICONA LOURDES HA', 
    v_insurer_id, 
    v_broker_id,
    10.25,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'herickagonzalez@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 149/692: 03G7104 - YESENIA RAQUEL MADERO GONZALEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 150)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'herminio.arcia@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'INCENDIO' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.36 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '03G7104'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-02-06', start_date),
      renewal_date = COALESCE('2026-02-06', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 03G7104';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('YESENIA RAQUEL MADERO GONZALEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '03G7104', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-02-06', '2026-02-06', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 03G7104';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '03G7104', 
    'YESENIA RAQUEL MADERO GONZALEZ', 
    v_insurer_id, 
    v_broker_id,
    0.36,
    jsonb_build_object(
      'policy_type', 'INCENDIO',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'herminio.arcia@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 150/692: 02B306551 - MARLIN ANNETTE VARELA CHANG
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 151)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'herminio.arcia@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'AUTO' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 3.19 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B306551'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-04', start_date),
      renewal_date = COALESCE('2026-07-04', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B306551';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MARLIN ANNETTE VARELA CHANG', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B306551', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-04', '2026-07-04', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B306551';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B306551', 
    'MARLIN ANNETTE VARELA CHANG', 
    v_insurer_id, 
    v_broker_id,
    3.19,
    jsonb_build_object(
      'policy_type', 'AUTO',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'herminio.arcia@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 151/692: 02G34717 - NANCY KU KWOK
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 152)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'herminio.arcia@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'AUTO' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 1.65 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02G34717'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-07', start_date),
      renewal_date = COALESCE('2026-09-07', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02G34717';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('NANCY KU KWOK', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02G34717', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-07', '2026-09-07', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02G34717';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02G34717', 
    'NANCY KU KWOK', 
    v_insurer_id, 
    v_broker_id,
    1.65,
    jsonb_build_object(
      'policy_type', 'AUTO',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'herminio.arcia@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 152/692: 1917-00088-01 - JOSE ANGEL FLORES ARCIA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 153)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'herminio.arcia@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.23 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1917-00088-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1917-00088-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JOSE ANGEL FLORES ARCIA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1917-00088-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1917-00088-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1917-00088-01', 
    'JOSE ANGEL FLORES ARCIA', 
    v_insurer_id, 
    v_broker_id,
    0.23,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'herminio.arcia@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 153/692: 1809-00606-01 - ROSARIO DEL CARMEN OBERTO GUARDADO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 154)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'herminio.arcia@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 2.78 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1809-00606-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1809-00606-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ROSARIO DEL CARMEN OBERTO GUARDADO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1809-00606-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1809-00606-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1809-00606-01', 
    'ROSARIO DEL CARMEN OBERTO GUARDADO', 
    v_insurer_id, 
    v_broker_id,
    2.78,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'herminio.arcia@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 154/692: 1918-00210-01 - ANA EDITH VARELA ACHURRA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 155)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'herminio.arcia@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.19 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1918-00210-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1918-00210-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ANA EDITH VARELA ACHURRA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1918-00210-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1918-00210-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1918-00210-01', 
    'ANA EDITH VARELA ACHURRA', 
    v_insurer_id, 
    v_broker_id,
    0.19,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'herminio.arcia@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 155/692: 0219-01518-01 - MAIGUALIDA ISABEL GUARDADO MELO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 156)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'herminio.arcia@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.84 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0219-01518-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0219-01518-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MAIGUALIDA ISABEL GUARDADO MELO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0219-01518-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0219-01518-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0219-01518-01', 
    'MAIGUALIDA ISABEL GUARDADO MELO', 
    v_insurer_id, 
    v_broker_id,
    0.84,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'herminio.arcia@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 156/692: 1916-00069-01 - DENIA MARCELA ARCIA HUERTAS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 157)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'herminio.arcia@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.23 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1916-00069-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1916-00069-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('DENIA MARCELA ARCIA HUERTAS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1916-00069-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1916-00069-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1916-00069-01', 
    'DENIA MARCELA ARCIA HUERTAS', 
    v_insurer_id, 
    v_broker_id,
    0.23,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'herminio.arcia@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 157/692: 0219-00928-01 - ITZEL ALICIA ARJONA BRAVO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 158)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'herminio.arcia@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 1 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0219-00928-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0219-00928-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ITZEL ALICIA ARJONA BRAVO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0219-00928-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0219-00928-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0219-00928-01', 
    'ITZEL ALICIA ARJONA BRAVO', 
    v_insurer_id, 
    v_broker_id,
    1,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'herminio.arcia@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 158/692: 1916-00053-01 - HERMINIO  ARCIA PADILLA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 159)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'herminio.arcia@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.22 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1916-00053-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1916-00053-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('HERMINIO  ARCIA PADILLA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1916-00053-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1916-00053-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1916-00053-01', 
    'HERMINIO  ARCIA PADILLA', 
    v_insurer_id, 
    v_broker_id,
    0.22,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'herminio.arcia@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 159/692: 1809-00009-01 - DAGMAR BERTHA DIABRUDES CUELLAR
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 160)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'herminio.arcia@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 2.54 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1809-00009-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1809-00009-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('DAGMAR BERTHA DIABRUDES CUELLAR', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1809-00009-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1809-00009-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1809-00009-01', 
    'DAGMAR BERTHA DIABRUDES CUELLAR', 
    v_insurer_id, 
    v_broker_id,
    2.54,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'herminio.arcia@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 160/692: 0222-00483-10 - MATIAS  WALDEMAN MEDINA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 161)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'herminio.arcia@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.64 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0222-00483-10'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0222-00483-10';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MATIAS  WALDEMAN MEDINA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0222-00483-10', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0222-00483-10';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0222-00483-10', 
    'MATIAS  WALDEMAN MEDINA', 
    v_insurer_id, 
    v_broker_id,
    0.64,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'herminio.arcia@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 161/692: 1818-00178-01 - YESENIA RAQUEL MADERO GONZALEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 162)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'herminio.arcia@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.6 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1818-00178-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1818-00178-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('YESENIA RAQUEL MADERO GONZALEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1818-00178-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1818-00178-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1818-00178-01', 
    'YESENIA RAQUEL MADERO GONZALEZ', 
    v_insurer_id, 
    v_broker_id,
    0.6,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'herminio.arcia@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 162/692: 1921-00184-01 - MIASALIA AMERICA MOJICA FRANCO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 163)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'seguros.ifranco@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 1.33 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1921-00184-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1921-00184-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MIASALIA AMERICA MOJICA FRANCO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1921-00184-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1921-00184-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1921-00184-01', 
    'MIASALIA AMERICA MOJICA FRANCO', 
    v_insurer_id, 
    v_broker_id,
    1.33,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'seguros.ifranco@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 163/692: 1921-00408-01 - MIASALIA AMERICA MOJICA FRANCO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 164)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'seguros.ifranco@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.55 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1921-00408-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1921-00408-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MIASALIA AMERICA MOJICA FRANCO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1921-00408-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1921-00408-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1921-00408-01', 
    'MIASALIA AMERICA MOJICA FRANCO', 
    v_insurer_id, 
    v_broker_id,
    0.55,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'seguros.ifranco@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 164/692: 1922-00073-01 - MIGDALIA EDITH SANCHEZ ROSS DE ANDRI
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 165)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'seguros.ifranco@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 2.49 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1922-00073-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1922-00073-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MIGDALIA EDITH SANCHEZ ROSS DE ANDRI', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1922-00073-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1922-00073-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1922-00073-01', 
    'MIGDALIA EDITH SANCHEZ ROSS DE ANDRI', 
    v_insurer_id, 
    v_broker_id,
    2.49,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'seguros.ifranco@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 165/692: 1-16-56181 - CAROLINA ISABEL VLIEG QUIROS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 166)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'seguros.ifranco@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.72 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-56181'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-56181';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CAROLINA ISABEL VLIEG QUIROS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-56181', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-56181';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-56181', 
    'CAROLINA ISABEL VLIEG QUIROS', 
    v_insurer_id, 
    v_broker_id,
    8.72,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'seguros.ifranco@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 166/692: 02B257264 - MARIA ALEJANDRA ORTIZ DIAZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 167)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'ingridhim@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 6.99 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B257264'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-02-21', start_date),
      renewal_date = COALESCE('2026-02-21', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B257264';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MARIA ALEJANDRA ORTIZ DIAZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B257264', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-02-21', '2026-02-21', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B257264';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B257264', 
    'MARIA ALEJANDRA ORTIZ DIAZ', 
    v_insurer_id, 
    v_broker_id,
    6.99,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'ingridhim@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 167/692: 03G31142 - FANY ITZEL ALONZO PEREZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 168)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'ingridhim@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 1.31 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '03G31142'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-13', start_date),
      renewal_date = COALESCE('2026-09-13', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 03G31142';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('FANY ITZEL ALONZO PEREZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '03G31142', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-13', '2026-09-13', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 03G31142';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '03G31142', 
    'FANY ITZEL ALONZO PEREZ', 
    v_insurer_id, 
    v_broker_id,
    1.31,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'ingridhim@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 168/692: 0220-02430-09 - EDELIA MARIA ALVARADO  DE RODRIGUEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 169)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'ingridhim@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 7.23 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0220-02430-09'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0220-02430-09';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('EDELIA MARIA ALVARADO  DE RODRIGUEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0220-02430-09', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0220-02430-09';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0220-02430-09', 
    'EDELIA MARIA ALVARADO  DE RODRIGUEZ', 
    v_insurer_id, 
    v_broker_id,
    7.23,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'ingridhim@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 169/692: 0221-03095-09 - ALEXANDER  ORTIZ BECERRA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 170)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'ingridhim@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 13.85 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0221-03095-09'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0221-03095-09';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ALEXANDER  ORTIZ BECERRA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0221-03095-09', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0221-03095-09';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0221-03095-09', 
    'ALEXANDER  ORTIZ BECERRA', 
    v_insurer_id, 
    v_broker_id,
    13.85,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'ingridhim@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 170/692: 04-05-1741658-1 - AZAEL SALDA�A CASTILLO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 171)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'ingridhim@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 13.21 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-05-1741658-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-21', start_date),
      renewal_date = COALESCE('2026-09-21', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-05-1741658-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('AZAEL SALDA�A CASTILLO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-05-1741658-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-21', '2026-09-21', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-05-1741658-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-05-1741658-1', 
    'AZAEL SALDA�A CASTILLO', 
    v_insurer_id, 
    v_broker_id,
    13.21,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'ingridhim@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 171/692: 14B61805 - QIU LIAN WANG DE ZHANG
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 172)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'iriamgp@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 20.3 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B61805'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-05-03', start_date),
      renewal_date = COALESCE('2026-05-03', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B61805';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('QIU LIAN WANG DE ZHANG', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B61805', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-05-03', '2026-05-03', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B61805';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B61805', 
    'QIU LIAN WANG DE ZHANG', 
    v_insurer_id, 
    v_broker_id,
    20.3,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'iriamgp@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 172/692: 14B62247 - WEI FENG ZHANG
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 173)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'iriamgp@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 16.1 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B62247'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-03', start_date),
      renewal_date = COALESCE('2026-07-03', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B62247';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('WEI FENG ZHANG', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B62247', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-03', '2026-07-03', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B62247';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B62247', 
    'WEI FENG ZHANG', 
    v_insurer_id, 
    v_broker_id,
    16.1,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'iriamgp@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 173/692: 02BR2927310 - ABEL ABDIEL CEBALLOS MARTINEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 174)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'itzygarciadeparedes@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 17.46 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02BR2927310'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-11', start_date),
      renewal_date = COALESCE('2026-11-11', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02BR2927310';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ABEL ABDIEL CEBALLOS MARTINEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02BR2927310', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-11', '2026-11-11', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02BR2927310';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02BR2927310', 
    'ABEL ABDIEL CEBALLOS MARTINEZ', 
    v_insurer_id, 
    v_broker_id,
    17.46,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'itzygarciadeparedes@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 174/692: 02B211639 - ISOMERY ISABEL NAVARRO BARBA DE DE GRACIA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 175)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'itzygarciadeparedes@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.48 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B211639'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-14', start_date),
      renewal_date = COALESCE('2026-09-14', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B211639';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ISOMERY ISABEL NAVARRO BARBA DE DE GRACIA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B211639', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-14', '2026-09-14', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B211639';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B211639', 
    'ISOMERY ISABEL NAVARRO BARBA DE DE GRACIA', 
    v_insurer_id, 
    v_broker_id,
    9.48,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'itzygarciadeparedes@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 175/692: 04-04-1214572-2 - FATIMA VALDES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 176)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'itzygarciadeparedes@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := -0.83 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-1214572-2'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2024-08-03', start_date),
      renewal_date = COALESCE('2025-08-03', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-1214572-2';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('FATIMA VALDES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-1214572-2', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2024-08-03', '2025-08-03', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-1214572-2';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-1214572-2', 
    'FATIMA VALDES', 
    v_insurer_id, 
    v_broker_id,
    -0.83,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'itzygarciadeparedes@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 176/692: 04-04-1214572-3 - FATIMA VALDES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 177)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'itzygarciadeparedes@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.83 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-1214572-3'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-08-03', start_date),
      renewal_date = COALESCE('2026-08-03', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-1214572-3';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('FATIMA VALDES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-1214572-3', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-08-03', '2026-08-03', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-1214572-3';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-1214572-3', 
    'FATIMA VALDES', 
    v_insurer_id, 
    v_broker_id,
    0.83,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'itzygarciadeparedes@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 177/692: 04-04-1214572-3 - FATIMA VALDES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 178)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'itzygarciadeparedes@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.06 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-1214572-3'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-08-03', start_date),
      renewal_date = COALESCE('2026-08-03', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-1214572-3';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('FATIMA VALDES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-1214572-3', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-08-03', '2026-08-03', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-1214572-3';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-1214572-3', 
    'FATIMA VALDES', 
    v_insurer_id, 
    v_broker_id,
    9.06,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'itzygarciadeparedes@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 178/692: 04-04-1440746-2 - PAOLA PADILLA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 179)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'itzygarciadeparedes@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.97 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-1440746-2'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-13', start_date),
      renewal_date = COALESCE('2026-09-13', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-1440746-2';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('PAOLA PADILLA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-1440746-2', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-13', '2026-09-13', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-1440746-2';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-1440746-2', 
    'PAOLA PADILLA', 
    v_insurer_id, 
    v_broker_id,
    8.97,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'itzygarciadeparedes@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 179/692: 02-48-0836272-4 - ARLIN LIU
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 180)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'itzygarciadeparedes@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 4.92 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-48-0836272-4'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-48-0836272-4';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ARLIN LIU', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-48-0836272-4', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-48-0836272-4';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-48-0836272-4', 
    'ARLIN LIU', 
    v_insurer_id, 
    v_broker_id,
    4.92,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'itzygarciadeparedes@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 180/692: 1-16-30413 - YAMILETH GARCIA MENDOZA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 181)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'itzygarciadeparedes@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10.12 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-30413'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-30413';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('YAMILETH GARCIA MENDOZA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-30413', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-30413';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-30413', 
    'YAMILETH GARCIA MENDOZA', 
    v_insurer_id, 
    v_broker_id,
    10.12,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'itzygarciadeparedes@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 181/692: 14B24198 - ERIKA YANIBETH VELASQUEZ BATISTA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 182)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kips020969@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'SALUD' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.56 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B24198'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-03-28', start_date),
      renewal_date = COALESCE('2026-03-28', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B24198';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ERIKA YANIBETH VELASQUEZ BATISTA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B24198', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-03-28', '2026-03-28', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B24198';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B24198', 
    'ERIKA YANIBETH VELASQUEZ BATISTA', 
    v_insurer_id, 
    v_broker_id,
    0.56,
    jsonb_build_object(
      'policy_type', 'SALUD',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kips020969@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 182/692: 02B3396836 - JAVIER ADRIAN MARTINEZ RIVERA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 183)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kips020969@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.58 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3396836'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-14', start_date),
      renewal_date = COALESCE('2026-11-14', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3396836';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JAVIER ADRIAN MARTINEZ RIVERA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3396836', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-14', '2026-11-14', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3396836';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3396836', 
    'JAVIER ADRIAN MARTINEZ RIVERA', 
    v_insurer_id, 
    v_broker_id,
    9.58,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kips020969@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 183/692: 1-16-64119 - KAREN NICOLE MARTINEZ PROFFITT
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 184)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kips020969@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 12.73 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-64119'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-64119';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('KAREN NICOLE MARTINEZ PROFFITT', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-64119', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-64119';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-64119', 
    'KAREN NICOLE MARTINEZ PROFFITT', 
    v_insurer_id, 
    v_broker_id,
    12.73,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kips020969@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 184/692: 1-30-670176 - PAULINA DEL CARMEN ARGOTE  DE CARDOZE
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 185)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kips020969@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 6.57 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-30-670176'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-30-670176';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('PAULINA DEL CARMEN ARGOTE  DE CARDOZE', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-30-670176', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-30-670176';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-30-670176', 
    'PAULINA DEL CARMEN ARGOTE  DE CARDOZE', 
    v_insurer_id, 
    v_broker_id,
    6.57,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kips020969@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 185/692: 02B264073 - YARIELA LINETH HERRERA RODRIGUEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 186)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'javiersamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'AUTO' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 16.04 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B264073'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-25', start_date),
      renewal_date = COALESCE('2026-07-25', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B264073';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('YARIELA LINETH HERRERA RODRIGUEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B264073', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-25', '2026-07-25', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B264073';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B264073', 
    'YARIELA LINETH HERRERA RODRIGUEZ', 
    v_insurer_id, 
    v_broker_id,
    16.04,
    jsonb_build_object(
      'policy_type', 'AUTO',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'javiersamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 186/692: 02B3328707 - GLAUCE SILVA DE HERNANDEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 187)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'javiersamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 6.25 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3328707'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-10-15', start_date),
      renewal_date = COALESCE('2026-10-15', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3328707';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('GLAUCE SILVA DE HERNANDEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3328707', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-10-15', '2026-10-15', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3328707';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3328707', 
    'GLAUCE SILVA DE HERNANDEZ', 
    v_insurer_id, 
    v_broker_id,
    6.25,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'javiersamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 187/692: 02B3403952 - TAYLIN LEDEZMA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 188)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'javiersamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 14.37 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3403952'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-02-06', start_date),
      renewal_date = COALESCE('2026-02-06', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3403952';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('TAYLIN LEDEZMA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3403952', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-02-06', '2026-02-06', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3403952';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3403952', 
    'TAYLIN LEDEZMA', 
    v_insurer_id, 
    v_broker_id,
    14.37,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'javiersamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 188/692: 0219-02743-09 - ISABEL VICTORIA SOSA SANCHEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 189)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'javiersamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 6.84 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0219-02743-09'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0219-02743-09';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ISABEL VICTORIA SOSA SANCHEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0219-02743-09', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0219-02743-09';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0219-02743-09', 
    'ISABEL VICTORIA SOSA SANCHEZ', 
    v_insurer_id, 
    v_broker_id,
    6.84,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'javiersamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 189/692: 0222-00832-10 - MITCHELL CATTALYN SMITH CASTILLERO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 190)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'javiersamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 1.98 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0222-00832-10'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0222-00832-10';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MITCHELL CATTALYN SMITH CASTILLERO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0222-00832-10', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0222-00832-10';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0222-00832-10', 
    'MITCHELL CATTALYN SMITH CASTILLERO', 
    v_insurer_id, 
    v_broker_id,
    1.98,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'javiersamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 190/692: 0224-08775-09 - DALEL ISSA ZEGARRA LEDEZMA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 191)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'javiersamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10.79 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0224-08775-09'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0224-08775-09';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('DALEL ISSA ZEGARRA LEDEZMA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0224-08775-09', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0224-08775-09';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0224-08775-09', 
    'DALEL ISSA ZEGARRA LEDEZMA', 
    v_insurer_id, 
    v_broker_id,
    10.79,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'javiersamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 191/692: 0222-00832-10 - MITCHELL CATTALYN SMITH CASTILLERO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 192)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'javiersamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 2.27 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0222-00832-10'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0222-00832-10';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MITCHELL CATTALYN SMITH CASTILLERO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0222-00832-10', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0222-00832-10';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0222-00832-10', 
    'MITCHELL CATTALYN SMITH CASTILLERO', 
    v_insurer_id, 
    v_broker_id,
    2.27,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'javiersamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 192/692: 0218-03996-09 - EMELDA ESTHER PEREZ GALVEZ DE MARTI
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 193)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'javiersamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.21 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0218-03996-09'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0218-03996-09';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('EMELDA ESTHER PEREZ GALVEZ DE MARTI', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0218-03996-09', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0218-03996-09';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0218-03996-09', 
    'EMELDA ESTHER PEREZ GALVEZ DE MARTI', 
    v_insurer_id, 
    v_broker_id,
    8.21,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'javiersamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 193/692: 04-04-1232288-3 - ARIEL SOTO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 194)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'javiersamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 7.44 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-1232288-3'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-12', start_date),
      renewal_date = COALESCE('2026-09-12', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-1232288-3';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ARIEL SOTO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-1232288-3', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-12', '2026-09-12', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-1232288-3';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-1232288-3', 
    'ARIEL SOTO', 
    v_insurer_id, 
    v_broker_id,
    7.44,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'javiersamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 194/692: 04-04-1069162-4 - DIMAS DE GRACIA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 195)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'javiersamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 6.75 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-1069162-4'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-03', start_date),
      renewal_date = COALESCE('2026-07-03', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-1069162-4';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('DIMAS DE GRACIA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-1069162-4', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-03', '2026-07-03', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-1069162-4';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-1069162-4', 
    'DIMAS DE GRACIA', 
    v_insurer_id, 
    v_broker_id,
    6.75,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'javiersamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 195/692: 1-16-68402 - EDUARDO AUGUSTO  ARRUE HUERTA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 196)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'javiersamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 13.73 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-68402'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-68402';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('EDUARDO AUGUSTO  ARRUE HUERTA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-68402', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-68402';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-68402', 
    'EDUARDO AUGUSTO  ARRUE HUERTA', 
    v_insurer_id, 
    v_broker_id,
    13.73,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'javiersamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 196/692: 5-30-28322 - YENIFER DEL CARMEN MENDOZA ARCIA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 197)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'javiersamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.33 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '5-30-28322'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 5-30-28322';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('YENIFER DEL CARMEN MENDOZA ARCIA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '5-30-28322', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 5-30-28322';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '5-30-28322', 
    'YENIFER DEL CARMEN MENDOZA ARCIA', 
    v_insurer_id, 
    v_broker_id,
    11.33,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'javiersamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 197/692: 2133707 - MARIA PAULA  GOYENECHE MONTOYA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'REGIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: REGIONAL (fila 198)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'javiersamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('REGIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 5.01 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2133707'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2133707';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MARIA PAULA  GOYENECHE MONTOYA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2133707', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2133707';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2133707', 
    'MARIA PAULA  GOYENECHE MONTOYA', 
    v_insurer_id, 
    v_broker_id,
    5.01,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'javiersamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 198/692: 18980 - DELLA SERA SAEZ CAROLINA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'VIVIR' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: VIVIR (fila 199)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'javiersamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('VIVIR' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 5.15 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '18980'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 18980';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('DELLA SERA SAEZ CAROLINA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '18980', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 18980';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '18980', 
    'DELLA SERA SAEZ CAROLINA', 
    v_insurer_id, 
    v_broker_id,
    5.15,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'javiersamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 199/692: 18980 - DELLA SERA SAEZ CAROLINA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'VIVIR' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: VIVIR (fila 200)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'javiersamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('VIVIR' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 5.15 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '18980'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 18980';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('DELLA SERA SAEZ CAROLINA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '18980', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 18980';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '18980', 
    'DELLA SERA SAEZ CAROLINA', 
    v_insurer_id, 
    v_broker_id,
    5.15,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'javiersamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 200/692: 12798 - DOMINGUEZ MARIN GUSTAVO A
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'VIVIR' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: VIVIR (fila 201)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'javiersamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('VIVIR' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.86 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '12798'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 12798';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('DOMINGUEZ MARIN GUSTAVO A', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '12798', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 12798';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '12798', 
    'DOMINGUEZ MARIN GUSTAVO A', 
    v_insurer_id, 
    v_broker_id,
    11.86,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'javiersamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 201/692: 12798 - DOMINGUEZ MARIN GUSTAVO A
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'VIVIR' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: VIVIR (fila 202)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'javiersamudio@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('VIVIR' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.86 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '12798'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 12798';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('DOMINGUEZ MARIN GUSTAVO A', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '12798', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 12798';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '12798', 
    'DOMINGUEZ MARIN GUSTAVO A', 
    v_insurer_id, 
    v_broker_id,
    11.86,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'javiersamudio@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 202/692: 70B26075 - JAZMIN CAMILO MENESES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 203)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'jazminkmilo@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.5 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '70B26075'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-13', start_date),
      renewal_date = COALESCE('2026-09-13', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 70B26075';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JAZMIN CAMILO MENESES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '70B26075', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-13', '2026-09-13', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 70B26075';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '70B26075', 
    'JAZMIN CAMILO MENESES', 
    v_insurer_id, 
    v_broker_id,
    8.5,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'jazminkmilo@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 203/692: 60B23531 - JAZMIN CAMILO MENESES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 204)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'jazminkmilo@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.21 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '60B23531'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-05-14', start_date),
      renewal_date = COALESCE('2026-05-14', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 60B23531';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JAZMIN CAMILO MENESES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '60B23531', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-05-14', '2026-05-14', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 60B23531';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '60B23531', 
    'JAZMIN CAMILO MENESES', 
    v_insurer_id, 
    v_broker_id,
    0.21,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'jazminkmilo@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 204/692: 0221-03261-09 - SONIA EMERITA MADRID MARQUEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 205)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'jazminkmilo@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 54.42 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0221-03261-09'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0221-03261-09';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('SONIA EMERITA MADRID MARQUEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0221-03261-09', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0221-03261-09';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0221-03261-09', 
    'SONIA EMERITA MADRID MARQUEZ', 
    v_insurer_id, 
    v_broker_id,
    54.42,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'jazminkmilo@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 205/692: 0218-03908-09 - ROBERTO  ALBO RIVERA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 206)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'jazminkmilo@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 6.6 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0218-03908-09'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0218-03908-09';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ROBERTO  ALBO RIVERA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0218-03908-09', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0218-03908-09';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0218-03908-09', 
    'ROBERTO  ALBO RIVERA', 
    v_insurer_id, 
    v_broker_id,
    6.6,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'jazminkmilo@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 206/692: 04-72-1946563-0 - ERASMO SANCHEZ NORIEGA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 207)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'josep1219@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 13.29 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-72-1946563-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-06-17', start_date),
      renewal_date = COALESCE('2026-06-17', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-72-1946563-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ERASMO SANCHEZ NORIEGA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-72-1946563-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-06-17', '2026-06-17', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-72-1946563-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-72-1946563-0', 
    'ERASMO SANCHEZ NORIEGA', 
    v_insurer_id, 
    v_broker_id,
    13.29,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'josep1219@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 207/692: 03B77169 - SERGIO RUBEN NAVARRO ORTIZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 208)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 4.23 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '03B77169'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-04-09', start_date),
      renewal_date = COALESCE('2026-04-09', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 03B77169';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('SERGIO RUBEN NAVARRO ORTIZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '03B77169', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-04-09', '2026-04-09', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 03B77169';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '03B77169', 
    'SERGIO RUBEN NAVARRO ORTIZ', 
    v_insurer_id, 
    v_broker_id,
    4.23,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 208/692: 03B99832 - YOSMELIS DEL CARMEN VARGAS CAMPOS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 209)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 3.49 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '03B99832'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-10-25', start_date),
      renewal_date = COALESCE('2026-10-25', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 03B99832';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('YOSMELIS DEL CARMEN VARGAS CAMPOS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '03B99832', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-10-25', '2026-10-25', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 03B99832';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '03B99832', 
    'YOSMELIS DEL CARMEN VARGAS CAMPOS', 
    v_insurer_id, 
    v_broker_id,
    3.49,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 209/692: 02B3360857 - MIOZOTI BARRERA DE GARRIDO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 210)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.69 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3360857'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-08-05', start_date),
      renewal_date = COALESCE('2026-08-05', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3360857';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MIOZOTI BARRERA DE GARRIDO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3360857', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-08-05', '2026-08-05', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3360857';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3360857', 
    'MIOZOTI BARRERA DE GARRIDO', 
    v_insurer_id, 
    v_broker_id,
    11.69,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 210/692: 02B3393374 - WILLIAN FITERE MORALES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 211)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.61 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3393374'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-10-04', start_date),
      renewal_date = COALESCE('2026-10-04', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3393374';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('WILLIAN FITERE MORALES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3393374', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-10-04', '2026-10-04', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3393374';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3393374', 
    'WILLIAN FITERE MORALES', 
    v_insurer_id, 
    v_broker_id,
    9.61,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 211/692: 02B3418205 - WILLIAN FITERE MORALES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 212)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 4.21 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3418205'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-04', start_date),
      renewal_date = COALESCE('2026-07-04', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3418205';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('WILLIAN FITERE MORALES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3418205', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-04', '2026-07-04', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3418205';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3418205', 
    'WILLIAN FITERE MORALES', 
    v_insurer_id, 
    v_broker_id,
    4.21,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 212/692: 02B3390878 - WILLIAN FITERE MORALES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 213)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10.29 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3390878'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-02', start_date),
      renewal_date = COALESCE('2026-09-02', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3390878';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('WILLIAN FITERE MORALES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3390878', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-02', '2026-09-02', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3390878';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3390878', 
    'WILLIAN FITERE MORALES', 
    v_insurer_id, 
    v_broker_id,
    10.29,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 213/692: 02B3412469 - WILLIAN FITERE MORALES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 214)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 13.07 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3412469'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-05-06', start_date),
      renewal_date = COALESCE('2026-05-06', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3412469';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('WILLIAN FITERE MORALES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3412469', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-05-06', '2026-05-06', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3412469';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3412469', 
    'WILLIAN FITERE MORALES', 
    v_insurer_id, 
    v_broker_id,
    13.07,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 214/692: 02B3415368 - WILLIAN FITERE MORALES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 215)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 13.07 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3415368'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-06-05', start_date),
      renewal_date = COALESCE('2026-06-05', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3415368';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('WILLIAN FITERE MORALES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3415368', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-06-05', '2026-06-05', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3415368';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3415368', 
    'WILLIAN FITERE MORALES', 
    v_insurer_id, 
    v_broker_id,
    13.07,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 215/692: 02B3362904 - WILLIAN FITERE MORALES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 216)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 14.03 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3362904'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-07', start_date),
      renewal_date = COALESCE('2026-09-07', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3362904';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('WILLIAN FITERE MORALES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3362904', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-07', '2026-09-07', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3362904';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3362904', 
    'WILLIAN FITERE MORALES', 
    v_insurer_id, 
    v_broker_id,
    14.03,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 216/692: 02B3346306 - CELINA ELIZABETH ABBOTT ALEMAN
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 217)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 23.58 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3346306'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2024-11-30', start_date),
      renewal_date = COALESCE('2025-11-30', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3346306';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CELINA ELIZABETH ABBOTT ALEMAN', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3346306', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2024-11-30', '2025-11-30', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3346306';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3346306', 
    'CELINA ELIZABETH ABBOTT ALEMAN', 
    v_insurer_id, 
    v_broker_id,
    23.58,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 217/692: 02B3424665 - WILLIAN FITERE MORALES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 218)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 15.49 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3424665'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-13', start_date),
      renewal_date = COALESCE('2026-09-13', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3424665';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('WILLIAN FITERE MORALES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3424665', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-13', '2026-09-13', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3424665';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3424665', 
    'WILLIAN FITERE MORALES', 
    v_insurer_id, 
    v_broker_id,
    15.49,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 218/692: 02B3430256 - WILLIAN FITERE MORALES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 219)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 15.48 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3430256'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-12', start_date),
      renewal_date = COALESCE('2026-11-12', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3430256';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('WILLIAN FITERE MORALES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3430256', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-12', '2026-11-12', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3430256';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3430256', 
    'WILLIAN FITERE MORALES', 
    v_insurer_id, 
    v_broker_id,
    15.48,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 219/692: 02B3417098 - EDUARDO PEREZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 220)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.2 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3417098'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-06-25', start_date),
      renewal_date = COALESCE('2026-06-25', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3417098';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('EDUARDO PEREZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3417098', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-06-25', '2026-06-25', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3417098';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3417098', 
    'EDUARDO PEREZ', 
    v_insurer_id, 
    v_broker_id,
    9.2,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 220/692: 02B3401892 - WILLIAN FITERE MORALES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 221)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10.41 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3401892'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-01-15', start_date),
      renewal_date = COALESCE('2026-01-15', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3401892';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('WILLIAN FITERE MORALES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3401892', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-01-15', '2026-01-15', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3401892';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3401892', 
    'WILLIAN FITERE MORALES', 
    v_insurer_id, 
    v_broker_id,
    10.41,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 221/692: 0223-02197-01 - MARCO ANTONIO HERRERA SALAZAR
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 222)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.45 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0223-02197-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0223-02197-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MARCO ANTONIO HERRERA SALAZAR', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0223-02197-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0223-02197-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0223-02197-01', 
    'MARCO ANTONIO HERRERA SALAZAR', 
    v_insurer_id, 
    v_broker_id,
    9.45,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 222/692: 04-05-2050728-0 - LESLY YOHANA PINTO RAMOS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 223)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 26.4 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-05-2050728-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-06', start_date),
      renewal_date = COALESCE('2026-11-06', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-05-2050728-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('LESLY YOHANA PINTO RAMOS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-05-2050728-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-06', '2026-11-06', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-05-2050728-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-05-2050728-0', 
    'LESLY YOHANA PINTO RAMOS', 
    v_insurer_id, 
    v_broker_id,
    26.4,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 223/692: 04-05-2049830-0 - ABRAHAM CARRASCO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 224)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 26.4 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-05-2049830-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-01', start_date),
      renewal_date = COALESCE('2026-11-01', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-05-2049830-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ABRAHAM CARRASCO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-05-2049830-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-01', '2026-11-01', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-05-2049830-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-05-2049830-0', 
    'ABRAHAM CARRASCO', 
    v_insurer_id, 
    v_broker_id,
    26.4,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 224/692: 04-04-2023308-0 - ALVARO JAVIER VEGA RAMOS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 225)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.84 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-2023308-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-29', start_date),
      renewal_date = COALESCE('2026-09-29', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-2023308-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ALVARO JAVIER VEGA RAMOS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-2023308-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-29', '2026-09-29', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-2023308-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-2023308-0', 
    'ALVARO JAVIER VEGA RAMOS', 
    v_insurer_id, 
    v_broker_id,
    8.84,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 225/692: 04-72-1723165-1 - MAYERLIN CANTO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 226)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 15.65 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-72-1723165-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-08-28', start_date),
      renewal_date = COALESCE('2026-08-28', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-72-1723165-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MAYERLIN CANTO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-72-1723165-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-08-28', '2026-08-28', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-72-1723165-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-72-1723165-1', 
    'MAYERLIN CANTO', 
    v_insurer_id, 
    v_broker_id,
    15.65,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 226/692: 04-05-2056212-0 - ROSA AURA BROWN GARCIA DE CHALMERS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 227)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 28.3 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-05-2056212-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-15', start_date),
      renewal_date = COALESCE('2026-11-15', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-05-2056212-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ROSA AURA BROWN GARCIA DE CHALMERS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-05-2056212-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-15', '2026-11-15', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-05-2056212-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-05-2056212-0', 
    'ROSA AURA BROWN GARCIA DE CHALMERS', 
    v_insurer_id, 
    v_broker_id,
    28.3,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 227/692: 04-04-771038-6 - MAYERLIN CANTO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 228)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.32 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-771038-6'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2024-11-30', start_date),
      renewal_date = COALESCE('2025-11-30', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-771038-6';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MAYERLIN CANTO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-771038-6', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2024-11-30', '2025-11-30', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-771038-6';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-771038-6', 
    'MAYERLIN CANTO', 
    v_insurer_id, 
    v_broker_id,
    11.32,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 228/692: 04-08-1631152-1 - RA�L UBARTE
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 229)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.32 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-08-1631152-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-05-03', start_date),
      renewal_date = COALESCE('2026-05-03', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-08-1631152-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('RA�L UBARTE', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-08-1631152-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-05-03', '2026-05-03', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-08-1631152-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-08-1631152-1', 
    'RA�L UBARTE', 
    v_insurer_id, 
    v_broker_id,
    11.32,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 229/692: 06-72-1774620-1 - NAYLEA ARGUELLES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 230)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 3.9 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '06-72-1774620-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-14', start_date),
      renewal_date = COALESCE('2026-11-14', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 06-72-1774620-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('NAYLEA ARGUELLES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '06-72-1774620-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-14', '2026-11-14', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 06-72-1774620-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '06-72-1774620-1', 
    'NAYLEA ARGUELLES', 
    v_insurer_id, 
    v_broker_id,
    3.9,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 230/692: 04-72-1774611-1 - NAYLEA ARGUELLES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 231)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 41.15 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-72-1774611-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-14', start_date),
      renewal_date = COALESCE('2026-11-14', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-72-1774611-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('NAYLEA ARGUELLES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-72-1774611-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-14', '2026-11-14', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-72-1774611-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-72-1774611-1', 
    'NAYLEA ARGUELLES', 
    v_insurer_id, 
    v_broker_id,
    41.15,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 231/692: 14-05-2054224-0 - CHERYYL CHAVARRIA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 232)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14-05-2054224-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-11', start_date),
      renewal_date = COALESCE('2026-11-11', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14-05-2054224-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CHERYYL CHAVARRIA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14-05-2054224-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-11', '2026-11-11', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14-05-2054224-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14-05-2054224-0', 
    'CHERYYL CHAVARRIA', 
    v_insurer_id, 
    v_broker_id,
    10,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 232/692: 04-72-1723165-1 - MAYERLIN CANTO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 233)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 15.65 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-72-1723165-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-08-28', start_date),
      renewal_date = COALESCE('2026-08-28', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-72-1723165-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MAYERLIN CANTO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-72-1723165-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-08-28', '2026-08-28', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-72-1723165-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-72-1723165-1', 
    'MAYERLIN CANTO', 
    v_insurer_id, 
    v_broker_id,
    15.65,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 233/692: 1-30-409074 - ELLEYN LISETT CEDE�O CORTES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 234)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-30-409074'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-30-409074';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ELLEYN LISETT CEDE�O CORTES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-30-409074', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-30-409074';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-30-409074', 
    'ELLEYN LISETT CEDE�O CORTES', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 234/692: 1-30-731513 - TOMASA RODRIGUEZ GONZALEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 235)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 6.91 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-30-731513'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-30-731513';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('TOMASA RODRIGUEZ GONZALEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-30-731513', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-30-731513';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-30-731513', 
    'TOMASA RODRIGUEZ GONZALEZ', 
    v_insurer_id, 
    v_broker_id,
    6.91,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 235/692: 1-30-689342 - AGUSTIN TRUDO APARICIO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 236)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 6.91 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-30-689342'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-30-689342';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('AGUSTIN TRUDO APARICIO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-30-689342', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-30-689342';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-30-689342', 
    'AGUSTIN TRUDO APARICIO', 
    v_insurer_id, 
    v_broker_id,
    6.91,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 236/692: 2163439 - BEATRIZ CAROLINA  ARISPE RIERA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'REGIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: REGIONAL (fila 237)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('REGIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 17.68 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2163439'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2163439';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('BEATRIZ CAROLINA  ARISPE RIERA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2163439', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2163439';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2163439', 
    'BEATRIZ CAROLINA  ARISPE RIERA', 
    v_insurer_id, 
    v_broker_id,
    17.68,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 237/692: 2154525 - ABDIEL ISAAC GOBEA GALLARDO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'REGIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: REGIONAL (fila 238)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('REGIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 7.58 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2154525'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2154525';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ABDIEL ISAAC GOBEA GALLARDO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2154525', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2154525';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2154525', 
    'ABDIEL ISAAC GOBEA GALLARDO', 
    v_insurer_id, 
    v_broker_id,
    7.58,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 238/692: 2181424 - "CONTRERAS VASQUEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'KATHIUSCA EUNICE"' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: KATHIUSCA EUNICE" (fila 239)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'regional' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('KATHIUSCA EUNICE"' = 'ASSA' AND 'KVSEGUROS13@GMAIL.COM' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2181424'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2181424';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('"CONTRERAS VASQUEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2181424', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2181424';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2181424', 
    '"CONTRERAS VASQUEZ', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', 'KVSEGUROS13@GMAIL.COM',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'regional'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 239/692: 2121637 - RONMEL ALBERTO BAQUEDANO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'REGIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: REGIONAL (fila 240)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('REGIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 5.19 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2121637'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2121637';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('RONMEL ALBERTO BAQUEDANO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2121637', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2121637';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2121637', 
    'RONMEL ALBERTO BAQUEDANO', 
    v_insurer_id, 
    v_broker_id,
    5.19,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 240/692: 2181894 - JOSEPH BERNARD SCHAUBER BOMPART
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'REGIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: REGIONAL (fila 241)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('REGIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 7.71 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2181894'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2181894';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JOSEPH BERNARD SCHAUBER BOMPART', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2181894', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2181894';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2181894', 
    'JOSEPH BERNARD SCHAUBER BOMPART', 
    v_insurer_id, 
    v_broker_id,
    7.71,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 241/692: 2183326 - JERRY LEIGHT ALLEN BRUCE
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'REGIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: REGIONAL (fila 242)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('REGIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10.26 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2183326'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2183326';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JERRY LEIGHT ALLEN BRUCE', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2183326', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2183326';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2183326', 
    'JERRY LEIGHT ALLEN BRUCE', 
    v_insurer_id, 
    v_broker_id,
    10.26,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 242/692: 2186056 - "CHARRY ROCHA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'DAYANA"' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: DAYANA" (fila 243)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'regional' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('DAYANA"' = 'ASSA' AND 'KVSEGUROS13@GMAIL.COM' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2186056'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2186056';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('"CHARRY ROCHA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2186056', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2186056';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2186056', 
    '"CHARRY ROCHA', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', 'KVSEGUROS13@GMAIL.COM',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'regional'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 243/692: 2187668 - ALEJANDRO ANIBAL  MENDOZA RODRIGUEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'REGIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: REGIONAL (fila 244)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('REGIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 4.51 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2187668'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2187668';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ALEJANDRO ANIBAL  MENDOZA RODRIGUEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2187668', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2187668';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2187668', 
    'ALEJANDRO ANIBAL  MENDOZA RODRIGUEZ', 
    v_insurer_id, 
    v_broker_id,
    4.51,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 244/692: 2189152 - CRISTHIAN JOSUE CAICEDO GUERRA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'REGIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: REGIONAL (fila 245)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('REGIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2189152'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2189152';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CRISTHIAN JOSUE CAICEDO GUERRA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2189152', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2189152';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2189152', 
    'CRISTHIAN JOSUE CAICEDO GUERRA', 
    v_insurer_id, 
    v_broker_id,
    10,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 245/692: 2145917 - EYDANIA YANETH CASTILLO CASTILLO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'REGIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: REGIONAL (fila 246)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('REGIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 6.46 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2145917'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2145917';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('EYDANIA YANETH CASTILLO CASTILLO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2145917', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2145917';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2145917', 
    'EYDANIA YANETH CASTILLO CASTILLO', 
    v_insurer_id, 
    v_broker_id,
    6.46,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 246/692: 2191222 - KATHERIN  JOHANA MOJICA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'REGIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: REGIONAL (fila 247)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('REGIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 7.72 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2191222'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2191222';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('KATHERIN  JOHANA MOJICA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2191222', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2191222';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2191222', 
    'KATHERIN  JOHANA MOJICA', 
    v_insurer_id, 
    v_broker_id,
    7.72,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 247/692: 06-68-0986894-2 - VALVES AND INDUSTRIAL SERVICES LEE INC
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 248)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 88.49 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '06-68-0986894-2'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 06-68-0986894-2';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('VALVES AND INDUSTRIAL SERVICES LEE INC', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '06-68-0986894-2', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 06-68-0986894-2';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '06-68-0986894-2', 
    'VALVES AND INDUSTRIAL SERVICES LEE INC', 
    v_insurer_id, 
    v_broker_id,
    88.49,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 248/692: 02-48-0868818-4 - MADELYS CAMA�O
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 249)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 21.43 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-48-0868818-4'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-48-0868818-4';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MADELYS CAMA�O', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-48-0868818-4', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-48-0868818-4';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-48-0868818-4', 
    'MADELYS CAMA�O', 
    v_insurer_id, 
    v_broker_id,
    21.43,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 249/692: 081300155427 - MIRLUZ DEL SOCORRO HERNANDEZ ROMERO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 250)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 15.04 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '081300155427'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 081300155427';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MIRLUZ DEL SOCORRO HERNANDEZ ROMERO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '081300155427', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 081300155427';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '081300155427', 
    'MIRLUZ DEL SOCORRO HERNANDEZ ROMERO', 
    v_insurer_id, 
    v_broker_id,
    15.04,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 250/692: 16868 - CHALMERS BROWN MAURICIO E
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'VIVIR' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: VIVIR (fila 251)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('VIVIR' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 5.92 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '16868'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 16868';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CHALMERS BROWN MAURICIO E', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '16868', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 16868';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '16868', 
    'CHALMERS BROWN MAURICIO E', 
    v_insurer_id, 
    v_broker_id,
    5.92,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 251/692: 8707 - CEDE�O MENDOZA LINDA CRIS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'VIVIR' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: VIVIR (fila 252)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('VIVIR' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.98 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '8707'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 8707';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CEDE�O MENDOZA LINDA CRIS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '8707', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 8707';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '8707', 
    'CEDE�O MENDOZA LINDA CRIS', 
    v_insurer_id, 
    v_broker_id,
    11.98,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 252/692: 14713 - VALDEZ MORALES KAROL NADI
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'VIVIR' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: VIVIR (fila 253)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('VIVIR' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.11 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14713'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14713';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('VALDEZ MORALES KAROL NADI', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14713', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14713';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14713', 
    'VALDEZ MORALES KAROL NADI', 
    v_insurer_id, 
    v_broker_id,
    8.11,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 253/692: 19558 - BOLOGNA NAVAS ITALO ISMAE
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'VIVIR' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: VIVIR (fila 254)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('VIVIR' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 12.84 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '19558'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 19558';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('BOLOGNA NAVAS ITALO ISMAE', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '19558', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 19558';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '19558', 
    'BOLOGNA NAVAS ITALO ISMAE', 
    v_insurer_id, 
    v_broker_id,
    12.84,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 254/692: 17184 - MONTILLA RAMIREZ ALLAN GE
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'VIVIR' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: VIVIR (fila 255)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('VIVIR' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10.73 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '17184'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 17184';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MONTILLA RAMIREZ ALLAN GE', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '17184', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 17184';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '17184', 
    'MONTILLA RAMIREZ ALLAN GE', 
    v_insurer_id, 
    v_broker_id,
    10.73,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 255/692: 15904 - CHALMERS BROWN DAVID ALEJ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'VIVIR' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: VIVIR (fila 256)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kvseguros13@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('VIVIR' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 5.92 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '15904'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 15904';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CHALMERS BROWN DAVID ALEJ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '15904', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 15904';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '15904', 
    'CHALMERS BROWN DAVID ALEJ', 
    v_insurer_id, 
    v_broker_id,
    5.92,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kvseguros13@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 256/692: 70B37705 - ESTEFANI YARIBET DELGADO DURANT
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 257)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kathrin.aguirre@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10.59 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '70B37705'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2024-12-11', start_date),
      renewal_date = COALESCE('2025-12-11', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 70B37705';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ESTEFANI YARIBET DELGADO DURANT', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '70B37705', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2024-12-11', '2025-12-11', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 70B37705';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '70B37705', 
    'ESTEFANI YARIBET DELGADO DURANT', 
    v_insurer_id, 
    v_broker_id,
    10.59,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kathrin.aguirre@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 257/692: 0225-09251-09 - ESTEFANI YARIBET DELGADO DURANT
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 258)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kathrin.aguirre@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.63 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0225-09251-09'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0225-09251-09';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ESTEFANI YARIBET DELGADO DURANT', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0225-09251-09', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0225-09251-09';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0225-09251-09', 
    'ESTEFANI YARIBET DELGADO DURANT', 
    v_insurer_id, 
    v_broker_id,
    11.63,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kathrin.aguirre@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 258/692: 04-05-1969449-0 - ANAIZ WALTER
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 259)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kathrin.aguirre@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 13.21 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-05-1969449-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-17', start_date),
      renewal_date = COALESCE('2026-07-17', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-05-1969449-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ANAIZ WALTER', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-05-1969449-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-17', '2026-07-17', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-05-1969449-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-05-1969449-0', 
    'ANAIZ WALTER', 
    v_insurer_id, 
    v_broker_id,
    13.21,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kathrin.aguirre@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 259/692: 04-18-1399554-2 - JAIRO HOMERO HARRIS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 260)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kathrin.aguirre@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 22.83 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-18-1399554-2'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-08-08', start_date),
      renewal_date = COALESCE('2026-08-08', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-18-1399554-2';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JAIRO HOMERO HARRIS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-18-1399554-2', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-08-08', '2026-08-08', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-18-1399554-2';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-18-1399554-2', 
    'JAIRO HOMERO HARRIS', 
    v_insurer_id, 
    v_broker_id,
    22.83,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kathrin.aguirre@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 260/692: 04-04-1748750-1 - IRINEA SANTAMARIA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 261)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kathrin.aguirre@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.24 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-1748750-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-30', start_date),
      renewal_date = COALESCE('2026-09-30', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-1748750-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('IRINEA SANTAMARIA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-1748750-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-30', '2026-09-30', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-1748750-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-1748750-1', 
    'IRINEA SANTAMARIA', 
    v_insurer_id, 
    v_broker_id,
    9.24,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kathrin.aguirre@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 261/692: 1-16-64336 - KATHRIN AIMEED AGUIRRE SANTAMARIA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 262)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kathrin.aguirre@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 4.73 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-64336'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-64336';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('KATHRIN AIMEED AGUIRRE SANTAMARIA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-64336', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-64336';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-64336', 
    'KATHRIN AIMEED AGUIRRE SANTAMARIA', 
    v_insurer_id, 
    v_broker_id,
    4.73,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kathrin.aguirre@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 262/692: 2157269 - SHAFIG ARAMIS BROWN RAMOS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'REGIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: REGIONAL (fila 263)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kathrin.aguirre@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('REGIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.54 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2157269'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2157269';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('SHAFIG ARAMIS BROWN RAMOS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2157269', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2157269';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2157269', 
    'SHAFIG ARAMIS BROWN RAMOS', 
    v_insurer_id, 
    v_broker_id,
    9.54,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kathrin.aguirre@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 263/692: 02B3388773 - JOYCE MARIBEL DEL CARMEN MIRANDA VEGA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 264)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'katberguido08@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 13.32 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3388773'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-08-07', start_date),
      renewal_date = COALESCE('2026-08-07', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3388773';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JOYCE MARIBEL DEL CARMEN MIRANDA VEGA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3388773', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-08-07', '2026-08-07', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3388773';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3388773', 
    'JOYCE MARIBEL DEL CARMEN MIRANDA VEGA', 
    v_insurer_id, 
    v_broker_id,
    13.32,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'katberguido08@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 264/692: 1-16-50902 - KATTIA DEL CARMEN BERGUIDO  DE JIMENEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 265)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'katberguido08@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 4.73 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-50902'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-50902';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('KATTIA DEL CARMEN BERGUIDO  DE JIMENEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-50902', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-50902';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-50902', 
    'KATTIA DEL CARMEN BERGUIDO  DE JIMENEZ', 
    v_insurer_id, 
    v_broker_id,
    4.73,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'katberguido08@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 265/692: 03030190167 - ARTURO ALEJANDRO WONG MEDINA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 266)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'katberguido08@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 2 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '03030190167'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 03030190167';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ARTURO ALEJANDRO WONG MEDINA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '03030190167', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 03030190167';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '03030190167', 
    'ARTURO ALEJANDRO WONG MEDINA', 
    v_insurer_id, 
    v_broker_id,
    2,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'katberguido08@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 266/692: 03030028477 - EDA LUCINDA MEDINA DE WONG
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 267)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'katberguido08@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 1.98 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '03030028477'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 03030028477';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('EDA LUCINDA MEDINA DE WONG', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '03030028477', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 03030028477';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '03030028477', 
    'EDA LUCINDA MEDINA DE WONG', 
    v_insurer_id, 
    v_broker_id,
    1.98,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'katberguido08@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 267/692: 03030022628 - ROXANA ISABEL AGREDA CARRILLO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 268)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'katberguido08@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.58 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '03030022628'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 03030022628';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ROXANA ISABEL AGREDA CARRILLO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '03030022628', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 03030022628';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '03030022628', 
    'ROXANA ISABEL AGREDA CARRILLO', 
    v_insurer_id, 
    v_broker_id,
    0.58,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'katberguido08@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 268/692: 081300046285 - JOHAN ANNETTE CASTILLO SALVATIERRA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 269)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'katberguido08@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 1.05 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '081300046285'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 081300046285';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JOHAN ANNETTE CASTILLO SALVATIERRA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '081300046285', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 081300046285';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '081300046285', 
    'JOHAN ANNETTE CASTILLO SALVATIERRA', 
    v_insurer_id, 
    v_broker_id,
    1.05,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'katberguido08@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 269/692: 081300046285 - JOHAN ANNETTE CASTILLO SALVATIERRA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 270)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'katberguido08@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 1.05 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '081300046285'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 081300046285';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JOHAN ANNETTE CASTILLO SALVATIERRA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '081300046285', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 081300046285';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '081300046285', 
    'JOHAN ANNETTE CASTILLO SALVATIERRA', 
    v_insurer_id, 
    v_broker_id,
    1.05,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'katberguido08@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 270/692: 03030190167 - ARTURO ALEJANDRO WONG MEDINA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 271)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'katberguido08@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 2 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '03030190167'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 03030190167';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ARTURO ALEJANDRO WONG MEDINA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '03030190167', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 03030190167';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '03030190167', 
    'ARTURO ALEJANDRO WONG MEDINA', 
    v_insurer_id, 
    v_broker_id,
    2,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'katberguido08@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 271/692: 03030028477 - EDA LUCINDA MEDINA DE WONG
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 272)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'katberguido08@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 1.38 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '03030028477'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 03030028477';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('EDA LUCINDA MEDINA DE WONG', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '03030028477', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 03030028477';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '03030028477', 
    'EDA LUCINDA MEDINA DE WONG', 
    v_insurer_id, 
    v_broker_id,
    1.38,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'katberguido08@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 272/692: 02B249813 - MATILDE YA�EZ MONTENEGRO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 273)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kgonzalezseguros@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.68 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B249813'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-10-03', start_date),
      renewal_date = COALESCE('2026-10-03', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B249813';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MATILDE YA�EZ MONTENEGRO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B249813', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-10-03', '2026-10-03', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B249813';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B249813', 
    'MATILDE YA�EZ MONTENEGRO', 
    v_insurer_id, 
    v_broker_id,
    9.68,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kgonzalezseguros@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 273/692: 1404 - MURILLO BONILLA DE RAMIRE
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'VIVIR' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: VIVIR (fila 274)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'kgonzalezseguros@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('VIVIR' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 17.25 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1404'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1404';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MURILLO BONILLA DE RAMIRE', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1404', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1404';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1404', 
    'MURILLO BONILLA DE RAMIRE', 
    v_insurer_id, 
    v_broker_id,
    17.25,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'kgonzalezseguros@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 274/692: 02B3360037 - YORLENIS ESTHER ORTIZ DE GRACIA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 275)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'ketzaseguros@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 5.66 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3360037'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-24', start_date),
      renewal_date = COALESCE('2026-07-24', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3360037';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('YORLENIS ESTHER ORTIZ DE GRACIA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3360037', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-24', '2026-07-24', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3360037';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3360037', 
    'YORLENIS ESTHER ORTIZ DE GRACIA', 
    v_insurer_id, 
    v_broker_id,
    5.66,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'ketzaseguros@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 275/692: 02B3355819 - GERARDO RIOS GUERRA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 276)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'ketzaseguros@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 6.61 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3355819'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-05-08', start_date),
      renewal_date = COALESCE('2026-05-08', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3355819';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('GERARDO RIOS GUERRA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3355819', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-05-08', '2026-05-08', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3355819';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3355819', 
    'GERARDO RIOS GUERRA', 
    v_insurer_id, 
    v_broker_id,
    6.61,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'ketzaseguros@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 276/692: 02B3424561 - ALONSO ANTONIO TAYLOR SANCHEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 277)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'ketzaseguros@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 7.69 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3424561'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-12', start_date),
      renewal_date = COALESCE('2026-09-12', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3424561';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ALONSO ANTONIO TAYLOR SANCHEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3424561', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-12', '2026-09-12', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3424561';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3424561', 
    'ALONSO ANTONIO TAYLOR SANCHEZ', 
    v_insurer_id, 
    v_broker_id,
    7.69,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'ketzaseguros@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 277/692: 02B3421982 - ALONSO ANTONIO TAYLOR SANCHEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 278)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'ketzaseguros@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 7.4 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3421982'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-08-15', start_date),
      renewal_date = COALESCE('2026-08-15', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3421982';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ALONSO ANTONIO TAYLOR SANCHEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3421982', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-08-15', '2026-08-15', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3421982';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3421982', 
    'ALONSO ANTONIO TAYLOR SANCHEZ', 
    v_insurer_id, 
    v_broker_id,
    7.4,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'ketzaseguros@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 278/692: 02B3421001 - ALONSO ANTONIO TAYLOR SANCHEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 279)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'ketzaseguros@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 6.4 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3421001'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-08-05', start_date),
      renewal_date = COALESCE('2026-08-05', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3421001';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ALONSO ANTONIO TAYLOR SANCHEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3421001', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-08-05', '2026-08-05', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3421001';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3421001', 
    'ALONSO ANTONIO TAYLOR SANCHEZ', 
    v_insurer_id, 
    v_broker_id,
    6.4,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'ketzaseguros@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 279/692: 02B3417090 - ALONSO ANTONIO TAYLOR SANCHEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 280)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'ketzaseguros@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 4.2 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3417090'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-06-24', start_date),
      renewal_date = COALESCE('2026-06-24', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3417090';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ALONSO ANTONIO TAYLOR SANCHEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3417090', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-06-24', '2026-06-24', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3417090';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3417090', 
    'ALONSO ANTONIO TAYLOR SANCHEZ', 
    v_insurer_id, 
    v_broker_id,
    4.2,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'ketzaseguros@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 280/692: 02B3409356 - ALONSO ANTONIO TAYLOR SANCHEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 281)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'ketzaseguros@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10.62 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3409356'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-04-02', start_date),
      renewal_date = COALESCE('2026-04-02', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3409356';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ALONSO ANTONIO TAYLOR SANCHEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3409356', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-04-02', '2026-04-02', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3409356';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3409356', 
    'ALONSO ANTONIO TAYLOR SANCHEZ', 
    v_insurer_id, 
    v_broker_id,
    10.62,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'ketzaseguros@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 281/692: 04-09-2012209-0 - DANIEL ROLON
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 282)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'ketzaseguros@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 15.88 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-09-2012209-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-12', start_date),
      renewal_date = COALESCE('2026-09-12', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-09-2012209-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('DANIEL ROLON', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-09-2012209-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-12', '2026-09-12', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-09-2012209-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-09-2012209-0', 
    'DANIEL ROLON', 
    v_insurer_id, 
    v_broker_id,
    15.88,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'ketzaseguros@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 282/692: 04-04-1868746-0 - KEVIN EDVARDSSON
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 283)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'ketzaseguros@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 3.77 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-1868746-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-02-26', start_date),
      renewal_date = COALESCE('2026-02-26', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-1868746-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('KEVIN EDVARDSSON', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-1868746-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-02-26', '2026-02-26', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-1868746-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-1868746-0', 
    'KEVIN EDVARDSSON', 
    v_insurer_id, 
    v_broker_id,
    3.77,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'ketzaseguros@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 283/692: 110769 - MARCEL IVAN RANGEL PORTILLO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'OPTIMA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: OPTIMA (fila 284)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'ketzaseguros@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('OPTIMA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.63 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '110769'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 110769';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MARCEL IVAN RANGEL PORTILLO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '110769', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 110769';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '110769', 
    'MARCEL IVAN RANGEL PORTILLO', 
    v_insurer_id, 
    v_broker_id,
    11.63,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'ketzaseguros@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 284/692: 11370 - REYES ALVARADO SEBASTIAN
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'VIVIR' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: VIVIR (fila 285)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('VIVIR' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 16.41 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '11370'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 11370';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('REYES ALVARADO SEBASTIAN', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '11370', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 11370';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '11370', 
    'REYES ALVARADO SEBASTIAN', 
    v_insurer_id, 
    v_broker_id,
    16.41,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 285/692: 02B262923 - MILAGROS DEL CARMEN CASTILLO RIVERA DE FIGUEROA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 286)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'AUTO' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 1.27 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B262923'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-01', start_date),
      renewal_date = COALESCE('2026-07-01', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B262923';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MILAGROS DEL CARMEN CASTILLO RIVERA DE FIGUEROA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B262923', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-01', '2026-07-01', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B262923';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B262923', 
    'MILAGROS DEL CARMEN CASTILLO RIVERA DE FIGUEROA', 
    v_insurer_id, 
    v_broker_id,
    1.27,
    jsonb_build_object(
      'policy_type', 'AUTO',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 286/692: 14B29415 - MELITZA DANELYS PINZON DIAZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 287)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.63 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B29415'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-06-04', start_date),
      renewal_date = COALESCE('2026-06-04', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B29415';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MELITZA DANELYS PINZON DIAZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B29415', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-06-04', '2026-06-04', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B29415';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B29415', 
    'MELITZA DANELYS PINZON DIAZ', 
    v_insurer_id, 
    v_broker_id,
    0.63,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 287/692: 14B52316 - VILMA ZULEIMA CABRERA MARIN
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 288)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.47 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B52316'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-03-28', start_date),
      renewal_date = COALESCE('2026-03-28', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B52316';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('VILMA ZULEIMA CABRERA MARIN', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B52316', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-03-28', '2026-03-28', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B52316';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B52316', 
    'VILMA ZULEIMA CABRERA MARIN', 
    v_insurer_id, 
    v_broker_id,
    0.47,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 288/692: 14B52316 - VILMA ZULEIMA CABRERA MARIN
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 289)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.47 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B52316'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-03-28', start_date),
      renewal_date = COALESCE('2026-03-28', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B52316';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('VILMA ZULEIMA CABRERA MARIN', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B52316', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-03-28', '2026-03-28', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B52316';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B52316', 
    'VILMA ZULEIMA CABRERA MARIN', 
    v_insurer_id, 
    v_broker_id,
    0.47,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 289/692: 60B5709 - MARISOL GOMEZ SOLIS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 290)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.08 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '60B5709'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-03-10', start_date),
      renewal_date = COALESCE('2026-03-10', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 60B5709';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MARISOL GOMEZ SOLIS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '60B5709', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-03-10', '2026-03-10', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 60B5709';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '60B5709', 
    'MARISOL GOMEZ SOLIS', 
    v_insurer_id, 
    v_broker_id,
    0.08,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 290/692: 60B5045 - JENNY ELIZABETH ABREGO ADAMES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 291)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.12 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '60B5045'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-10-07', start_date),
      renewal_date = COALESCE('2026-10-07', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 60B5045';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JENNY ELIZABETH ABREGO ADAMES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '60B5045', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-10-07', '2026-10-07', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 60B5045';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '60B5045', 
    'JENNY ELIZABETH ABREGO ADAMES', 
    v_insurer_id, 
    v_broker_id,
    0.12,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 291/692: 60B5708 - ALEXIS PINEDA FAJARDO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 292)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.16 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '60B5708'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-03-21', start_date),
      renewal_date = COALESCE('2026-03-21', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 60B5708';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ALEXIS PINEDA FAJARDO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '60B5708', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-03-21', '2026-03-21', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 60B5708';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '60B5708', 
    'ALEXIS PINEDA FAJARDO', 
    v_insurer_id, 
    v_broker_id,
    0.16,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 292/692: 60B18032 - LUIS ALBERTO RIVERA RODRIGUEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 293)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.04 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '60B18032'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-04-01', start_date),
      renewal_date = COALESCE('2026-04-01', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 60B18032';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('LUIS ALBERTO RIVERA RODRIGUEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '60B18032', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-04-01', '2026-04-01', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 60B18032';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '60B18032', 
    'LUIS ALBERTO RIVERA RODRIGUEZ', 
    v_insurer_id, 
    v_broker_id,
    0.04,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 293/692: 14B50039 - ALISMIRA ARSIRIA BONILLA LLIBRE
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 294)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.49 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B50039'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-06-04', start_date),
      renewal_date = COALESCE('2026-06-04', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B50039';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ALISMIRA ARSIRIA BONILLA LLIBRE', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B50039', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-06-04', '2026-06-04', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B50039';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B50039', 
    'ALISMIRA ARSIRIA BONILLA LLIBRE', 
    v_insurer_id, 
    v_broker_id,
    0.49,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 294/692: 14B50284 - ENILDA JUDITH MAURE DE GONZALEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 295)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.66 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B50284'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-06', start_date),
      renewal_date = COALESCE('2026-07-06', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B50284';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ENILDA JUDITH MAURE DE GONZALEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B50284', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-06', '2026-07-06', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B50284';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B50284', 
    'ENILDA JUDITH MAURE DE GONZALEZ', 
    v_insurer_id, 
    v_broker_id,
    0.66,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 295/692: 14B43600 - LUIS ALBERTO RIVERA RODRIGUEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 296)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.75 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B43600'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-03-25', start_date),
      renewal_date = COALESCE('2026-03-25', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B43600';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('LUIS ALBERTO RIVERA RODRIGUEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B43600', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-03-25', '2026-03-25', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B43600';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B43600', 
    'LUIS ALBERTO RIVERA RODRIGUEZ', 
    v_insurer_id, 
    v_broker_id,
    0.75,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 296/692: 14B49126 - VICTOR RIGOBERTO REYES VALDIVIA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 297)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.6 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B49126'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-02-10', start_date),
      renewal_date = COALESCE('2026-02-10', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B49126';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('VICTOR RIGOBERTO REYES VALDIVIA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B49126', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-02-10', '2026-02-10', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B49126';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B49126', 
    'VICTOR RIGOBERTO REYES VALDIVIA', 
    v_insurer_id, 
    v_broker_id,
    0.6,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 297/692: 14B29247 - NORA IVONNE ARAUZ SALOM
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 298)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 1.21 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B29247'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-05-02', start_date),
      renewal_date = COALESCE('2026-05-02', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B29247';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('NORA IVONNE ARAUZ SALOM', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B29247', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-05-02', '2026-05-02', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B29247';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B29247', 
    'NORA IVONNE ARAUZ SALOM', 
    v_insurer_id, 
    v_broker_id,
    1.21,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 298/692: 14B27498 - YAHAIRA INDIRA SANJUR ARAICA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 299)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.66 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B27498'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-05-19', start_date),
      renewal_date = COALESCE('2026-05-19', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B27498';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('YAHAIRA INDIRA SANJUR ARAICA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B27498', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-05-19', '2026-05-19', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B27498';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B27498', 
    'YAHAIRA INDIRA SANJUR ARAICA', 
    v_insurer_id, 
    v_broker_id,
    0.66,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 299/692: 14B28427 - MONICA ISABEL ROBINSON CAMARENA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 300)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.73 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B28427'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-01', start_date),
      renewal_date = COALESCE('2026-11-01', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B28427';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MONICA ISABEL ROBINSON CAMARENA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B28427', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-01', '2026-11-01', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B28427';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B28427', 
    'MONICA ISABEL ROBINSON CAMARENA', 
    v_insurer_id, 
    v_broker_id,
    0.73,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 300/692: 14B28443 - ROSEMARY LUISA SAMUDIO DIAZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 301)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.6 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B28443'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-08', start_date),
      renewal_date = COALESCE('2026-11-08', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B28443';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ROSEMARY LUISA SAMUDIO DIAZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B28443', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-08', '2026-11-08', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B28443';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B28443', 
    'ROSEMARY LUISA SAMUDIO DIAZ', 
    v_insurer_id, 
    v_broker_id,
    0.6,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 301/692: 14B32945 - HAMARA ELVITA LOBO CASAS DE GORRICHATEGUI
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 302)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.53 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B32945'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-03-26', start_date),
      renewal_date = COALESCE('2026-03-26', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B32945';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('HAMARA ELVITA LOBO CASAS DE GORRICHATEGUI', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B32945', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-03-26', '2026-03-26', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B32945';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B32945', 
    'HAMARA ELVITA LOBO CASAS DE GORRICHATEGUI', 
    v_insurer_id, 
    v_broker_id,
    0.53,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 302/692: 14B33471 - CAROLINA MABEL DECEREGA GARCIA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 303)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.64 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B33471'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-06-19', start_date),
      renewal_date = COALESCE('2026-06-19', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B33471';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CAROLINA MABEL DECEREGA GARCIA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B33471', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-06-19', '2026-06-19', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B33471';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B33471', 
    'CAROLINA MABEL DECEREGA GARCIA', 
    v_insurer_id, 
    v_broker_id,
    0.64,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 303/692: 60B5046 - ORIBEL ANTONIO FRIAS PE�ALBA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 304)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.13 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '60B5046'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-10-07', start_date),
      renewal_date = COALESCE('2026-10-07', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 60B5046';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ORIBEL ANTONIO FRIAS PE�ALBA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '60B5046', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-10-07', '2026-10-07', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 60B5046';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '60B5046', 
    'ORIBEL ANTONIO FRIAS PE�ALBA', 
    v_insurer_id, 
    v_broker_id,
    0.13,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 304/692: 14B28280 - MICHELLE ELENA GONZALEZ ALVARADO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 305)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 1.07 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B28280'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-10-11', start_date),
      renewal_date = COALESCE('2026-10-11', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B28280';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MICHELLE ELENA GONZALEZ ALVARADO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B28280', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-10-11', '2026-10-11', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B28280';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B28280', 
    'MICHELLE ELENA GONZALEZ ALVARADO', 
    v_insurer_id, 
    v_broker_id,
    1.07,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 305/692: 14B21188 - JESSICA DEL CARMEN SUAREZ CHONG
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 306)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.7 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B21188'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-04-14', start_date),
      renewal_date = COALESCE('2026-04-14', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B21188';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JESSICA DEL CARMEN SUAREZ CHONG', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B21188', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-04-14', '2026-04-14', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B21188';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B21188', 
    'JESSICA DEL CARMEN SUAREZ CHONG', 
    v_insurer_id, 
    v_broker_id,
    0.7,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 306/692: 14B26813 - LORENZO ALONSO BARRAZA SERRACIN
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 307)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.53 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B26813'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-01-19', start_date),
      renewal_date = COALESCE('2026-01-19', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B26813';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('LORENZO ALONSO BARRAZA SERRACIN', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B26813', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-01-19', '2026-01-19', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B26813';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B26813', 
    'LORENZO ALONSO BARRAZA SERRACIN', 
    v_insurer_id, 
    v_broker_id,
    0.53,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 307/692: 14B30153 - FRANCISCO APARICIO ORTEGA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 308)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.37 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B30153'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-17', start_date),
      renewal_date = COALESCE('2026-11-17', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B30153';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('FRANCISCO APARICIO ORTEGA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B30153', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-17', '2026-11-17', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B30153';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B30153', 
    'FRANCISCO APARICIO ORTEGA', 
    v_insurer_id, 
    v_broker_id,
    0.37,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 308/692: 02B3358848 - EDISON PLINIO BROCE AGUILAR
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 309)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 7.91 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3358848'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-04', start_date),
      renewal_date = COALESCE('2026-07-04', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3358848';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('EDISON PLINIO BROCE AGUILAR', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3358848', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-04', '2026-07-04', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3358848';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3358848', 
    'EDISON PLINIO BROCE AGUILAR', 
    v_insurer_id, 
    v_broker_id,
    7.91,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 309/692: 02B3349924 - SUSANA BAROUH ZORRILLA DE MONTERO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 310)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 6.8 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3349924'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-02-13', start_date),
      renewal_date = COALESCE('2026-02-13', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3349924';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('SUSANA BAROUH ZORRILLA DE MONTERO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3349924', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-02-13', '2026-02-13', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3349924';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3349924', 
    'SUSANA BAROUH ZORRILLA DE MONTERO', 
    v_insurer_id, 
    v_broker_id,
    6.8,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 310/692: 03B92886 - JOSELINE MAYBETH CASTILLO MURILLO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 311)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 2.06 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '03B92886'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-03-01', start_date),
      renewal_date = COALESCE('2026-03-01', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 03B92886';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JOSELINE MAYBETH CASTILLO MURILLO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '03B92886', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-03-01', '2026-03-01', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 03B92886';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '03B92886', 
    'JOSELINE MAYBETH CASTILLO MURILLO', 
    v_insurer_id, 
    v_broker_id,
    2.06,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 311/692: 02B295330 - ROLANDO NEIRYS JAEN HERRERA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 312)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 6.01 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B295330'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-06-12', start_date),
      renewal_date = COALESCE('2026-06-12', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B295330';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ROLANDO NEIRYS JAEN HERRERA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B295330', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-06-12', '2026-06-12', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B295330';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B295330', 
    'ROLANDO NEIRYS JAEN HERRERA', 
    v_insurer_id, 
    v_broker_id,
    6.01,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 312/692: 02B3350646 - FERNANDO ROBERTO BESELER VALDIVIA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 313)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 16.46 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3350646'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-02-08', start_date),
      renewal_date = COALESCE('2026-02-08', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3350646';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('FERNANDO ROBERTO BESELER VALDIVIA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3350646', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-02-08', '2026-02-08', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3350646';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3350646', 
    'FERNANDO ROBERTO BESELER VALDIVIA', 
    v_insurer_id, 
    v_broker_id,
    16.46,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 313/692: 03B69594 - ROGER DAVID VERGARA BELTRAN
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 314)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 2.09 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '03B69594'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-06-24', start_date),
      renewal_date = COALESCE('2026-06-24', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 03B69594';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ROGER DAVID VERGARA BELTRAN', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '03B69594', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-06-24', '2026-06-24', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 03B69594';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '03B69594', 
    'ROGER DAVID VERGARA BELTRAN', 
    v_insurer_id, 
    v_broker_id,
    2.09,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 314/692: 02B3342918 - FRANKLIN RAMON GONZALEZ GIL
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 315)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 7.55 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3342918'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-30', start_date),
      renewal_date = COALESCE('2026-09-30', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3342918';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('FRANKLIN RAMON GONZALEZ GIL', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3342918', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-30', '2026-09-30', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3342918';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3342918', 
    'FRANKLIN RAMON GONZALEZ GIL', 
    v_insurer_id, 
    v_broker_id,
    7.55,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 315/692: 02B289103 - ORALYS ITZEL HERNANDEZ CONCEPCION
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 316)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 21.85 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B289103'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-02-23', start_date),
      renewal_date = COALESCE('2026-02-23', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B289103';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ORALYS ITZEL HERNANDEZ CONCEPCION', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B289103', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-02-23', '2026-02-23', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B289103';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B289103', 
    'ORALYS ITZEL HERNANDEZ CONCEPCION', 
    v_insurer_id, 
    v_broker_id,
    21.85,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 316/692: 02B3386873 - ALEJANDRO MORENO AGUDELO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 317)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.74 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3386873'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-15', start_date),
      renewal_date = COALESCE('2026-07-15', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3386873';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ALEJANDRO MORENO AGUDELO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3386873', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-15', '2026-07-15', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3386873';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3386873', 
    'ALEJANDRO MORENO AGUDELO', 
    v_insurer_id, 
    v_broker_id,
    11.74,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 317/692: 02B3339030 - ROLANDO HERNANDEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 318)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.28 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3339030'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-14', start_date),
      renewal_date = COALESCE('2026-07-14', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3339030';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ROLANDO HERNANDEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3339030', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-14', '2026-07-14', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3339030';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3339030', 
    'ROLANDO HERNANDEZ', 
    v_insurer_id, 
    v_broker_id,
    9.28,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 318/692: 03B71204 - ANTONIO MURILLO VALDES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 319)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 3.59 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '03B71204'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-06-27', start_date),
      renewal_date = COALESCE('2026-06-27', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 03B71204';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ANTONIO MURILLO VALDES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '03B71204', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-06-27', '2026-06-27', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 03B71204';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '03B71204', 
    'ANTONIO MURILLO VALDES', 
    v_insurer_id, 
    v_broker_id,
    3.59,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 319/692: 14B61483 - LUZ ANGELA ROMERO PEREZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 320)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 2.21 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B61483'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-03-28', start_date),
      renewal_date = COALESCE('2026-03-28', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B61483';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('LUZ ANGELA ROMERO PEREZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B61483', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-03-28', '2026-03-28', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B61483';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B61483', 
    'LUZ ANGELA ROMERO PEREZ', 
    v_insurer_id, 
    v_broker_id,
    2.21,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 320/692: 60B23266 - ILVIS TRINIDAD ARZA PERALTA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 321)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.64 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '60B23266'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-04-21', start_date),
      renewal_date = COALESCE('2026-04-21', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 60B23266';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ILVIS TRINIDAD ARZA PERALTA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '60B23266', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-04-21', '2026-04-21', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 60B23266';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '60B23266', 
    'ILVIS TRINIDAD ARZA PERALTA', 
    v_insurer_id, 
    v_broker_id,
    0.64,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 321/692: 14B56691 - ROGELIO AUGUSTO MC KENZIE BALLESTEROS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 322)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 4.15 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B56691'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-08-10', start_date),
      renewal_date = COALESCE('2026-08-10', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B56691';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ROGELIO AUGUSTO MC KENZIE BALLESTEROS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B56691', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-08-10', '2026-08-10', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B56691';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B56691', 
    'ROGELIO AUGUSTO MC KENZIE BALLESTEROS', 
    v_insurer_id, 
    v_broker_id,
    4.15,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 322/692: 02B3358765 - REGINO CARRION RODRIGUEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 323)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 12.56 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3358765'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-03', start_date),
      renewal_date = COALESCE('2026-07-03', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3358765';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('REGINO CARRION RODRIGUEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3358765', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-03', '2026-07-03', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3358765';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3358765', 
    'REGINO CARRION RODRIGUEZ', 
    v_insurer_id, 
    v_broker_id,
    12.56,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 323/692: 0219-03646-09 - ARISTIDES  BARAHONA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 324)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.43 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0219-03646-09'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0219-03646-09';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ARISTIDES  BARAHONA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0219-03646-09', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0219-03646-09';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0219-03646-09', 
    'ARISTIDES  BARAHONA', 
    v_insurer_id, 
    v_broker_id,
    9.43,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 324/692: 0219-00940-01 - XIOMARA ENEIDA SAMUDIO NU�EZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 325)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.72 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0219-00940-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0219-00940-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('XIOMARA ENEIDA SAMUDIO NU�EZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0219-00940-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0219-00940-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0219-00940-01', 
    'XIOMARA ENEIDA SAMUDIO NU�EZ', 
    v_insurer_id, 
    v_broker_id,
    0.72,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 325/692: 1-1-41110-0 - MANUEL JOSE RAMOS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'BANESCO' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: BANESCO (fila 326)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('BANESCO' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.46 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-1-41110-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-1-41110-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MANUEL JOSE RAMOS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-1-41110-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-1-41110-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-1-41110-0', 
    'MANUEL JOSE RAMOS', 
    v_insurer_id, 
    v_broker_id,
    0.46,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 326/692: 1-1-41110-0 - MANUEL JOSE RAMOS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'BANESCO' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: BANESCO (fila 327)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('BANESCO' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.46 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-1-41110-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-1-41110-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MANUEL JOSE RAMOS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-1-41110-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-1-41110-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-1-41110-0', 
    'MANUEL JOSE RAMOS', 
    v_insurer_id, 
    v_broker_id,
    0.46,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 327/692: 1-1-41110-0 - MANUEL JOSE RAMOS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'BANESCO' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: BANESCO (fila 328)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('BANESCO' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.46 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-1-41110-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-1-41110-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MANUEL JOSE RAMOS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-1-41110-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-1-41110-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-1-41110-0', 
    'MANUEL JOSE RAMOS', 
    v_insurer_id, 
    v_broker_id,
    0.46,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 328/692: 1-1-41110-0 - MANUEL JOSE RAMOS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'BANESCO' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: BANESCO (fila 329)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('BANESCO' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.46 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-1-41110-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-1-41110-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MANUEL JOSE RAMOS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-1-41110-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-1-41110-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-1-41110-0', 
    'MANUEL JOSE RAMOS', 
    v_insurer_id, 
    v_broker_id,
    0.46,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 329/692: 1-1-41110-0 - MANUEL JOSE RAMOS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'BANESCO' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: BANESCO (fila 330)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('BANESCO' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.46 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-1-41110-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-1-41110-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MANUEL JOSE RAMOS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-1-41110-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-1-41110-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-1-41110-0', 
    'MANUEL JOSE RAMOS', 
    v_insurer_id, 
    v_broker_id,
    0.46,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 330/692: 1-1-41110-0 - MANUEL JOSE RAMOS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'BANESCO' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: BANESCO (fila 331)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('BANESCO' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.45 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-1-41110-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-1-41110-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MANUEL JOSE RAMOS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-1-41110-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-1-41110-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-1-41110-0', 
    'MANUEL JOSE RAMOS', 
    v_insurer_id, 
    v_broker_id,
    0.45,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 331/692: 1-1-41110-0 - MANUEL JOSE RAMOS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'BANESCO' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: BANESCO (fila 332)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('BANESCO' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.46 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-1-41110-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-1-41110-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MANUEL JOSE RAMOS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-1-41110-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-1-41110-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-1-41110-0', 
    'MANUEL JOSE RAMOS', 
    v_insurer_id, 
    v_broker_id,
    0.46,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 332/692: 1-1-41110-0 - MANUEL JOSE RAMOS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'BANESCO' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: BANESCO (fila 333)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('BANESCO' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.46 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-1-41110-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-1-41110-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MANUEL JOSE RAMOS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-1-41110-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-1-41110-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-1-41110-0', 
    'MANUEL JOSE RAMOS', 
    v_insurer_id, 
    v_broker_id,
    0.46,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 333/692: 1-1-41110-0 - MANUEL JOSE RAMOS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'BANESCO' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: BANESCO (fila 334)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('BANESCO' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.46 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-1-41110-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-1-41110-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MANUEL JOSE RAMOS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-1-41110-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-1-41110-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-1-41110-0', 
    'MANUEL JOSE RAMOS', 
    v_insurer_id, 
    v_broker_id,
    0.46,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 334/692: 1-1-41110-0 - MANUEL JOSE RAMOS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'BANESCO' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: BANESCO (fila 335)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('BANESCO' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.46 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-1-41110-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-1-41110-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MANUEL JOSE RAMOS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-1-41110-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-1-41110-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-1-41110-0', 
    'MANUEL JOSE RAMOS', 
    v_insurer_id, 
    v_broker_id,
    0.46,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 335/692: 1-1-41110-0 - MANUEL JOSE RAMOS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'BANESCO' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: BANESCO (fila 336)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('BANESCO' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.46 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-1-41110-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-1-41110-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MANUEL JOSE RAMOS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-1-41110-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-1-41110-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-1-41110-0', 
    'MANUEL JOSE RAMOS', 
    v_insurer_id, 
    v_broker_id,
    0.46,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 336/692: 1-1-41110-0 - MANUEL JOSE RAMOS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'BANESCO' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: BANESCO (fila 337)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('BANESCO' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.41 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-1-41110-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-1-41110-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MANUEL JOSE RAMOS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-1-41110-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-1-41110-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-1-41110-0', 
    'MANUEL JOSE RAMOS', 
    v_insurer_id, 
    v_broker_id,
    0.41,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 337/692: 1-1-41110-0 - MANUEL JOSE RAMOS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'BANESCO' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: BANESCO (fila 338)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('BANESCO' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := -3.18 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-1-41110-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-1-41110-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MANUEL JOSE RAMOS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-1-41110-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-1-41110-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-1-41110-0', 
    'MANUEL JOSE RAMOS', 
    v_insurer_id, 
    v_broker_id,
    -3.18,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 338/692: 04-05-1181708-3 - DOMINGO BRIOSO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 339)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.49 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-05-1181708-3'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-10-25', start_date),
      renewal_date = COALESCE('2026-10-25', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-05-1181708-3';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('DOMINGO BRIOSO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-05-1181708-3', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-10-25', '2026-10-25', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-05-1181708-3';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-05-1181708-3', 
    'DOMINGO BRIOSO', 
    v_insurer_id, 
    v_broker_id,
    8.49,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 339/692: 10-01-884113-6 - JORGE  PARRIS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 340)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 37.5 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '10-01-884113-6'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-11', start_date),
      renewal_date = COALESCE('2026-11-11', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 10-01-884113-6';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JORGE  PARRIS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '10-01-884113-6', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-11', '2026-11-11', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 10-01-884113-6';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '10-01-884113-6', 
    'JORGE  PARRIS', 
    v_insurer_id, 
    v_broker_id,
    37.5,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 340/692: 1-16-34614 - DARNELL JEROME DOUGLAS GUEVARA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 341)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 6.19 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-34614'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-34614';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('DARNELL JEROME DOUGLAS GUEVARA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-34614', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-34614';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-34614', 
    'DARNELL JEROME DOUGLAS GUEVARA', 
    v_insurer_id, 
    v_broker_id,
    6.19,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 341/692: 1-16-34614 - DARNELL JEROME DOUGLAS GUEVARA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 342)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.07 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-34614'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-34614';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('DARNELL JEROME DOUGLAS GUEVARA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-34614', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-34614';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-34614', 
    'DARNELL JEROME DOUGLAS GUEVARA', 
    v_insurer_id, 
    v_broker_id,
    0.07,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 342/692: 1-16-54833 - AIDAMALIA MARITA VARGAS LOWMAN
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 343)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 4.73 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-54833'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-54833';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('AIDAMALIA MARITA VARGAS LOWMAN', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-54833', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-54833';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-54833', 
    'AIDAMALIA MARITA VARGAS LOWMAN', 
    v_insurer_id, 
    v_broker_id,
    4.73,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 343/692: 1-16-54834 - AIDAMALIA MARITA VARGAS LOWMAN
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 344)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 4.73 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-54834'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-54834';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('AIDAMALIA MARITA VARGAS LOWMAN', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-54834', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-54834';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-54834', 
    'AIDAMALIA MARITA VARGAS LOWMAN', 
    v_insurer_id, 
    v_broker_id,
    4.73,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 344/692: 02-93-1153833-1 - JOHAN VON CHONG
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 345)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 21.51 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-93-1153833-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-93-1153833-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JOHAN VON CHONG', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-93-1153833-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-93-1153833-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-93-1153833-1', 
    'JOHAN VON CHONG', 
    v_insurer_id, 
    v_broker_id,
    21.51,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 345/692: 02-92-0990223-2 - JARIEL CAMARENA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 346)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.84 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-92-0990223-2'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-92-0990223-2';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JARIEL CAMARENA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-92-0990223-2', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-92-0990223-2';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-92-0990223-2', 
    'JARIEL CAMARENA', 
    v_insurer_id, 
    v_broker_id,
    11.84,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 346/692: 03030039354 - JOVANNE AILEEN GONZALEZ DIAZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 347)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 2.31 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '03030039354'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 03030039354';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JOVANNE AILEEN GONZALEZ DIAZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '03030039354', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 03030039354';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '03030039354', 
    'JOVANNE AILEEN GONZALEZ DIAZ', 
    v_insurer_id, 
    v_broker_id,
    2.31,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 347/692: 03030041951 - MELISSA ITZEL KRAUS MONTENEGRO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 348)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 12.57 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '03030041951'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 03030041951';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MELISSA ITZEL KRAUS MONTENEGRO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '03030041951', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 03030041951';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '03030041951', 
    'MELISSA ITZEL KRAUS MONTENEGRO', 
    v_insurer_id, 
    v_broker_id,
    12.57,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 348/692: 03030041951 - MELISSA ITZEL KRAUS MONTENEGRO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 349)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.14 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '03030041951'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 03030041951';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MELISSA ITZEL KRAUS MONTENEGRO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '03030041951', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 03030041951';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '03030041951', 
    'MELISSA ITZEL KRAUS MONTENEGRO', 
    v_insurer_id, 
    v_broker_id,
    0.14,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 349/692: 02-93-1104879-1 - ANGELA ELEONOR CAHIZA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 350)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.91 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-93-1104879-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-93-1104879-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ANGELA ELEONOR CAHIZA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-93-1104879-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-93-1104879-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-93-1104879-1', 
    'ANGELA ELEONOR CAHIZA', 
    v_insurer_id, 
    v_broker_id,
    11.91,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 350/692: 02-93-1153159-1 - CARLOS BRUGIATI
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 351)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 6.37 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-93-1153159-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-93-1153159-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CARLOS BRUGIATI', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-93-1153159-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-93-1153159-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-93-1153159-1', 
    'CARLOS BRUGIATI', 
    v_insurer_id, 
    v_broker_id,
    6.37,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 351/692: 21990 - MARIN PEREZ ASHLY LISBETH
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'VIVIR' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: VIVIR (fila 352)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('VIVIR' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 6.04 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '21990'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 21990';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MARIN PEREZ ASHLY LISBETH', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '21990', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 21990';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '21990', 
    'MARIN PEREZ ASHLY LISBETH', 
    v_insurer_id, 
    v_broker_id,
    6.04,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 352/692: 4330 - MIZRACHI MUNDO DAYANA MAR
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'VIVIR' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: VIVIR (fila 353)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('VIVIR' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 16.17 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '4330'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 4330';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MIZRACHI MUNDO DAYANA MAR', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '4330', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 4330';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '4330', 
    'MIZRACHI MUNDO DAYANA MAR', 
    v_insurer_id, 
    v_broker_id,
    16.17,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 353/692: 70B33823 - GUADALUPE LIZBETH PE�ALBA BONILLA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 354)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'lissett.vergara17@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'SALUD' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10.59 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '70B33823'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-05-11', start_date),
      renewal_date = COALESCE('2026-05-11', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 70B33823';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('GUADALUPE LIZBETH PE�ALBA BONILLA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '70B33823', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-05-11', '2026-05-11', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 70B33823';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '70B33823', 
    'GUADALUPE LIZBETH PE�ALBA BONILLA', 
    v_insurer_id, 
    v_broker_id,
    10.59,
    jsonb_build_object(
      'policy_type', 'SALUD',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'lissett.vergara17@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 354/692: 70B40202 - ANGIE ELIZABETH SANCHEZ BONILLA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 355)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'lissett.vergara17@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'SALUD' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 5.7 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '70B40202'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-19', start_date),
      renewal_date = COALESCE('2026-09-19', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 70B40202';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ANGIE ELIZABETH SANCHEZ BONILLA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '70B40202', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-19', '2026-09-19', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 70B40202';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '70B40202', 
    'ANGIE ELIZABETH SANCHEZ BONILLA', 
    v_insurer_id, 
    v_broker_id,
    5.7,
    jsonb_build_object(
      'policy_type', 'SALUD',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'lissett.vergara17@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 355/692: 14B77555 - ISIS IVETH ESPINOSA PINZON
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 356)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'lissett.vergara17@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 2.5 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B77555'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-02', start_date),
      renewal_date = COALESCE('2026-07-02', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B77555';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ISIS IVETH ESPINOSA PINZON', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B77555', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-02', '2026-07-02', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B77555';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B77555', 
    'ISIS IVETH ESPINOSA PINZON', 
    v_insurer_id, 
    v_broker_id,
    2.5,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'lissett.vergara17@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 356/692: 14B80672 - ANNETTE YISBELL RIQUELME HERRERA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 357)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'lissett.vergara17@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 35.75 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B80672'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-08', start_date),
      renewal_date = COALESCE('2026-07-08', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B80672';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ANNETTE YISBELL RIQUELME HERRERA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B80672', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-08', '2026-07-08', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B80672';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B80672', 
    'ANNETTE YISBELL RIQUELME HERRERA', 
    v_insurer_id, 
    v_broker_id,
    35.75,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'lissett.vergara17@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 357/692: 14B70209 - ANGIE ELIZABETH SANCHEZ BONILLA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 358)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'lissett.vergara17@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 3.88 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B70209'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-19', start_date),
      renewal_date = COALESCE('2026-11-19', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B70209';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ANGIE ELIZABETH SANCHEZ BONILLA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B70209', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-19', '2026-11-19', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B70209';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B70209', 
    'ANGIE ELIZABETH SANCHEZ BONILLA', 
    v_insurer_id, 
    v_broker_id,
    3.88,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'lissett.vergara17@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 358/692: 1-1-10009313-0 - NANCY YAMINETD NAVAS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'BANESCO' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: BANESCO (fila 359)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'lissett.vergara17@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('BANESCO' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 2.04 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-1-10009313-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-1-10009313-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('NANCY YAMINETD NAVAS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-1-10009313-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-1-10009313-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-1-10009313-0', 
    'NANCY YAMINETD NAVAS', 
    v_insurer_id, 
    v_broker_id,
    2.04,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'lissett.vergara17@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 359/692: 2162240 - ERNESTO ENRIQUE JURADO HERNANDEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'REGIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: REGIONAL (fila 360)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'lissett.vergara17@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('REGIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 22.64 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2162240'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2162240';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ERNESTO ENRIQUE JURADO HERNANDEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2162240', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2162240';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2162240', 
    'ERNESTO ENRIQUE JURADO HERNANDEZ', 
    v_insurer_id, 
    v_broker_id,
    22.64,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'lissett.vergara17@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 360/692: 14143 - NAVAS QUINTERO LILIANA ME
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'VIVIR' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: VIVIR (fila 361)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'lissett.vergara17@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('VIVIR' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.33 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14143'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14143';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('NAVAS QUINTERO LILIANA ME', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14143', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14143';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14143', 
    'NAVAS QUINTERO LILIANA ME', 
    v_insurer_id, 
    v_broker_id,
    11.33,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'lissett.vergara17@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 361/692: 11552 - GONZALEZ RODRIGUEZ MILAGR
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'VIVIR' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: VIVIR (fila 362)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'lissett.vergara17@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('VIVIR' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.86 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '11552'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 11552';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('GONZALEZ RODRIGUEZ MILAGR', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '11552', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 11552';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '11552', 
    'GONZALEZ RODRIGUEZ MILAGR', 
    v_insurer_id, 
    v_broker_id,
    11.86,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'lissett.vergara17@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 362/692: 12BV26626 - LUCIA DEL ROSARIO NIETO HERNANDEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 363)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luciaydanna@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 2.06 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '12BV26626'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-01', start_date),
      renewal_date = COALESCE('2026-11-01', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 12BV26626';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('LUCIA DEL ROSARIO NIETO HERNANDEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '12BV26626', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-01', '2026-11-01', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 12BV26626';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '12BV26626', 
    'LUCIA DEL ROSARIO NIETO HERNANDEZ', 
    v_insurer_id, 
    v_broker_id,
    2.06,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luciaydanna@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 363/692: 70B15169 - IVONNE GISELLE TAPIA GIRON
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 364)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luciaydanna@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.94 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '70B15169'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-05-01', start_date),
      renewal_date = COALESCE('2026-05-01', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 70B15169';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('IVONNE GISELLE TAPIA GIRON', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '70B15169', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-05-01', '2026-05-01', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 70B15169';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '70B15169', 
    'IVONNE GISELLE TAPIA GIRON', 
    v_insurer_id, 
    v_broker_id,
    8.94,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luciaydanna@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 364/692: 70B36598 - JILMA ROSA DE LEON HERNANDEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 365)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luciaydanna@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 15.6 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '70B36598'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-20', start_date),
      renewal_date = COALESCE('2026-07-20', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 70B36598';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JILMA ROSA DE LEON HERNANDEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '70B36598', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-20', '2026-07-20', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 70B36598';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '70B36598', 
    'JILMA ROSA DE LEON HERNANDEZ', 
    v_insurer_id, 
    v_broker_id,
    15.6,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luciaydanna@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 365/692: 70B36598 - JILMA ROSA DE LEON HERNANDEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 366)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luciaydanna@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 15.6 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '70B36598'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-20', start_date),
      renewal_date = COALESCE('2026-07-20', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 70B36598';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JILMA ROSA DE LEON HERNANDEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '70B36598', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-20', '2026-07-20', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 70B36598';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '70B36598', 
    'JILMA ROSA DE LEON HERNANDEZ', 
    v_insurer_id, 
    v_broker_id,
    15.6,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luciaydanna@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 366/692: 70B36598 - JILMA ROSA DE LEON HERNANDEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 367)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luciaydanna@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 15.6 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '70B36598'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-20', start_date),
      renewal_date = COALESCE('2026-07-20', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 70B36598';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JILMA ROSA DE LEON HERNANDEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '70B36598', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-20', '2026-07-20', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 70B36598';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '70B36598', 
    'JILMA ROSA DE LEON HERNANDEZ', 
    v_insurer_id, 
    v_broker_id,
    15.6,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luciaydanna@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 367/692: 70B19795 - JILMA ROSA DE LEON HERNANDEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 368)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luciaydanna@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 7.86 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '70B19795'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-04-08', start_date),
      renewal_date = COALESCE('2026-04-08', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 70B19795';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JILMA ROSA DE LEON HERNANDEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '70B19795', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-04-08', '2026-04-08', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 70B19795';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '70B19795', 
    'JILMA ROSA DE LEON HERNANDEZ', 
    v_insurer_id, 
    v_broker_id,
    7.86,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luciaydanna@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 368/692: 70B36598 - JILMA ROSA DE LEON HERNANDEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 369)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luciaydanna@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 15.6 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '70B36598'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-20', start_date),
      renewal_date = COALESCE('2026-07-20', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 70B36598';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JILMA ROSA DE LEON HERNANDEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '70B36598', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-20', '2026-07-20', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 70B36598';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '70B36598', 
    'JILMA ROSA DE LEON HERNANDEZ', 
    v_insurer_id, 
    v_broker_id,
    15.6,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luciaydanna@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 369/692: 02B3365001 - JUAN CARLOS BERMUDEZ PEREZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 370)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luciaydanna@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.52 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3365001'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-10-05', start_date),
      renewal_date = COALESCE('2026-10-05', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3365001';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JUAN CARLOS BERMUDEZ PEREZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3365001', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-10-05', '2026-10-05', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3365001';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3365001', 
    'JUAN CARLOS BERMUDEZ PEREZ', 
    v_insurer_id, 
    v_broker_id,
    8.52,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luciaydanna@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 370/692: 02B3386566 - ANAYANSI ESCOBAR SALINAS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 371)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luciaydanna@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10.6 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3386566'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-10', start_date),
      renewal_date = COALESCE('2026-07-10', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3386566';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ANAYANSI ESCOBAR SALINAS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3386566', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-10', '2026-07-10', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3386566';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3386566', 
    'ANAYANSI ESCOBAR SALINAS', 
    v_insurer_id, 
    v_broker_id,
    10.6,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luciaydanna@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 371/692: 02B3391525 - GIOVANA MARRIAGA VILLANUEVA DE BERMUDEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 372)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luciaydanna@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 12.72 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3391525'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-11', start_date),
      renewal_date = COALESCE('2026-09-11', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3391525';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('GIOVANA MARRIAGA VILLANUEVA DE BERMUDEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3391525', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-11', '2026-09-11', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3391525';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3391525', 
    'GIOVANA MARRIAGA VILLANUEVA DE BERMUDEZ', 
    v_insurer_id, 
    v_broker_id,
    12.72,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luciaydanna@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 372/692: 02B3332491 - ILEANA LISBETH MARTINEZ VALDES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 373)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luciaydanna@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 2.36 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3332491'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-01-26', start_date),
      renewal_date = COALESCE('2026-01-26', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3332491';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ILEANA LISBETH MARTINEZ VALDES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3332491', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-01-26', '2026-01-26', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3332491';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3332491', 
    'ILEANA LISBETH MARTINEZ VALDES', 
    v_insurer_id, 
    v_broker_id,
    2.36,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luciaydanna@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 373/692: 14B57280 - GABRIEL DE JESUS BARRIA NIETO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 374)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luciaydanna@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.66 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B57280'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-10-03', start_date),
      renewal_date = COALESCE('2026-10-03', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B57280';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('GABRIEL DE JESUS BARRIA NIETO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B57280', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-10-03', '2026-10-03', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B57280';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B57280', 
    'GABRIEL DE JESUS BARRIA NIETO', 
    v_insurer_id, 
    v_broker_id,
    0.66,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luciaydanna@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 374/692: 14B53497 - JUAN CARLOS BERMUDEZ PEREZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 375)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luciaydanna@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.84 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B53497'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-08-01', start_date),
      renewal_date = COALESCE('2026-08-01', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B53497';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JUAN CARLOS BERMUDEZ PEREZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B53497', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-08-01', '2026-08-01', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B53497';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B53497', 
    'JUAN CARLOS BERMUDEZ PEREZ', 
    v_insurer_id, 
    v_broker_id,
    0.84,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luciaydanna@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 375/692: 14B47503 - LUCIA DEL ROSARIO NIETO HERNANDEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 376)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luciaydanna@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.45 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B47503'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-28', start_date),
      renewal_date = COALESCE('2026-07-28', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B47503';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('LUCIA DEL ROSARIO NIETO HERNANDEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B47503', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-28', '2026-07-28', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B47503';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B47503', 
    'LUCIA DEL ROSARIO NIETO HERNANDEZ', 
    v_insurer_id, 
    v_broker_id,
    0.45,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luciaydanna@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 376/692: 14B76631 - CHRISTIAN ELIAS GONZALEZ DE LOS RIOS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 377)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luciaydanna@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 2.86 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B76631'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-03-01', start_date),
      renewal_date = COALESCE('2026-03-01', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B76631';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CHRISTIAN ELIAS GONZALEZ DE LOS RIOS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B76631', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-03-01', '2026-03-01', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B76631';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B76631', 
    'CHRISTIAN ELIAS GONZALEZ DE LOS RIOS', 
    v_insurer_id, 
    v_broker_id,
    2.86,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luciaydanna@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 377/692: 14B46010 - KLEBER JOSE MARTINEZ CRUZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 378)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luciaydanna@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.75 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B46010'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-01-17', start_date),
      renewal_date = COALESCE('2026-01-17', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B46010';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('KLEBER JOSE MARTINEZ CRUZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B46010', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-01-17', '2026-01-17', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B46010';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B46010', 
    'KLEBER JOSE MARTINEZ CRUZ', 
    v_insurer_id, 
    v_broker_id,
    0.75,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luciaydanna@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 378/692: 0223-08760-09 - GIOVANNA IRINA ESPINOSA  ARROCHA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 379)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luciaydanna@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10.62 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0223-08760-09'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0223-08760-09';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('GIOVANNA IRINA ESPINOSA  ARROCHA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0223-08760-09', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0223-08760-09';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0223-08760-09', 
    'GIOVANNA IRINA ESPINOSA  ARROCHA', 
    v_insurer_id, 
    v_broker_id,
    10.62,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luciaydanna@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 379/692: 0117-00360-01 - ABDIEL RAUL SAMANIEGO NIETO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 380)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luciaydanna@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 2.5 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0117-00360-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0117-00360-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ABDIEL RAUL SAMANIEGO NIETO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0117-00360-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0117-00360-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0117-00360-01', 
    'ABDIEL RAUL SAMANIEGO NIETO', 
    v_insurer_id, 
    v_broker_id,
    2.5,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luciaydanna@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 380/692: 1-16-47772 - LEYLA KARINA NIETO LOPEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 381)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luciaydanna@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 4.73 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-47772'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-47772';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('LEYLA KARINA NIETO LOPEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-47772', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-47772';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-47772', 
    'LEYLA KARINA NIETO LOPEZ', 
    v_insurer_id, 
    v_broker_id,
    4.73,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luciaydanna@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 381/692: 1-16-62215 - LEYLA KARINA NIETO LOPEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 382)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luciaydanna@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 4.73 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-62215'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-62215';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('LEYLA KARINA NIETO LOPEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-62215', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-62215';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-62215', 
    'LEYLA KARINA NIETO LOPEZ', 
    v_insurer_id, 
    v_broker_id,
    4.73,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luciaydanna@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 382/692: 45480 - BYRON MOISES VARELA HERNANDEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'OPTIMA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: OPTIMA (fila 383)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luciaydanna@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('OPTIMA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.34 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '45480'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 45480';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('BYRON MOISES VARELA HERNANDEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '45480', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 45480';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '45480', 
    'BYRON MOISES VARELA HERNANDEZ', 
    v_insurer_id, 
    v_broker_id,
    8.34,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luciaydanna@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 383/692: 2138566 - ERIC VASQUEZ BONILLA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'REGIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: REGIONAL (fila 384)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luciaydanna@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('REGIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.43 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2138566'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2138566';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ERIC VASQUEZ BONILLA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2138566', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2138566';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2138566', 
    'ERIC VASQUEZ BONILLA', 
    v_insurer_id, 
    v_broker_id,
    9.43,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luciaydanna@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 384/692: 14706 - BERMUDEZ PEREZ JUAN CARLO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'VIVIR' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: VIVIR (fila 385)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luciaydanna@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('VIVIR' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 22.95 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14706'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14706';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('BERMUDEZ PEREZ JUAN CARLO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14706', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14706';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14706', 
    'BERMUDEZ PEREZ JUAN CARLO', 
    v_insurer_id, 
    v_broker_id,
    22.95,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luciaydanna@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 385/692: 02B3362479 - QUELIS ESPINOZA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 386)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'lbranca68@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.54 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3362479'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-08-31', start_date),
      renewal_date = COALESCE('2026-08-31', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3362479';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('QUELIS ESPINOZA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3362479', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-08-31', '2026-08-31', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3362479';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3362479', 
    'QUELIS ESPINOZA', 
    v_insurer_id, 
    v_broker_id,
    8.54,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'lbranca68@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 386/692: 02B3347559 - MARIA DEL CARMEN GOMEZ GUTIERREZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 387)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'lbranca68@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 15.2 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3347559'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2024-12-21', start_date),
      renewal_date = COALESCE('2025-12-21', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3347559';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MARIA DEL CARMEN GOMEZ GUTIERREZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3347559', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2024-12-21', '2025-12-21', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3347559';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3347559', 
    'MARIA DEL CARMEN GOMEZ GUTIERREZ', 
    v_insurer_id, 
    v_broker_id,
    15.2,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'lbranca68@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 387/692: 02BR2882873 - CHARLES WILLIAM GRAZIER SANCHEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 388)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'lbranca68@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 34.91 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02BR2882873'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-08', start_date),
      renewal_date = COALESCE('2026-11-08', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02BR2882873';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CHARLES WILLIAM GRAZIER SANCHEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02BR2882873', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-08', '2026-11-08', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02BR2882873';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02BR2882873', 
    'CHARLES WILLIAM GRAZIER SANCHEZ', 
    v_insurer_id, 
    v_broker_id,
    34.91,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'lbranca68@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 388/692: 02BR2882880 - CHARLES WILLIAM GRAZIER SANCHEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 389)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'lbranca68@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 34.91 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02BR2882880'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-08', start_date),
      renewal_date = COALESCE('2026-11-08', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02BR2882880';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CHARLES WILLIAM GRAZIER SANCHEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02BR2882880', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-08', '2026-11-08', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02BR2882880';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02BR2882880', 
    'CHARLES WILLIAM GRAZIER SANCHEZ', 
    v_insurer_id, 
    v_broker_id,
    34.91,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'lbranca68@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 389/692: 0221-02862-09 - MARIA TERESA SOTO MENA DE VALDES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 390)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'lbranca68@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.92 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0221-02862-09'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0221-02862-09';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MARIA TERESA SOTO MENA DE VALDES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0221-02862-09', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0221-02862-09';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0221-02862-09', 
    'MARIA TERESA SOTO MENA DE VALDES', 
    v_insurer_id, 
    v_broker_id,
    8.92,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'lbranca68@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 390/692: 0225-04555-09 - VICTORIA  VALDES PUELLO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 391)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'lbranca68@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.15 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0225-04555-09'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0225-04555-09';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('VICTORIA  VALDES PUELLO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0225-04555-09', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0225-04555-09';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0225-04555-09', 
    'VICTORIA  VALDES PUELLO', 
    v_insurer_id, 
    v_broker_id,
    9.15,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'lbranca68@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 391/692: 0222-00457-09 - MARCOS ANTONIO MARENGO NAJERA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 392)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'lbranca68@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10.91 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0222-00457-09'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0222-00457-09';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MARCOS ANTONIO MARENGO NAJERA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0222-00457-09', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0222-00457-09';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0222-00457-09', 
    'MARCOS ANTONIO MARENGO NAJERA', 
    v_insurer_id, 
    v_broker_id,
    10.91,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'lbranca68@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 392/692: 1-4-56226 - RICARDO CABALLERO NAVARRETE
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 393)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'lbranca68@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.71 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-4-56226'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-4-56226';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('RICARDO CABALLERO NAVARRETE', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-4-56226', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-4-56226';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-4-56226', 
    'RICARDO CABALLERO NAVARRETE', 
    v_insurer_id, 
    v_broker_id,
    0.71,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'lbranca68@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 393/692: 32948 - JUAN CARLOS BARRIOS SILVERA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'OPTIMA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: OPTIMA (fila 394)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'lbranca68@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('OPTIMA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 2 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '32948'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 32948';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JUAN CARLOS BARRIOS SILVERA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '32948', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 32948';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '32948', 
    'JUAN CARLOS BARRIOS SILVERA', 
    v_insurer_id, 
    v_broker_id,
    2,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'lbranca68@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 394/692: 32949 - JUAN CARLOS BARRIOS SILVERA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'OPTIMA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: OPTIMA (fila 395)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'lbranca68@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('OPTIMA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 4.73 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '32949'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 32949';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JUAN CARLOS BARRIOS SILVERA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '32949', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 32949';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '32949', 
    'JUAN CARLOS BARRIOS SILVERA', 
    v_insurer_id, 
    v_broker_id,
    4.73,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'lbranca68@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 395/692: 2378 - TRINA MICHELLE CLARK BERG
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'OPTIMA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: OPTIMA (fila 396)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'lbranca68@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('OPTIMA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 65.36 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2378'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2378';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('TRINA MICHELLE CLARK BERG', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2378', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2378';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2378', 
    'TRINA MICHELLE CLARK BERG', 
    v_insurer_id, 
    v_broker_id,
    65.36,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'lbranca68@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 396/692: 28987 - CARLOS ALBERTO ALVARADO LESCURE
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'OPTIMA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: OPTIMA (fila 397)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'lbranca68@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('OPTIMA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 33.21 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '28987'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 28987';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CARLOS ALBERTO ALVARADO LESCURE', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '28987', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 28987';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '28987', 
    'CARLOS ALBERTO ALVARADO LESCURE', 
    v_insurer_id, 
    v_broker_id,
    33.21,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'lbranca68@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 397/692: 28987 - CARLOS ALBERTO ALVARADO LESCURE
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'OPTIMA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: OPTIMA (fila 398)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'lbranca68@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('OPTIMA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := -33.21 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '28987'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 28987';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CARLOS ALBERTO ALVARADO LESCURE', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '28987', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 28987';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '28987', 
    'CARLOS ALBERTO ALVARADO LESCURE', 
    v_insurer_id, 
    v_broker_id,
    -33.21,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'lbranca68@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 398/692: 2125434 - MARCOS ANTONIO MARENGO NAJERA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'REGIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: REGIONAL (fila 399)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'lbranca68@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('REGIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 7.64 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2125434'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2125434';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MARCOS ANTONIO MARENGO NAJERA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2125434', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2125434';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2125434', 
    'MARCOS ANTONIO MARENGO NAJERA', 
    v_insurer_id, 
    v_broker_id,
    7.64,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'lbranca68@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 399/692: 2187021 - JOANNA MARIE BRANCA DELGADO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'REGIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: REGIONAL (fila 400)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'lbranca68@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('REGIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 34.98 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2187021'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2187021';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JOANNA MARIE BRANCA DELGADO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2187021', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2187021';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2187021', 
    'JOANNA MARIE BRANCA DELGADO', 
    v_insurer_id, 
    v_broker_id,
    34.98,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'lbranca68@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 400/692: 1-16-68643 - ALEXIS EDUARDO TAPIA REYNA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 401)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'lcamargolopez1279@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 5.68 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-68643'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-68643';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ALEXIS EDUARDO TAPIA REYNA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-68643', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-68643';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-68643', 
    'ALEXIS EDUARDO TAPIA REYNA', 
    v_insurer_id, 
    v_broker_id,
    5.68,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'lcamargolopez1279@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 401/692: 02B3350667 - ROSA MARIA GUTIERREZ GARCIA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 402)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luisquiros@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'AUTO' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 7.41 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3350667'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-02-06', start_date),
      renewal_date = COALESCE('2026-02-06', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3350667';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ROSA MARIA GUTIERREZ GARCIA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3350667', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-02-06', '2026-02-06', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3350667';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3350667', 
    'ROSA MARIA GUTIERREZ GARCIA', 
    v_insurer_id, 
    v_broker_id,
    7.41,
    jsonb_build_object(
      'policy_type', 'AUTO',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luisquiros@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 402/692: 02B3360108 - MELQUICEDEC JOSUE VARGAS ESCUDERO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 403)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luisquiros@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 6.95 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3360108'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-25', start_date),
      renewal_date = COALESCE('2026-07-25', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3360108';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MELQUICEDEC JOSUE VARGAS ESCUDERO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3360108', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-25', '2026-07-25', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3360108';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3360108', 
    'MELQUICEDEC JOSUE VARGAS ESCUDERO', 
    v_insurer_id, 
    v_broker_id,
    6.95,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luisquiros@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 403/692: 02B3409176 - LOURDES MARIA FERNANDEZ CRUZ DE RODRIGUEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 404)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luisquiros@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.77 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3409176'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-03-31', start_date),
      renewal_date = COALESCE('2026-03-31', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3409176';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('LOURDES MARIA FERNANDEZ CRUZ DE RODRIGUEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3409176', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-03-31', '2026-03-31', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3409176';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3409176', 
    'LOURDES MARIA FERNANDEZ CRUZ DE RODRIGUEZ', 
    v_insurer_id, 
    v_broker_id,
    8.77,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luisquiros@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 404/692: 02B3386628 - EDILZA QUIROS RODRIGUEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 405)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luisquiros@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10.74 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3386628'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-11', start_date),
      renewal_date = COALESCE('2026-07-11', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3386628';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('EDILZA QUIROS RODRIGUEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3386628', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-11', '2026-07-11', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3386628';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3386628', 
    'EDILZA QUIROS RODRIGUEZ', 
    v_insurer_id, 
    v_broker_id,
    10.74,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luisquiros@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 405/692: 02B3417847 - NICK ANTHONY LEE SARMIENTO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 406)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luisquiros@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10.71 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3417847'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-02', start_date),
      renewal_date = COALESCE('2026-07-02', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3417847';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('NICK ANTHONY LEE SARMIENTO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3417847', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-02', '2026-07-02', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3417847';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3417847', 
    'NICK ANTHONY LEE SARMIENTO', 
    v_insurer_id, 
    v_broker_id,
    10.71,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luisquiros@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 406/692: 02B3399100 - CARLOS JAVIER MINA VALVERDE
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 407)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luisquiros@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 27.64 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3399100'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-01-17', start_date),
      renewal_date = COALESCE('2026-01-17', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3399100';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CARLOS JAVIER MINA VALVERDE', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3399100', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-01-17', '2026-01-17', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3399100';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3399100', 
    'CARLOS JAVIER MINA VALVERDE', 
    v_insurer_id, 
    v_broker_id,
    27.64,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luisquiros@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 407/692: 02B3347110 - ORIELINDA MARIA BERNAL HERNANDEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 408)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luisquiros@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 7.05 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3347110'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2024-12-14', start_date),
      renewal_date = COALESCE('2025-12-14', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3347110';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ORIELINDA MARIA BERNAL HERNANDEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3347110', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2024-12-14', '2025-12-14', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3347110';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3347110', 
    'ORIELINDA MARIA BERNAL HERNANDEZ', 
    v_insurer_id, 
    v_broker_id,
    7.05,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luisquiros@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 408/692: 0225-05704-09 - LOURDES CATALINA DIAZ VILLARREAL DE O
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 409)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luisquiros@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.14 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0225-05704-09'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0225-05704-09';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('LOURDES CATALINA DIAZ VILLARREAL DE O', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0225-05704-09', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0225-05704-09';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0225-05704-09', 
    'LOURDES CATALINA DIAZ VILLARREAL DE O', 
    v_insurer_id, 
    v_broker_id,
    11.14,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luisquiros@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 409/692: 04-08-967814-5 - ALBERTO NAVARRO MU�OZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 410)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luisquiros@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 14.62 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-08-967814-5'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-10-14', start_date),
      renewal_date = COALESCE('2026-10-14', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-08-967814-5';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ALBERTO NAVARRO MU�OZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-08-967814-5', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-10-14', '2026-10-14', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-08-967814-5';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-08-967814-5', 
    'ALBERTO NAVARRO MU�OZ', 
    v_insurer_id, 
    v_broker_id,
    14.62,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luisquiros@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 410/692: 06-55-1972188-0 - "SERVICIOS GENERALES ESCOBAR
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'S.A."' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: S.A." (fila 411)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'fedpa' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('S.A."' = 'ASSA' AND 'LUISQUIROS@LIDERESENSEGUROS.COM' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '06-55-1972188-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE('2025-07-18', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 06-55-1972188-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('"SERVICIOS GENERALES ESCOBAR', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '06-55-1972188-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, '2025-07-18', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 06-55-1972188-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '06-55-1972188-0', 
    '"SERVICIOS GENERALES ESCOBAR', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', 'LUISQUIROS@LIDERESENSEGUROS.COM',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'fedpa'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 411/692: 04-55-1972629-0 - "SERVICIOS GENERALES ESCOBAR
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'S.A."' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: S.A." (fila 412)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'fedpa' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('S.A."' = 'ASSA' AND 'LUISQUIROS@LIDERESENSEGUROS.COM' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-55-1972629-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE('2025-07-18', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-55-1972629-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('"SERVICIOS GENERALES ESCOBAR', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-55-1972629-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, '2025-07-18', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-55-1972629-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-55-1972629-0', 
    '"SERVICIOS GENERALES ESCOBAR', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', 'LUISQUIROS@LIDERESENSEGUROS.COM',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'fedpa'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 412/692: 04-05-2020260-0 - GLADYS ANDREA CHAVEZ CASTRO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 413)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luisquiros@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 13.21 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-05-2020260-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-24', start_date),
      renewal_date = COALESCE('2026-09-24', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-05-2020260-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('GLADYS ANDREA CHAVEZ CASTRO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-05-2020260-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-24', '2026-09-24', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-05-2020260-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-05-2020260-0', 
    'GLADYS ANDREA CHAVEZ CASTRO', 
    v_insurer_id, 
    v_broker_id,
    13.21,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luisquiros@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 413/692: 04-05-2050225-0 - EUGENIO VASQUEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 414)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luisquiros@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 26.4 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-05-2050225-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-04', start_date),
      renewal_date = COALESCE('2026-11-04', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-05-2050225-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('EUGENIO VASQUEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-05-2050225-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-04', '2026-11-04', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-05-2050225-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-05-2050225-0', 
    'EUGENIO VASQUEZ', 
    v_insurer_id, 
    v_broker_id,
    26.4,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luisquiros@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 414/692: 04-04-1826568-0 - RICARDO JARAMILLO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 415)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luisquiros@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 6.13 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-1826568-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-01-16', start_date),
      renewal_date = COALESCE('2026-01-16', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-1826568-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('RICARDO JARAMILLO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-1826568-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-01-16', '2026-01-16', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-1826568-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-1826568-0', 
    'RICARDO JARAMILLO', 
    v_insurer_id, 
    v_broker_id,
    6.13,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luisquiros@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 415/692: 04-04-1726656-1 - KATHERINE GALVEZ BARSALLO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 416)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luisquiros@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 7.71 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-1726656-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-10-14', start_date),
      renewal_date = COALESCE('2026-10-14', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-1726656-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('KATHERINE GALVEZ BARSALLO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-1726656-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-10-14', '2026-10-14', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-1726656-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-1726656-1', 
    'KATHERINE GALVEZ BARSALLO', 
    v_insurer_id, 
    v_broker_id,
    7.71,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luisquiros@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 416/692: 04-12-2055276-0 - BIG TRUCK TRABAJANDO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 417)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luisquiros@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 55.05 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-12-2055276-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-14', start_date),
      renewal_date = COALESCE('2026-11-14', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-12-2055276-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('BIG TRUCK TRABAJANDO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-12-2055276-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-14', '2026-11-14', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-12-2055276-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-12-2055276-0', 
    'BIG TRUCK TRABAJANDO', 
    v_insurer_id, 
    v_broker_id,
    55.05,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luisquiros@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 417/692: 04-12-2055290-0 - "BIG TRUCK TRABAJANDO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'S.A. "' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: S.A. " (fila 418)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'fedpa' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('S.A. "' = 'ASSA' AND 'LUISQUIROS@LIDERESENSEGUROS.COM' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-12-2055290-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE('2025-11-14', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-12-2055290-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('"BIG TRUCK TRABAJANDO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-12-2055290-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, '2025-11-14', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-12-2055290-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-12-2055290-0', 
    '"BIG TRUCK TRABAJANDO', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', 'LUISQUIROS@LIDERESENSEGUROS.COM',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'fedpa'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 418/692: 04-08-1883337-0 - WILFREDO CASTA�EDA URQUIJO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 419)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luisquiros@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 13.2 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-08-1883337-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-03-26', start_date),
      renewal_date = COALESCE('2026-03-26', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-08-1883337-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('WILFREDO CASTA�EDA URQUIJO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-08-1883337-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-03-26', '2026-03-26', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-08-1883337-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-08-1883337-0', 
    'WILFREDO CASTA�EDA URQUIJO', 
    v_insurer_id, 
    v_broker_id,
    13.2,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luisquiros@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 419/692: 1-16-65530 - KAROLINA VARELA RIVERA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 420)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luisquiros@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 5.68 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-65530'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-65530';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('KAROLINA VARELA RIVERA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-65530', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-65530';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-65530', 
    'KAROLINA VARELA RIVERA', 
    v_insurer_id, 
    v_broker_id,
    5.68,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luisquiros@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 420/692: 1-30-745317 - BRAYAM JAVIER GONZALEZ SANCHEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 421)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luisquiros@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 6.91 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-30-745317'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-30-745317';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('BRAYAM JAVIER GONZALEZ SANCHEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-30-745317', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-30-745317';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-30-745317', 
    'BRAYAM JAVIER GONZALEZ SANCHEZ', 
    v_insurer_id, 
    v_broker_id,
    6.91,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luisquiros@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 421/692: 1-16-46420 - INGRID NAHIR NAVARRO PEREZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 422)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luisquiros@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10.72 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-46420'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-46420';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('INGRID NAHIR NAVARRO PEREZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-46420', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-46420';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-46420', 
    'INGRID NAHIR NAVARRO PEREZ', 
    v_insurer_id, 
    v_broker_id,
    10.72,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luisquiros@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 422/692: 1-16-58776 - EDWARD EFRAIN BATISTA CORRALES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 423)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luisquiros@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 12.76 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-58776'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-58776';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('EDWARD EFRAIN BATISTA CORRALES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-58776', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-58776';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-58776', 
    'EDWARD EFRAIN BATISTA CORRALES', 
    v_insurer_id, 
    v_broker_id,
    12.76,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luisquiros@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 423/692: 1-16-60650 - MELISSA SULEYKA ADAMS GUERRA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 424)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luisquiros@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 6.37 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-60650'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-60650';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MELISSA SULEYKA ADAMS GUERRA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-60650', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-60650';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-60650', 
    'MELISSA SULEYKA ADAMS GUERRA', 
    v_insurer_id, 
    v_broker_id,
    6.37,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luisquiros@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 424/692: 1-16-61816 - YORLENY YOARI HASSAN LOMBARDO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 425)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luisquiros@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 19.99 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-61816'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-61816';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('YORLENY YOARI HASSAN LOMBARDO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-61816', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-61816';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-61816', 
    'YORLENY YOARI HASSAN LOMBARDO', 
    v_insurer_id, 
    v_broker_id,
    19.99,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luisquiros@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 425/692: 1-16-61816 - YORLENY YOARI HASSAN LOMBARDO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 426)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luisquiros@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 19.99 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-61816'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-61816';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('YORLENY YOARI HASSAN LOMBARDO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-61816', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-61816';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-61816', 
    'YORLENY YOARI HASSAN LOMBARDO', 
    v_insurer_id, 
    v_broker_id,
    19.99,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luisquiros@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 426/692: 1-16-64593 - NERELCI CORTES GUERRERO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 427)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luisquiros@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 4.73 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-64593'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-64593';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('NERELCI CORTES GUERRERO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-64593', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-64593';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-64593', 
    'NERELCI CORTES GUERRERO', 
    v_insurer_id, 
    v_broker_id,
    4.73,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luisquiros@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 427/692: 1-16-65530 - KAROLINA VARELA RIVERA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 428)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luisquiros@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.28 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-65530'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-65530';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('KAROLINA VARELA RIVERA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-65530', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-65530';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-65530', 
    'KAROLINA VARELA RIVERA', 
    v_insurer_id, 
    v_broker_id,
    0.28,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luisquiros@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 428/692: 1-30-689291 - CARLOS EDUARDO HUNG CESPEDES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 429)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luisquiros@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.51 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-30-689291'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-30-689291';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CARLOS EDUARDO HUNG CESPEDES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-30-689291', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-30-689291';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-30-689291', 
    'CARLOS EDUARDO HUNG CESPEDES', 
    v_insurer_id, 
    v_broker_id,
    11.51,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luisquiros@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 429/692: 1-30-745317 - BRAYAM JAVIER GONZALEZ SANCHEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 430)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luisquiros@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 6.91 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-30-745317'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-30-745317';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('BRAYAM JAVIER GONZALEZ SANCHEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-30-745317', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-30-745317';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-30-745317', 
    'BRAYAM JAVIER GONZALEZ SANCHEZ', 
    v_insurer_id, 
    v_broker_id,
    6.91,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luisquiros@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 430/692: 04-04-1424782-2 - IVAN PEREIRA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 431)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'luzgraciela@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.08 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-1424782-2'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-08-10', start_date),
      renewal_date = COALESCE('2026-08-10', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-1424782-2';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('IVAN PEREIRA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-1424782-2', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-08-10', '2026-08-10', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-1424782-2';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-1424782-2', 
    'IVAN PEREIRA', 
    v_insurer_id, 
    v_broker_id,
    11.08,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'luzgraciela@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 431/692: 14B56287 - LUZ ELENA TREJOS LONDO�O
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 432)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 1.07 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B56287'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-06-28', start_date),
      renewal_date = COALESCE('2026-06-28', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B56287';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('LUZ ELENA TREJOS LONDO�O', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B56287', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-06-28', '2026-06-28', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B56287';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B56287', 
    'LUZ ELENA TREJOS LONDO�O', 
    v_insurer_id, 
    v_broker_id,
    1.07,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 432/692: 14B70799 - ISABEL CRISTINA RANGEL SANCHEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 433)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'mhseguros84@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 6.3 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B70799'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-02-04', start_date),
      renewal_date = COALESCE('2026-02-04', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B70799';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ISABEL CRISTINA RANGEL SANCHEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B70799', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-02-04', '2026-02-04', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B70799';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B70799', 
    'ISABEL CRISTINA RANGEL SANCHEZ', 
    v_insurer_id, 
    v_broker_id,
    6.3,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'mhseguros84@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 433/692: 02B3412576 - BETHANIA BELEN FERRER
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 434)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'maria.urgelles@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.13 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3412576'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-05-06', start_date),
      renewal_date = COALESCE('2026-05-06', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3412576';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('BETHANIA BELEN FERRER', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3412576', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-05-06', '2026-05-06', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3412576';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3412576', 
    'BETHANIA BELEN FERRER', 
    v_insurer_id, 
    v_broker_id,
    9.13,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'maria.urgelles@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 434/692: 14B81149 - NICOLE MARIE MIRO PANAY DE RICO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 435)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'maria.urgelles@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 23.02 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B81149'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-16', start_date),
      renewal_date = COALESCE('2026-09-16', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B81149';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('NICOLE MARIE MIRO PANAY DE RICO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B81149', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-16', '2026-09-16', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B81149';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B81149', 
    'NICOLE MARIE MIRO PANAY DE RICO', 
    v_insurer_id, 
    v_broker_id,
    23.02,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'maria.urgelles@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 435/692: 60B73537 - ALESSANDRO GIACOMAZZI
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 436)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'maria.urgelles@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.52 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '60B73537'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2024-12-13', start_date),
      renewal_date = COALESCE('2025-12-13', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 60B73537';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ALESSANDRO GIACOMAZZI', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '60B73537', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2024-12-13', '2025-12-13', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 60B73537';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '60B73537', 
    'ALESSANDRO GIACOMAZZI', 
    v_insurer_id, 
    v_broker_id,
    11.52,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'maria.urgelles@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 436/692: 02B3429826 - BELINDA FRANCIA PANAY RAMIREZ DE MIRO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 437)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'maria.urgelles@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 14.43 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3429826'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-06', start_date),
      renewal_date = COALESCE('2026-11-06', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3429826';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('BELINDA FRANCIA PANAY RAMIREZ DE MIRO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3429826', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-06', '2026-11-06', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3429826';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3429826', 
    'BELINDA FRANCIA PANAY RAMIREZ DE MIRO', 
    v_insurer_id, 
    v_broker_id,
    14.43,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'maria.urgelles@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 437/692: 02B3423835 - BARBARA GIACOMAZZI
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 438)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'maria.urgelles@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.57 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3423835'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-04', start_date),
      renewal_date = COALESCE('2026-09-04', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3423835';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('BARBARA GIACOMAZZI', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3423835', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-04', '2026-09-04', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3423835';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3423835', 
    'BARBARA GIACOMAZZI', 
    v_insurer_id, 
    v_broker_id,
    11.57,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'maria.urgelles@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 438/692: 02B3427702 - VICTOR MANUEL CASTILLO ALFONZO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 439)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'maria.urgelles@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 14.93 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3427702'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-10-15', start_date),
      renewal_date = COALESCE('2026-10-15', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3427702';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('VICTOR MANUEL CASTILLO ALFONZO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3427702', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-10-15', '2026-10-15', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3427702';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3427702', 
    'VICTOR MANUEL CASTILLO ALFONZO', 
    v_insurer_id, 
    v_broker_id,
    14.93,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'maria.urgelles@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 439/692: 1809-00885-01 - LUIS RAFAEL LOPEZ MORATA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 440)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'maria.urgelles@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 38.81 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1809-00885-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1809-00885-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('LUIS RAFAEL LOPEZ MORATA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1809-00885-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1809-00885-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1809-00885-01', 
    'LUIS RAFAEL LOPEZ MORATA', 
    v_insurer_id, 
    v_broker_id,
    38.81,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'maria.urgelles@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 440/692: 0225-00638-09 - RICARDO  HERRERO CHOCRON
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 441)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'maria.urgelles@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.85 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0225-00638-09'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0225-00638-09';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('RICARDO  HERRERO CHOCRON', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0225-00638-09', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0225-00638-09';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0225-00638-09', 
    'RICARDO  HERRERO CHOCRON', 
    v_insurer_id, 
    v_broker_id,
    9.85,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'maria.urgelles@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 441/692: 3263 - "SEAL PANAMA GROUP
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'S.A."' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: S.A." (fila 442)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'acerta' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('S.A."' = 'ASSA' AND 'MARIA.URGELLES@GMAIL.COM' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '3263'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 3263';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('"SEAL PANAMA GROUP', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '3263', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 3263';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '3263', 
    '"SEAL PANAMA GROUP', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', 'MARIA.URGELLES@GMAIL.COM',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'acerta'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 442/692: 10367 - "SEAL PANAMA GROUP
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'S.A."' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: S.A." (fila 443)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'acerta' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('S.A."' = 'ASSA' AND 'MARIA.URGELLES@GMAIL.COM' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '10367'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 10367';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('"SEAL PANAMA GROUP', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '10367', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 10367';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '10367', 
    '"SEAL PANAMA GROUP', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', 'MARIA.URGELLES@GMAIL.COM',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'acerta'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 443/692: 10367 - "SEAL PANAMA GROUP
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'S.A."' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: S.A." (fila 444)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'acerta' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('S.A."' = 'ASSA' AND 'MARIA.URGELLES@GMAIL.COM' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '10367'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 10367';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('"SEAL PANAMA GROUP', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '10367', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 10367';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '10367', 
    '"SEAL PANAMA GROUP', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', 'MARIA.URGELLES@GMAIL.COM',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'acerta'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 444/692: 1-16-39348 - DANIELE GIACOMAZZI
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 445)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'maria.urgelles@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.14 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-39348'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-39348';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('DANIELE GIACOMAZZI', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-39348', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-39348';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-39348', 
    'DANIELE GIACOMAZZI', 
    v_insurer_id, 
    v_broker_id,
    8.14,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'maria.urgelles@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 445/692: 1-16-47858 - SALAZAR ALVAREZ NASSTASYA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 446)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'maria.urgelles@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10.72 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-47858'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-47858';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('SALAZAR ALVAREZ NASSTASYA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-47858', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-47858';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-47858', 
    'SALAZAR ALVAREZ NASSTASYA', 
    v_insurer_id, 
    v_broker_id,
    10.72,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'maria.urgelles@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 446/692: 1-33-212004 - "INVERSIONES PAURVICA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'S.A."' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: S.A." (fila 447)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'internacional' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('S.A."' = 'ASSA' AND 'MARIA.URGELLES@GMAIL.COM' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-33-212004'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-33-212004';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('"INVERSIONES PAURVICA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-33-212004', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-33-212004';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-33-212004', 
    '"INVERSIONES PAURVICA', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', 'MARIA.URGELLES@GMAIL.COM',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'internacional'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 447/692: 1-34-212004 - "INVERSIONES PAURVICA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'S.A."' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: S.A." (fila 448)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'internacional' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('S.A."' = 'ASSA' AND 'MARIA.URGELLES@GMAIL.COM' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-34-212004'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-34-212004';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('"INVERSIONES PAURVICA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-34-212004', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-34-212004';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-34-212004', 
    '"INVERSIONES PAURVICA', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', 'MARIA.URGELLES@GMAIL.COM',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'internacional'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 448/692: 1-36-212004 - "INVERSIONES PAURVICA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'S.A."' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: S.A." (fila 449)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'internacional' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('S.A."' = 'ASSA' AND 'MARIA.URGELLES@GMAIL.COM' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-36-212004'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-36-212004';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('"INVERSIONES PAURVICA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-36-212004', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-36-212004';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-36-212004', 
    '"INVERSIONES PAURVICA', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', 'MARIA.URGELLES@GMAIL.COM',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'internacional'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 449/692: 1-37-212004 - "INVERSIONES PAURVICA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'S.A."' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: S.A." (fila 450)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'internacional' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('S.A."' = 'ASSA' AND 'MARIA.URGELLES@GMAIL.COM' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-37-212004'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-37-212004';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('"INVERSIONES PAURVICA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-37-212004', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-37-212004';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-37-212004', 
    '"INVERSIONES PAURVICA', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', 'MARIA.URGELLES@GMAIL.COM',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'internacional'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 450/692: 1-40-212004 - "INVERSIONES PAURVICA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'S.A."' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: S.A." (fila 451)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'internacional' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('S.A."' = 'ASSA' AND 'MARIA.URGELLES@GMAIL.COM' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-40-212004'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-40-212004';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('"INVERSIONES PAURVICA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-40-212004', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-40-212004';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-40-212004', 
    '"INVERSIONES PAURVICA', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', 'MARIA.URGELLES@GMAIL.COM',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'internacional'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 451/692: 105030 - "ELEMENTOS & ESPACIOS DESIGN
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'S.A."' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: S.A." (fila 452)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'optima' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('S.A."' = 'ASSA' AND 'MARIA.URGELLES@GMAIL.COM' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '105030'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 105030';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('"ELEMENTOS & ESPACIOS DESIGN', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '105030', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 105030';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '105030', 
    '"ELEMENTOS & ESPACIOS DESIGN', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', 'MARIA.URGELLES@GMAIL.COM',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'optima'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 452/692: 108231 - GIORGIO TEDESCO RAMIREZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'OPTIMA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: OPTIMA (fila 453)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'maria.urgelles@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('OPTIMA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 2.61 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '108231'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 108231';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('GIORGIO TEDESCO RAMIREZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '108231', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 108231';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '108231', 
    'GIORGIO TEDESCO RAMIREZ', 
    v_insurer_id, 
    v_broker_id,
    2.61,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'maria.urgelles@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 453/692: 106584 - VICTOR ALEJANDRO DE FREITAS PORTOS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'OPTIMA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: OPTIMA (fila 454)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'maria.urgelles@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('OPTIMA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 5.3 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '106584'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 106584';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('VICTOR ALEJANDRO DE FREITAS PORTOS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '106584', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 106584';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '106584', 
    'VICTOR ALEJANDRO DE FREITAS PORTOS', 
    v_insurer_id, 
    v_broker_id,
    5.3,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'maria.urgelles@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 454/692: 109389 - "LA MARINA 102
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'S.A."' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: S.A." (fila 455)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'optima' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('S.A."' = 'ASSA' AND 'MARIA.URGELLES@GMAIL.COM' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '109389'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 109389';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('"LA MARINA 102', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '109389', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 109389';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '109389', 
    '"LA MARINA 102', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', 'MARIA.URGELLES@GMAIL.COM',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'optima'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 455/692: 01-82-1099895-1 - "LA RESERVA 400
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'S.A."' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: S.A." (fila 456)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'sura' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('S.A."' = 'ASSA' AND 'MARIA.URGELLES@GMAIL.COM' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '01-82-1099895-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 01-82-1099895-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('"LA RESERVA 400', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '01-82-1099895-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 01-82-1099895-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '01-82-1099895-1', 
    '"LA RESERVA 400', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', 'MARIA.URGELLES@GMAIL.COM',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'sura'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 456/692: 081300113887 - YENNIFER DE FREITAS GOUVEIA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 457)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'maria.urgelles@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 4.62 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '081300113887'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 081300113887';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('YENNIFER DE FREITAS GOUVEIA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '081300113887', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 081300113887';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '081300113887', 
    'YENNIFER DE FREITAS GOUVEIA', 
    v_insurer_id, 
    v_broker_id,
    4.62,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'maria.urgelles@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 457/692: 02-93-1155037-1 - GIORGIO TEDESCO RAMIREZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 458)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'maria.urgelles@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := -14.29 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-93-1155037-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-93-1155037-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('GIORGIO TEDESCO RAMIREZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-93-1155037-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-93-1155037-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-93-1155037-1', 
    'GIORGIO TEDESCO RAMIREZ', 
    v_insurer_id, 
    v_broker_id,
    -14.29,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'maria.urgelles@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 458/692: 02-93-1149235-1 - LUIS HERNANDEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 459)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'maria.urgelles@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 12.77 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-93-1149235-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-93-1149235-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('LUIS HERNANDEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-93-1149235-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-93-1149235-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-93-1149235-1', 
    'LUIS HERNANDEZ', 
    v_insurer_id, 
    v_broker_id,
    12.77,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'maria.urgelles@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 459/692: 081300113748 - RICARDO HERRERO CHOCRON
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 460)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'maria.urgelles@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 5.5 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '081300113748'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 081300113748';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('RICARDO HERRERO CHOCRON', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '081300113748', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 081300113748';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '081300113748', 
    'RICARDO HERRERO CHOCRON', 
    v_insurer_id, 
    v_broker_id,
    5.5,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'maria.urgelles@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 460/692: 22543 - GOMEZ SANCHEZ PIO IVAN
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'VIVIR' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: VIVIR (fila 461)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'maria.urgelles@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('VIVIR' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 23.72 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '22543'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 22543';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('GOMEZ SANCHEZ PIO IVAN', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '22543', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 22543';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '22543', 
    'GOMEZ SANCHEZ PIO IVAN', 
    v_insurer_id, 
    v_broker_id,
    23.72,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'maria.urgelles@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 461/692: 1-33-209559 - RAIZA ISELA RODRIGUEZ BOTELLO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 462)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'marlynbotello@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 24.1 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-33-209559'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-33-209559';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('RAIZA ISELA RODRIGUEZ BOTELLO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-33-209559', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-33-209559';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-33-209559', 
    'RAIZA ISELA RODRIGUEZ BOTELLO', 
    v_insurer_id, 
    v_broker_id,
    24.1,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'marlynbotello@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 462/692: 1-34-209559 - RAIZA ISELA RODRIGUEZ BOTELLO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 463)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'marlynbotello@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 2.68 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-34-209559'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-34-209559';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('RAIZA ISELA RODRIGUEZ BOTELLO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-34-209559', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-34-209559';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-34-209559', 
    'RAIZA ISELA RODRIGUEZ BOTELLO', 
    v_insurer_id, 
    v_broker_id,
    2.68,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'marlynbotello@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 463/692: 0215-00389-06 - MODESTO  PEREZ ZAMORANO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 464)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'marlynbotello@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 6.26 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0215-00389-06'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0215-00389-06';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MODESTO  PEREZ ZAMORANO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0215-00389-06', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0215-00389-06';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0215-00389-06', 
    'MODESTO  PEREZ ZAMORANO', 
    v_insurer_id, 
    v_broker_id,
    6.26,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'marlynbotello@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 464/692: 60B30486 - MAURICIO RODRIGUEZ MU�OZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 465)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 3.05 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '60B30486'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-08-04', start_date),
      renewal_date = COALESCE('2026-08-04', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 60B30486';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MAURICIO RODRIGUEZ MU�OZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '60B30486', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-08-04', '2026-08-04', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 60B30486';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '60B30486', 
    'MAURICIO RODRIGUEZ MU�OZ', 
    v_insurer_id, 
    v_broker_id,
    3.05,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 465/692: 60B30291 - JACQUELINE DEL CARMEN ALVAREZ YANGUEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 466)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.72 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '60B30291'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-19', start_date),
      renewal_date = COALESCE('2026-07-19', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 60B30291';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JACQUELINE DEL CARMEN ALVAREZ YANGUEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '60B30291', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-19', '2026-07-19', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 60B30291';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '60B30291', 
    'JACQUELINE DEL CARMEN ALVAREZ YANGUEZ', 
    v_insurer_id, 
    v_broker_id,
    0.72,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 466/692: 0220-01688-09 - ROSEMARIE RAQUEL RIOS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 467)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'minismei@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 6.23 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0220-01688-09'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0220-01688-09';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ROSEMARIE RAQUEL RIOS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0220-01688-09', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0220-01688-09';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0220-01688-09', 
    'ROSEMARIE RAQUEL RIOS', 
    v_insurer_id, 
    v_broker_id,
    6.23,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'minismei@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 467/692: 04-04-1854286-0 - BRENDA ARIADNE ARAUZ NIETO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 468)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'minismei@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 22.3 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-1854286-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-02-19', start_date),
      renewal_date = COALESCE('2026-02-19', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-1854286-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('BRENDA ARIADNE ARAUZ NIETO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-1854286-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-02-19', '2026-02-19', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-1854286-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-1854286-0', 
    'BRENDA ARIADNE ARAUZ NIETO', 
    v_insurer_id, 
    v_broker_id,
    22.3,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'minismei@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 468/692: 02-93-1081678-1 - RICARDO PRIAS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 469)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'minismei@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.97 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-93-1081678-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-93-1081678-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('RICARDO PRIAS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-93-1081678-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-93-1081678-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-93-1081678-1', 
    'RICARDO PRIAS', 
    v_insurer_id, 
    v_broker_id,
    9.97,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'minismei@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 469/692: 04-05-2051998-0 - LUCIANO BOZO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 470)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'mitxel2086@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 13.21 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-05-2051998-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-07', start_date),
      renewal_date = COALESCE('2026-11-07', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-05-2051998-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('LUCIANO BOZO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-05-2051998-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-07', '2026-11-07', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-05-2051998-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-05-2051998-0', 
    'LUCIANO BOZO', 
    v_insurer_id, 
    v_broker_id,
    13.21,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'mitxel2086@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 470/692: 04-05-1017358-4 - SHAROLL DENISSE HERRERA ESPINOSA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 471)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'contacto@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 17.55 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-05-1017358-4'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-04-16', start_date),
      renewal_date = COALESCE('2026-04-16', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-05-1017358-4';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('SHAROLL DENISSE HERRERA ESPINOSA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-05-1017358-4', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-04-16', '2026-04-16', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-05-1017358-4';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-05-1017358-4', 
    'SHAROLL DENISSE HERRERA ESPINOSA', 
    v_insurer_id, 
    v_broker_id,
    17.55,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'contacto@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 471/692: 02B3399282 - DIANA ESTHER LOPEZ SALDANA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 472)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'marguezpty@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 7.67 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3399282'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2024-12-14', start_date),
      renewal_date = COALESCE('2025-12-14', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3399282';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('DIANA ESTHER LOPEZ SALDANA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3399282', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2024-12-14', '2025-12-14', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3399282';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3399282', 
    'DIANA ESTHER LOPEZ SALDANA', 
    v_insurer_id, 
    v_broker_id,
    7.67,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'marguezpty@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 472/692: 60B73629 - GISEL STEPHANIE GOMEZ RODRIGUEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 473)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'marguezpty@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 7.44 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '60B73629'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-01-10', start_date),
      renewal_date = COALESCE('2026-01-10', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 60B73629';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('GISEL STEPHANIE GOMEZ RODRIGUEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '60B73629', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-01-10', '2026-01-10', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 60B73629';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '60B73629', 
    'GISEL STEPHANIE GOMEZ RODRIGUEZ', 
    v_insurer_id, 
    v_broker_id,
    7.44,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'marguezpty@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 473/692: 1-30-678088 - RODRIGUEZ   THELSY
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 474)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.99 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-30-678088'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-30-678088';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('RODRIGUEZ   THELSY', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-30-678088', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-30-678088';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-30-678088', 
    'RODRIGUEZ   THELSY', 
    v_insurer_id, 
    v_broker_id,
    11.99,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 474/692: 02B3374777 - OROSMAN TOMAS GONZALEZ HENRIQUEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 475)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'pauli88@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 19.12 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3374777'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-02-06', start_date),
      renewal_date = COALESCE('2026-02-06', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3374777';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('OROSMAN TOMAS GONZALEZ HENRIQUEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3374777', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-02-06', '2026-02-06', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3374777';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3374777', 
    'OROSMAN TOMAS GONZALEZ HENRIQUEZ', 
    v_insurer_id, 
    v_broker_id,
    19.12,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'pauli88@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 475/692: 1-33-127280 - GONZALEZ ANTELO OROSMAN E.
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 476)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'pauli88@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10.13 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-33-127280'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-33-127280';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('GONZALEZ ANTELO OROSMAN E.', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-33-127280', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-33-127280';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-33-127280', 
    'GONZALEZ ANTELO OROSMAN E.', 
    v_insurer_id, 
    v_broker_id,
    10.13,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'pauli88@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 476/692: 1-34-127280 - GONZALEZ ANTELO OROSMAN E.
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 477)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'pauli88@yahoo.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 1.13 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-34-127280'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-34-127280';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('GONZALEZ ANTELO OROSMAN E.', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-34-127280', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-34-127280';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-34-127280', 
    'GONZALEZ ANTELO OROSMAN E.', 
    v_insurer_id, 
    v_broker_id,
    1.13,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'pauli88@yahoo.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 477/692: 03B80132 - RONYEL ROBERTO RUDAS OLMOS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 478)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'rj.jimenez.173@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 2.8 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '03B80132'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-12', start_date),
      renewal_date = COALESCE('2026-11-12', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 03B80132';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('RONYEL ROBERTO RUDAS OLMOS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '03B80132', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-12', '2026-11-12', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 03B80132';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '03B80132', 
    'RONYEL ROBERTO RUDAS OLMOS', 
    v_insurer_id, 
    v_broker_id,
    2.8,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'rj.jimenez.173@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 478/692: 0224-01406-01 - JOSE PRAXEDES DE LEON DE LEON
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 479)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'rj.jimenez.173@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.25 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0224-01406-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0224-01406-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JOSE PRAXEDES DE LEON DE LEON', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0224-01406-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0224-01406-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0224-01406-01', 
    'JOSE PRAXEDES DE LEON DE LEON', 
    v_insurer_id, 
    v_broker_id,
    11.25,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'rj.jimenez.173@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 479/692: 04-04-1790807-0 - ROSEMARY MARTINEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 480)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'rj.jimenez.173@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := -7.3 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-1790807-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2024-11-30', start_date),
      renewal_date = COALESCE('2025-11-30', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-1790807-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ROSEMARY MARTINEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-1790807-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2024-11-30', '2025-11-30', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-1790807-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-1790807-0', 
    'ROSEMARY MARTINEZ', 
    v_insurer_id, 
    v_broker_id,
    -7.3,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'rj.jimenez.173@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 480/692: 04-04-1790807-1 - ROSEMARY MARTINEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 481)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'rj.jimenez.173@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 7.3 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-1790807-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-30', start_date),
      renewal_date = COALESCE('2026-11-30', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-1790807-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ROSEMARY MARTINEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-1790807-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-30', '2026-11-30', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-1790807-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-1790807-1', 
    'ROSEMARY MARTINEZ', 
    v_insurer_id, 
    v_broker_id,
    7.3,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'rj.jimenez.173@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 481/692: 04-04-1951879-0 - JENNY ESTHER MORENO VALDES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 482)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'rj.jimenez.173@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 7.29 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-1951879-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-05', start_date),
      renewal_date = COALESCE('2026-07-05', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-1951879-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JENNY ESTHER MORENO VALDES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-1951879-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-05', '2026-07-05', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-1951879-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-1951879-0', 
    'JENNY ESTHER MORENO VALDES', 
    v_insurer_id, 
    v_broker_id,
    7.29,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'rj.jimenez.173@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 482/692: 04-05-1770806-1 - KIRIAM GOMEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 483)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'rj.jimenez.173@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 14.36 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-05-1770806-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-06', start_date),
      renewal_date = COALESCE('2026-11-06', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-05-1770806-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('KIRIAM GOMEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-05-1770806-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-06', '2026-11-06', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-05-1770806-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-05-1770806-1', 
    'KIRIAM GOMEZ', 
    v_insurer_id, 
    v_broker_id,
    14.36,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'rj.jimenez.173@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 483/692: 04-05-1778335-1 - RAFAEL DE HERMOSO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 484)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'rj.jimenez.173@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 28.3 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-05-1778335-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-15', start_date),
      renewal_date = COALESCE('2026-11-15', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-05-1778335-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('RAFAEL DE HERMOSO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-05-1778335-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-15', '2026-11-15', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-05-1778335-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-05-1778335-1', 
    'RAFAEL DE HERMOSO', 
    v_insurer_id, 
    v_broker_id,
    28.3,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'rj.jimenez.173@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 484/692: 1-16-61629 - SUGHEILIZ LINETH LINARES ATENCIO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 485)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'rj.jimenez.173@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.14 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-61629'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-61629';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('SUGHEILIZ LINETH LINARES ATENCIO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-61629', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-61629';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-61629', 
    'SUGHEILIZ LINETH LINARES ATENCIO', 
    v_insurer_id, 
    v_broker_id,
    8.14,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'rj.jimenez.173@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 485/692: 1-16-61679 - MILAGROS DEL CARMEN JUAREZ VILLAR
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 486)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'rj.jimenez.173@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 4.46 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-61679'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-61679';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MILAGROS DEL CARMEN JUAREZ VILLAR', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-61679', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-61679';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-61679', 
    'MILAGROS DEL CARMEN JUAREZ VILLAR', 
    v_insurer_id, 
    v_broker_id,
    4.46,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'rj.jimenez.173@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 486/692: 1-16-63814 - EIVAR ADDIEL FRANCO CERA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 487)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'rj.jimenez.173@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 4.73 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-63814'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-63814';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('EIVAR ADDIEL FRANCO CERA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-63814', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-63814';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-63814', 
    'EIVAR ADDIEL FRANCO CERA', 
    v_insurer_id, 
    v_broker_id,
    4.73,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'rj.jimenez.173@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 487/692: 1-16-63815 - EIVAR ADDIEL FRANCO CERA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 488)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'rj.jimenez.173@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 4.73 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-63815'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-63815';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('EIVAR ADDIEL FRANCO CERA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-63815', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-63815';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-63815', 
    'EIVAR ADDIEL FRANCO CERA', 
    v_insurer_id, 
    v_broker_id,
    4.73,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'rj.jimenez.173@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 488/692: 1-16-65599 - RAFAEL ALFONSO DE HERMOSO MENDOZA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 489)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'rj.jimenez.173@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.77 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-65599'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-65599';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('RAFAEL ALFONSO DE HERMOSO MENDOZA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-65599', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-65599';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-65599', 
    'RAFAEL ALFONSO DE HERMOSO MENDOZA', 
    v_insurer_id, 
    v_broker_id,
    9.77,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'rj.jimenez.173@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 489/692: 1-16-64723 - URIEL ANDRE REYNA SUBERA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 490)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'rj.jimenez.173@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 4.02 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-64723'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-64723';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('URIEL ANDRE REYNA SUBERA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-64723', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-64723';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-64723', 
    'URIEL ANDRE REYNA SUBERA', 
    v_insurer_id, 
    v_broker_id,
    4.02,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'rj.jimenez.173@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 490/692: 4-16-2179 - KEYSI VIANETH AGUIRRE
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 491)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'rj.jimenez.173@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.52 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '4-16-2179'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 4-16-2179';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('KEYSI VIANETH AGUIRRE', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '4-16-2179', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 4-16-2179';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '4-16-2179', 
    'KEYSI VIANETH AGUIRRE', 
    v_insurer_id, 
    v_broker_id,
    9.52,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'rj.jimenez.173@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 491/692: 2173141 - YASMIRA ESTHER  DIAZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'REGIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: REGIONAL (fila 492)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'rj.jimenez.173@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('REGIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 5.96 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2173141'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2173141';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('YASMIRA ESTHER  DIAZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2173141', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2173141';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2173141', 
    'YASMIRA ESTHER  DIAZ', 
    v_insurer_id, 
    v_broker_id,
    5.96,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'rj.jimenez.173@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 492/692: 2185621 - YANISBETH DEL CARMEN GUERRA RODRIGUEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'REGIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: REGIONAL (fila 493)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'rj.jimenez.173@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('REGIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 7.93 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2185621'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2185621';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('YANISBETH DEL CARMEN GUERRA RODRIGUEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2185621', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2185621';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2185621', 
    'YANISBETH DEL CARMEN GUERRA RODRIGUEZ', 
    v_insurer_id, 
    v_broker_id,
    7.93,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'rj.jimenez.173@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 493/692: 2192985 - YULEIZIE ZAIRE RODRIGUEZ AROSEMENA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'REGIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: REGIONAL (fila 494)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'rj.jimenez.173@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('REGIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.11 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2192985'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2192985';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('YULEIZIE ZAIRE RODRIGUEZ AROSEMENA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2192985', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2192985';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2192985', 
    'YULEIZIE ZAIRE RODRIGUEZ AROSEMENA', 
    v_insurer_id, 
    v_broker_id,
    8.11,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'rj.jimenez.173@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 494/692: 02-93-1163086-1 - SONIA MARITZA SIMMONS MALCOME DE GONZALEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 495)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'rj.jimenez.173@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 106.69 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-93-1163086-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-93-1163086-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('SONIA MARITZA SIMMONS MALCOME DE GONZALEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-93-1163086-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-93-1163086-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-93-1163086-1', 
    'SONIA MARITZA SIMMONS MALCOME DE GONZALEZ', 
    v_insurer_id, 
    v_broker_id,
    106.69,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'rj.jimenez.173@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 495/692: 02-93-1103596-1 - SANDRA ISABEL CENTELLA CASTILLO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 496)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'rj.jimenez.173@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.55 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-93-1103596-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-93-1103596-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('SANDRA ISABEL CENTELLA CASTILLO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-93-1103596-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-93-1103596-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-93-1103596-1', 
    'SANDRA ISABEL CENTELLA CASTILLO', 
    v_insurer_id, 
    v_broker_id,
    8.55,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'rj.jimenez.173@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 496/692: 02-93-1103596-1 - SANDRA ISABEL CENTELLA CASTILLO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 497)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'rj.jimenez.173@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.55 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-93-1103596-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-93-1103596-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('SANDRA ISABEL CENTELLA CASTILLO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-93-1103596-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-93-1103596-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-93-1103596-1', 
    'SANDRA ISABEL CENTELLA CASTILLO', 
    v_insurer_id, 
    v_broker_id,
    8.55,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'rj.jimenez.173@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 497/692: 02-93-1195682-0 - MAURICIO GARCIA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 498)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'rj.jimenez.173@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10.94 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-93-1195682-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-93-1195682-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MAURICIO GARCIA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-93-1195682-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-93-1195682-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-93-1195682-0', 
    'MAURICIO GARCIA', 
    v_insurer_id, 
    v_broker_id,
    10.94,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'rj.jimenez.173@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 498/692: 18311 - BETHANCOURT ROMERO JESUS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'VIVIR' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: VIVIR (fila 499)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'rj.jimenez.173@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('VIVIR' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10.37 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '18311'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 18311';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('BETHANCOURT ROMERO JESUS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '18311', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 18311';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '18311', 
    'BETHANCOURT ROMERO JESUS', 
    v_insurer_id, 
    v_broker_id,
    10.37,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'rj.jimenez.173@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 499/692: 02B3421652 - NEYRA BARAHONA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 500)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'segurosrv@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.99 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3421652'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-08-12', start_date),
      renewal_date = COALESCE('2026-08-12', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3421652';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('NEYRA BARAHONA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3421652', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-08-12', '2026-08-12', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3421652';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3421652', 
    'NEYRA BARAHONA', 
    v_insurer_id, 
    v_broker_id,
    11.99,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'segurosrv@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 500/692: 0320-00122-01 - CHRISTO HENRY GARIBALDI ZAVALA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 501)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'segurosrv@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 4.88 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0320-00122-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0320-00122-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CHRISTO HENRY GARIBALDI ZAVALA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0320-00122-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0320-00122-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0320-00122-01', 
    'CHRISTO HENRY GARIBALDI ZAVALA', 
    v_insurer_id, 
    v_broker_id,
    4.88,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'segurosrv@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 501/692: 0223-03534-01 - EMELY BONETH GUTIERREZ DE GRACIA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 502)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'segurosrv@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10.75 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0223-03534-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0223-03534-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('EMELY BONETH GUTIERREZ DE GRACIA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0223-03534-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0223-03534-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0223-03534-01', 
    'EMELY BONETH GUTIERREZ DE GRACIA', 
    v_insurer_id, 
    v_broker_id,
    10.75,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'segurosrv@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 502/692: 0125-08055-01 - CHRISTO HENRY GARIBALDI ZAVALA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 503)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'segurosrv@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 50 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0125-08055-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0125-08055-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CHRISTO HENRY GARIBALDI ZAVALA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0125-08055-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0125-08055-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0125-08055-01', 
    'CHRISTO HENRY GARIBALDI ZAVALA', 
    v_insurer_id, 
    v_broker_id,
    50,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'segurosrv@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 503/692: 0222-02750-01 - DAYSI ESPERANZA CHONG GALLARDO DE M
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 504)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'segurosrv@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 14.15 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0222-02750-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0222-02750-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('DAYSI ESPERANZA CHONG GALLARDO DE M', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0222-02750-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0222-02750-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0222-02750-01', 
    'DAYSI ESPERANZA CHONG GALLARDO DE M', 
    v_insurer_id, 
    v_broker_id,
    14.15,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'segurosrv@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 504/692: 0320-00122-01 - CHRISTO HENRY GARIBALDI ZAVALA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 505)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'segurosrv@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 19.5 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0320-00122-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0320-00122-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CHRISTO HENRY GARIBALDI ZAVALA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0320-00122-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0320-00122-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0320-00122-01', 
    'CHRISTO HENRY GARIBALDI ZAVALA', 
    v_insurer_id, 
    v_broker_id,
    19.5,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'segurosrv@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 505/692: 0222-03237-01 - VICTOR ENRIQUE LARA TORRES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 506)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'segurosrv@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 6.6 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0222-03237-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0222-03237-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('VICTOR ENRIQUE LARA TORRES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0222-03237-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0222-03237-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0222-03237-01', 
    'VICTOR ENRIQUE LARA TORRES', 
    v_insurer_id, 
    v_broker_id,
    6.6,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'segurosrv@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 506/692: 04-05-2051028-0 - MARIO UVERTO MORENO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 507)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'segurosrv@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 26.4 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-05-2051028-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-06', start_date),
      renewal_date = COALESCE('2026-11-06', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-05-2051028-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MARIO UVERTO MORENO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-05-2051028-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-06', '2026-11-06', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-05-2051028-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-05-2051028-0', 
    'MARIO UVERTO MORENO', 
    v_insurer_id, 
    v_broker_id,
    26.4,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'segurosrv@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 507/692: 04-05-2052193-0 - YELITZA ESTHER BU GONDOLA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 508)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'segurosrv@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 26.4 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-05-2052193-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-08', start_date),
      renewal_date = COALESCE('2026-11-08', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-05-2052193-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('YELITZA ESTHER BU GONDOLA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-05-2052193-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-08', '2026-11-08', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-05-2052193-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-05-2052193-0', 
    'YELITZA ESTHER BU GONDOLA', 
    v_insurer_id, 
    v_broker_id,
    26.4,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'segurosrv@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 508/692: 04-05-2051053-0 - NILSA JANETH MORENO RODRIGUEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 509)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'segurosrv@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 26.4 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-05-2051053-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-06', start_date),
      renewal_date = COALESCE('2026-11-06', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-05-2051053-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('NILSA JANETH MORENO RODRIGUEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-05-2051053-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-06', '2026-11-06', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-05-2051053-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-05-2051053-0', 
    'NILSA JANETH MORENO RODRIGUEZ', 
    v_insurer_id, 
    v_broker_id,
    26.4,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'segurosrv@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 509/692: 04-05-2051068-0 - NILSA JANETH MORENO RODRIGUEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 510)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'segurosrv@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 26.4 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-05-2051068-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-06', start_date),
      renewal_date = COALESCE('2026-11-06', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-05-2051068-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('NILSA JANETH MORENO RODRIGUEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-05-2051068-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-06', '2026-11-06', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-05-2051068-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-05-2051068-0', 
    'NILSA JANETH MORENO RODRIGUEZ', 
    v_insurer_id, 
    v_broker_id,
    26.4,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'segurosrv@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 510/692: 1-30-745360 - SHALLY I NAVARRO PRAEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 511)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'segurosrv@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.36 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-30-745360'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-30-745360';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('SHALLY I NAVARRO PRAEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-30-745360', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-30-745360';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-30-745360', 
    'SHALLY I NAVARRO PRAEZ', 
    v_insurer_id, 
    v_broker_id,
    9.36,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'segurosrv@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 511/692: 2121965 - "LOPEZ BERGUIDO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'JOSE ORLANDO"' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: JOSE ORLANDO" (fila 512)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'regional' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('JOSE ORLANDO"' = 'ASSA' AND 'SEGUROSRV@GMAIL.COM' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2121965'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2121965';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('"LOPEZ BERGUIDO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2121965', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2121965';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2121965', 
    '"LOPEZ BERGUIDO', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', 'SEGUROSRV@GMAIL.COM',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'regional'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 512/692: 2122705 - "GRETEEL CASTILLO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SPUTNIK"' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SPUTNIK" (fila 513)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'regional' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SPUTNIK"' = 'ASSA' AND 'SEGUROSRV@GMAIL.COM' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2122705'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2122705';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('"GRETEEL CASTILLO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2122705', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2122705';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2122705', 
    '"GRETEEL CASTILLO', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', 'SEGUROSRV@GMAIL.COM',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'regional'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 513/692: 2007429 - "SMITH PONCE
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'RUBEN DARIO"' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: RUBEN DARIO" (fila 514)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'regional' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('RUBEN DARIO"' = 'ASSA' AND 'SEGUROSRV@GMAIL.COM' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2007429'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2007429';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('"SMITH PONCE', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2007429', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2007429';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2007429', 
    '"SMITH PONCE', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', 'SEGUROSRV@GMAIL.COM',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'regional'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 514/692: 14B33749 - MARTA CECILIA CORDOBA DE LOKEE
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 515)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'ruthmejia@cableonda.net' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 2.79 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B33749'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-08-11', start_date),
      renewal_date = COALESCE('2026-08-11', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B33749';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MARTA CECILIA CORDOBA DE LOKEE', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B33749', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-08-11', '2026-08-11', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B33749';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B33749', 
    'MARTA CECILIA CORDOBA DE LOKEE', 
    v_insurer_id, 
    v_broker_id,
    2.79,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'ruthmejia@cableonda.net'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 515/692: 02B257333 - SIMON ABDIEL BATISTA MEJIA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 516)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'ruthmejia@cableonda.net' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 14.7 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B257333'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-02-22', start_date),
      renewal_date = COALESCE('2026-02-22', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B257333';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('SIMON ABDIEL BATISTA MEJIA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B257333', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-02-22', '2026-02-22', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B257333';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B257333', 
    'SIMON ABDIEL BATISTA MEJIA', 
    v_insurer_id, 
    v_broker_id,
    14.7,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'ruthmejia@cableonda.net'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 516/692: 02B3327942 - ALEJANDRO RUIZ ANDRADE
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 517)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'ruthmejia@cableonda.net' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 135.2 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3327942'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-20', start_date),
      renewal_date = COALESCE('2026-09-20', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3327942';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ALEJANDRO RUIZ ANDRADE', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3327942', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-20', '2026-09-20', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3327942';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3327942', 
    'ALEJANDRO RUIZ ANDRADE', 
    v_insurer_id, 
    v_broker_id,
    135.2,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'ruthmejia@cableonda.net'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 517/692: 02B3328374 - NELLY APOLONIA BUCHANAN DE RUIZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 518)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'ruthmejia@cableonda.net' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 144.95 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3328374'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-10-05', start_date),
      renewal_date = COALESCE('2026-10-05', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3328374';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('NELLY APOLONIA BUCHANAN DE RUIZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3328374', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-10-05', '2026-10-05', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3328374';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3328374', 
    'NELLY APOLONIA BUCHANAN DE RUIZ', 
    v_insurer_id, 
    v_broker_id,
    144.95,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'ruthmejia@cableonda.net'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 518/692: 60B15707 - ALICIA MEJIA ZAMBRANO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 519)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'ruthmejia@cableonda.net' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 1.2 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '60B15707'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-05-16', start_date),
      renewal_date = COALESCE('2026-05-16', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 60B15707';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ALICIA MEJIA ZAMBRANO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '60B15707', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-05-16', '2026-05-16', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 60B15707';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '60B15707', 
    'ALICIA MEJIA ZAMBRANO', 
    v_insurer_id, 
    v_broker_id,
    1.2,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'ruthmejia@cableonda.net'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 519/692: 70B28272 - CECIBEL RODRIGUEZ QUINTANA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 520)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'sebastiana4562@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'SALUD' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 81.34 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '70B28272'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-04-01', start_date),
      renewal_date = COALESCE('2026-04-01', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 70B28272';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CECIBEL RODRIGUEZ QUINTANA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '70B28272', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-04-01', '2026-04-01', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 70B28272';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '70B28272', 
    'CECIBEL RODRIGUEZ QUINTANA', 
    v_insurer_id, 
    v_broker_id,
    81.34,
    jsonb_build_object(
      'policy_type', 'SALUD',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'sebastiana4562@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 520/692: 15B38831 - SHEILA BEATRIZ TAPIA GONZALEZ DE BERROCAL
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 521)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'sebastiana4562@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10.69 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '15B38831'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-05', start_date),
      renewal_date = COALESCE('2026-07-05', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 15B38831';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('SHEILA BEATRIZ TAPIA GONZALEZ DE BERROCAL', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '15B38831', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-05', '2026-07-05', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 15B38831';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '15B38831', 
    'SHEILA BEATRIZ TAPIA GONZALEZ DE BERROCAL', 
    v_insurer_id, 
    v_broker_id,
    10.69,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'sebastiana4562@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 521/692: 03B94857 - SHEILA BEATRIZ TAPIA GONZALEZ DE BERROCAL
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 522)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'sebastiana4562@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 7.84 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '03B94857'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-05', start_date),
      renewal_date = COALESCE('2026-07-05', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 03B94857';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('SHEILA BEATRIZ TAPIA GONZALEZ DE BERROCAL', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '03B94857', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-05', '2026-07-05', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 03B94857';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '03B94857', 
    'SHEILA BEATRIZ TAPIA GONZALEZ DE BERROCAL', 
    v_insurer_id, 
    v_broker_id,
    7.84,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'sebastiana4562@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 522/692: 02B312062 - JUAN CARLOS BERROCAL SILES MELENDEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 523)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'sebastiana4562@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 15.68 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B312062'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-03-22', start_date),
      renewal_date = COALESCE('2026-03-22', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B312062';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JUAN CARLOS BERROCAL SILES MELENDEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B312062', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-03-22', '2026-03-22', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B312062';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B312062', 
    'JUAN CARLOS BERROCAL SILES MELENDEZ', 
    v_insurer_id, 
    v_broker_id,
    15.68,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'sebastiana4562@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 523/692: 03B97363 - SHEILA BEATRIZ TAPIA GONZALEZ DE BERROCAL
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 524)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'sebastiana4562@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 4.09 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '03B97363'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-06-06', start_date),
      renewal_date = COALESCE('2026-06-06', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 03B97363';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('SHEILA BEATRIZ TAPIA GONZALEZ DE BERROCAL', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '03B97363', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-06-06', '2026-06-06', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 03B97363';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '03B97363', 
    'SHEILA BEATRIZ TAPIA GONZALEZ DE BERROCAL', 
    v_insurer_id, 
    v_broker_id,
    4.09,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'sebastiana4562@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 524/692: 03B94892 - DIDIMO ALBERTO ALMANZA RODRIGUEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 525)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'sebastiana4562@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 21.09 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '03B94892'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-10', start_date),
      renewal_date = COALESCE('2026-07-10', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 03B94892';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('DIDIMO ALBERTO ALMANZA RODRIGUEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '03B94892', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-10', '2026-07-10', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 03B94892';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '03B94892', 
    'DIDIMO ALBERTO ALMANZA RODRIGUEZ', 
    v_insurer_id, 
    v_broker_id,
    21.09,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'sebastiana4562@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 525/692: 1-16-50814 - GABRIEL WONG CHIARI
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 526)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'sebastiana4562@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 7.75 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-50814'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-50814';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('GABRIEL WONG CHIARI', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-50814', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-50814';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-50814', 
    'GABRIEL WONG CHIARI', 
    v_insurer_id, 
    v_broker_id,
    7.75,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'sebastiana4562@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 526/692: 1-16-15589 - SEBASTIANA CHIARI SAMANIEGO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 527)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'sebastiana4562@hotmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 25.38 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-15589'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-15589';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('SEBASTIANA CHIARI SAMANIEGO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-15589', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-15589';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-15589', 
    'SEBASTIANA CHIARI SAMANIEGO', 
    v_insurer_id, 
    v_broker_id,
    25.38,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'sebastiana4562@hotmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 527/692: 14B30686 - NIDIA NORIS BATISTA BUSTAMANTE DE MORENO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 528)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 2.1 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B30686'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-04-28', start_date),
      renewal_date = COALESCE('2026-04-28', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B30686';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('NIDIA NORIS BATISTA BUSTAMANTE DE MORENO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B30686', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-04-28', '2026-04-28', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B30686';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B30686', 
    'NIDIA NORIS BATISTA BUSTAMANTE DE MORENO', 
    v_insurer_id, 
    v_broker_id,
    2.1,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 528/692: 02G29275 - DONATILA TORRES RODRIGUEZ DE CHEVALIER
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 529)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 1.72 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02G29275'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-07', start_date),
      renewal_date = COALESCE('2026-07-07', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02G29275';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('DONATILA TORRES RODRIGUEZ DE CHEVALIER', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02G29275', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-07', '2026-07-07', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02G29275';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02G29275', 
    'DONATILA TORRES RODRIGUEZ DE CHEVALIER', 
    v_insurer_id, 
    v_broker_id,
    1.72,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 529/692: 03G14371 - DONATILA TORRES RODRIGUEZ DE CHEVALIER
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 530)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 1.01 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '03G14371'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-13', start_date),
      renewal_date = COALESCE('2026-09-13', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 03G14371';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('DONATILA TORRES RODRIGUEZ DE CHEVALIER', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '03G14371', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-13', '2026-09-13', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 03G14371';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '03G14371', 
    'DONATILA TORRES RODRIGUEZ DE CHEVALIER', 
    v_insurer_id, 
    v_broker_id,
    1.01,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 530/692: 15G5718 - DONATILA TORRES RODRIGUEZ DE CHEVALIER
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 531)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.4 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '15G5718'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-13', start_date),
      renewal_date = COALESCE('2026-09-13', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 15G5718';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('DONATILA TORRES RODRIGUEZ DE CHEVALIER', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '15G5718', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-13', '2026-09-13', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 15G5718';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '15G5718', 
    'DONATILA TORRES RODRIGUEZ DE CHEVALIER', 
    v_insurer_id, 
    v_broker_id,
    0.4,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 531/692: 15B102979 - GRUPO COMERCIAL DON LUIS  S.A
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 532)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '15B102979'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-02', start_date),
      renewal_date = COALESCE('2026-09-02', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 15B102979';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('GRUPO COMERCIAL DON LUIS  S.A', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '15B102979', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-02', '2026-09-02', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 15B102979';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '15B102979', 
    'GRUPO COMERCIAL DON LUIS  S.A', 
    v_insurer_id, 
    v_broker_id,
    8,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 532/692: 03B102781 - YULYA ANDREA MARTINEZ CERA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 533)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 2.35 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '03B102781'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-04', start_date),
      renewal_date = COALESCE('2026-09-04', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 03B102781';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('YULYA ANDREA MARTINEZ CERA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '03B102781', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-04', '2026-09-04', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 03B102781';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '03B102781', 
    'YULYA ANDREA MARTINEZ CERA', 
    v_insurer_id, 
    v_broker_id,
    2.35,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 533/692: 02B3414474 - JUAN VICENTE VLIEG CONTRERAS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 534)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.42 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3414474'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-08', start_date),
      renewal_date = COALESCE('2026-07-08', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3414474';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JUAN VICENTE VLIEG CONTRERAS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3414474', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-08', '2026-07-08', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3414474';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3414474', 
    'JUAN VICENTE VLIEG CONTRERAS', 
    v_insurer_id, 
    v_broker_id,
    11.42,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 534/692: 02B3426737 - NOOR EBEL CUBILLA AGUILAR
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 535)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3426737'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-10-08', start_date),
      renewal_date = COALESCE('2026-10-08', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3426737';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('NOOR EBEL CUBILLA AGUILAR', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3426737', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-10-08', '2026-10-08', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3426737';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3426737', 
    'NOOR EBEL CUBILLA AGUILAR', 
    v_insurer_id, 
    v_broker_id,
    10,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 535/692: 02B3425459 - YAMILETH YAVINA REYES RODRIGUEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 536)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 5.31 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3425459'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-10-08', start_date),
      renewal_date = COALESCE('2026-10-08', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3425459';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('YAMILETH YAVINA REYES RODRIGUEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3425459', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-10-08', '2026-10-08', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3425459';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3425459', 
    'YAMILETH YAVINA REYES RODRIGUEZ', 
    v_insurer_id, 
    v_broker_id,
    5.31,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 536/692: 02B3420759 - JUAN FRANCISCO QUIJANO CRUZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 537)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.82 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3420759'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-08-07', start_date),
      renewal_date = COALESCE('2026-08-07', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3420759';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JUAN FRANCISCO QUIJANO CRUZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3420759', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-08-07', '2026-08-07', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3420759';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3420759', 
    'JUAN FRANCISCO QUIJANO CRUZ', 
    v_insurer_id, 
    v_broker_id,
    11.82,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 537/692: 02B261979 - KARLA REGINA RODRIGUES SOARES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 538)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.72 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B261979'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-06-07', start_date),
      renewal_date = COALESCE('2026-06-07', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B261979';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('KARLA REGINA RODRIGUES SOARES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B261979', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-06-07', '2026-06-07', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B261979';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B261979', 
    'KARLA REGINA RODRIGUES SOARES', 
    v_insurer_id, 
    v_broker_id,
    9.72,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 538/692: 02B3369943 - ANA ISABEL GONZALEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 539)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.87 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3369943'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2024-12-11', start_date),
      renewal_date = COALESCE('2025-12-11', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3369943';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ANA ISABEL GONZALEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3369943', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2024-12-11', '2025-12-11', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3369943';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3369943', 
    'ANA ISABEL GONZALEZ', 
    v_insurer_id, 
    v_broker_id,
    8.87,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 539/692: 02BR2927316 - DEUDESVID SANTOS PEREZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 540)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 34.91 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02BR2927316'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-11', start_date),
      renewal_date = COALESCE('2026-11-11', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02BR2927316';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('DEUDESVID SANTOS PEREZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02BR2927316', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-11', '2026-11-11', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02BR2927316';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02BR2927316', 
    'DEUDESVID SANTOS PEREZ', 
    v_insurer_id, 
    v_broker_id,
    34.91,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 540/692: 02B3423887 - MELANIE MASSIEL PARKER THOMPSON
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 541)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.55 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3423887'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-13', start_date),
      renewal_date = COALESCE('2026-09-13', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3423887';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MELANIE MASSIEL PARKER THOMPSON', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3423887', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-13', '2026-09-13', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3423887';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3423887', 
    'MELANIE MASSIEL PARKER THOMPSON', 
    v_insurer_id, 
    v_broker_id,
    9.55,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 541/692: 02B3430345 - LILLY VALENTINA GARAVITO ABRIL
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 542)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 14.4 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3430345'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-13', start_date),
      renewal_date = COALESCE('2026-11-13', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3430345';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('LILLY VALENTINA GARAVITO ABRIL', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3430345', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-13', '2026-11-13', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3430345';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3430345', 
    'LILLY VALENTINA GARAVITO ABRIL', 
    v_insurer_id, 
    v_broker_id,
    14.4,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 542/692: 02B3424716 - NILDA ESTHER ZAMBRANO PERALTA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 543)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10.22 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3424716'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-15', start_date),
      renewal_date = COALESCE('2026-09-15', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3424716';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('NILDA ESTHER ZAMBRANO PERALTA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3424716', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-15', '2026-09-15', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3424716';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3424716', 
    'NILDA ESTHER ZAMBRANO PERALTA', 
    v_insurer_id, 
    v_broker_id,
    10.22,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 543/692: 60B42391 - ABDIEL AGUSTIN GARCIA GUERRA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 544)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 1.02 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '60B42391'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-13', start_date),
      renewal_date = COALESCE('2026-09-13', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 60B42391';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ABDIEL AGUSTIN GARCIA GUERRA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '60B42391', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-13', '2026-09-13', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 60B42391';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '60B42391', 
    'ABDIEL AGUSTIN GARCIA GUERRA', 
    v_insurer_id, 
    v_broker_id,
    1.02,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 544/692: 02BR2905925 - ALEX ABDIEL ACEVEDO DELGADO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 545)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 34.91 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02BR2905925'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-13', start_date),
      renewal_date = COALESCE('2026-11-13', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02BR2905925';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ALEX ABDIEL ACEVEDO DELGADO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02BR2905925', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-13', '2026-11-13', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02BR2905925';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02BR2905925', 
    'ALEX ABDIEL ACEVEDO DELGADO', 
    v_insurer_id, 
    v_broker_id,
    34.91,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 545/692: 0225-08096-09 - MARYURI GISSEL INTRIAGO VASQUEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 546)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10.85 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0225-08096-09'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0225-08096-09';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MARYURI GISSEL INTRIAGO VASQUEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0225-08096-09', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0225-08096-09';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0225-08096-09', 
    'MARYURI GISSEL INTRIAGO VASQUEZ', 
    v_insurer_id, 
    v_broker_id,
    10.85,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 546/692: 1-25-18962-0 - YOLI CHIQUINQUIRA BALBONI
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'BANESCO' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: BANESCO (fila 547)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('BANESCO' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 4.21 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-25-18962-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-25-18962-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('YOLI CHIQUINQUIRA BALBONI', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-25-18962-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-25-18962-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-25-18962-0', 
    'YOLI CHIQUINQUIRA BALBONI', 
    v_insurer_id, 
    v_broker_id,
    4.21,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 547/692: 1-51-10035-0 - OMAR GUILLERMO LA ROSA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'BANESCO' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: BANESCO (fila 548)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('BANESCO' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := -13.75 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-51-10035-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-51-10035-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('OMAR GUILLERMO LA ROSA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-51-10035-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-51-10035-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-51-10035-0', 
    'OMAR GUILLERMO LA ROSA', 
    v_insurer_id, 
    v_broker_id,
    -13.75,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 548/692: 04-05-2050700-0 - GRISELLES MURILLO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 549)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 26.4 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-05-2050700-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-06', start_date),
      renewal_date = COALESCE('2026-11-06', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-05-2050700-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('GRISELLES MURILLO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-05-2050700-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-06', '2026-11-06', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-05-2050700-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-05-2050700-0', 
    'GRISELLES MURILLO', 
    v_insurer_id, 
    v_broker_id,
    26.4,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 549/692: 04-05-1766399-1 - ROBERTO CARLOS  GONZALEZ ORTEGA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 550)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 28.3 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-05-1766399-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-10-24', start_date),
      renewal_date = COALESCE('2026-10-24', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-05-1766399-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ROBERTO CARLOS  GONZALEZ ORTEGA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-05-1766399-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-10-24', '2026-10-24', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-05-1766399-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-05-1766399-1', 
    'ROBERTO CARLOS  GONZALEZ ORTEGA', 
    v_insurer_id, 
    v_broker_id,
    28.3,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 550/692: 04-04-2032418-0 - DELANIS CLAUDETH RIOS GONZALEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 551)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.51 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-2032418-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-10-11', start_date),
      renewal_date = COALESCE('2026-10-11', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-2032418-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('DELANIS CLAUDETH RIOS GONZALEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-2032418-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-10-11', '2026-10-11', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-2032418-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-2032418-0', 
    'DELANIS CLAUDETH RIOS GONZALEZ', 
    v_insurer_id, 
    v_broker_id,
    9.51,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 551/692: 04-08-2001818-0 - MITZI GONZALEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 552)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 13.19 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-08-2001818-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-08-29', start_date),
      renewal_date = COALESCE('2026-08-29', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-08-2001818-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MITZI GONZALEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-08-2001818-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-08-29', '2026-08-29', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-08-2001818-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-08-2001818-0', 
    'MITZI GONZALEZ', 
    v_insurer_id, 
    v_broker_id,
    13.19,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 552/692: 04-04-2002168-0 - KEVIN VELASQUEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 553)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.4 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-2002168-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-08-29', start_date),
      renewal_date = COALESCE('2026-08-29', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-2002168-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('KEVIN VELASQUEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-2002168-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-08-29', '2026-08-29', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-2002168-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-2002168-0', 
    'KEVIN VELASQUEZ', 
    v_insurer_id, 
    v_broker_id,
    8.4,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 553/692: 04-05-2050034-0 - JOEL OSTIA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 554)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 21.7 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-05-2050034-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-03', start_date),
      renewal_date = COALESCE('2026-11-03', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-05-2050034-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JOEL OSTIA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-05-2050034-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-03', '2026-11-03', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-05-2050034-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-05-2050034-0', 
    'JOEL OSTIA', 
    v_insurer_id, 
    v_broker_id,
    21.7,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 554/692: 04-05-2050660-0 - ELVIS ELEAZAR JAEN RIVERA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 555)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 21.7 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-05-2050660-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-06', start_date),
      renewal_date = COALESCE('2026-11-06', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-05-2050660-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ELVIS ELEAZAR JAEN RIVERA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-05-2050660-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-06', '2026-11-06', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-05-2050660-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-05-2050660-0', 
    'ELVIS ELEAZAR JAEN RIVERA', 
    v_insurer_id, 
    v_broker_id,
    21.7,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 555/692: 04-08-2042826-0 - ANDRES HERNANDEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 556)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.7 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-08-2042826-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-10-24', start_date),
      renewal_date = COALESCE('2026-10-24', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-08-2042826-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ANDRES HERNANDEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-08-2042826-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-10-24', '2026-10-24', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-08-2042826-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-08-2042826-0', 
    'ANDRES HERNANDEZ', 
    v_insurer_id, 
    v_broker_id,
    11.7,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 556/692: 06-03-2027144-0 - JOSE EDUARDO CRUZ TREJO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 557)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 6.3 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '06-03-2027144-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-10-03', start_date),
      renewal_date = COALESCE('2026-10-03', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 06-03-2027144-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JOSE EDUARDO CRUZ TREJO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '06-03-2027144-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-10-03', '2026-10-03', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 06-03-2027144-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '06-03-2027144-0', 
    'JOSE EDUARDO CRUZ TREJO', 
    v_insurer_id, 
    v_broker_id,
    6.3,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 557/692: 04-72-2050672-0 - REANEYDA BENITEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 558)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 41.15 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-72-2050672-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-06', start_date),
      renewal_date = COALESCE('2026-11-06', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-72-2050672-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('REANEYDA BENITEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-72-2050672-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-06', '2026-11-06', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-72-2050672-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-72-2050672-0', 
    'REANEYDA BENITEZ', 
    v_insurer_id, 
    v_broker_id,
    41.15,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 558/692: 06-72-2050673-0 - REANEYDA BENITEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 559)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 3.9 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '06-72-2050673-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-06', start_date),
      renewal_date = COALESCE('2026-11-06', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 06-72-2050673-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('REANEYDA BENITEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '06-72-2050673-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-06', '2026-11-06', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 06-72-2050673-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '06-72-2050673-0', 
    'REANEYDA BENITEZ', 
    v_insurer_id, 
    v_broker_id,
    3.9,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 559/692: 04-72-2026892-0 - EDGARDO MIGUEL GUTIERREZ PINTO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 560)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 16.12 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-72-2026892-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-10-03', start_date),
      renewal_date = COALESCE('2026-10-03', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-72-2026892-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('EDGARDO MIGUEL GUTIERREZ PINTO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-72-2026892-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-10-03', '2026-10-03', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-72-2026892-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-72-2026892-0', 
    'EDGARDO MIGUEL GUTIERREZ PINTO', 
    v_insurer_id, 
    v_broker_id,
    16.12,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 560/692: 04-04-1204976-3 - CARLA BARRANTES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 561)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.27 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-1204976-3'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-07', start_date),
      renewal_date = COALESCE('2026-07-07', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-1204976-3';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CARLA BARRANTES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-1204976-3', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-07', '2026-07-07', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-1204976-3';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-1204976-3', 
    'CARLA BARRANTES', 
    v_insurer_id, 
    v_broker_id,
    11.27,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 561/692: 1-16-68399 - JORGE LUIS ORTEGA MORALES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 562)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 5.68 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-68399'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-68399';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JORGE LUIS ORTEGA MORALES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-68399', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-68399';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-68399', 
    'JORGE LUIS ORTEGA MORALES', 
    v_insurer_id, 
    v_broker_id,
    5.68,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 562/692: 1-16-68400 - JORGE LUIS ORTEGA MORALES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 563)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 5.68 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-68400'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-68400';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JORGE LUIS ORTEGA MORALES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-68400', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-68400';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-68400', 
    'JORGE LUIS ORTEGA MORALES', 
    v_insurer_id, 
    v_broker_id,
    5.68,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 563/692: 1-30-745352 - YITZEL MAYLET RIOS QUINTERO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 564)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 23.02 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-30-745352'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-30-745352';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('YITZEL MAYLET RIOS QUINTERO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-30-745352', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-30-745352';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-30-745352', 
    'YITZEL MAYLET RIOS QUINTERO', 
    v_insurer_id, 
    v_broker_id,
    23.02,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 564/692: 5-4-3813 - RIVAS VAZQUEZ  MARIA DEL CARMEN
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 565)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 27.11 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '5-4-3813'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 5-4-3813';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('RIVAS VAZQUEZ  MARIA DEL CARMEN', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '5-4-3813', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 5-4-3813';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '5-4-3813', 
    'RIVAS VAZQUEZ  MARIA DEL CARMEN', 
    v_insurer_id, 
    v_broker_id,
    27.11,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 565/692: 1-30-731542 - GILBERTO FERNANDEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 566)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.51 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-30-731542'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-30-731542';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('GILBERTO FERNANDEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-30-731542', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-30-731542';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-30-731542', 
    'GILBERTO FERNANDEZ', 
    v_insurer_id, 
    v_broker_id,
    11.51,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 566/692: 1-40-14792 - "CORPORACION MAXI HOGAR
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'S.A."' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: S.A." (fila 567)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'internacional' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('S.A."' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-40-14792'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-40-14792';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('"CORPORACION MAXI HOGAR', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-40-14792', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-40-14792';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-40-14792', 
    '"CORPORACION MAXI HOGAR', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'internacional'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 567/692: 9-30-35724 - ENEAUTRY LOPEZ GARCIA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 568)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 40.88 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '9-30-35724'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 9-30-35724';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ENEAUTRY LOPEZ GARCIA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '9-30-35724', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 9-30-35724';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '9-30-35724', 
    'ENEAUTRY LOPEZ GARCIA', 
    v_insurer_id, 
    v_broker_id,
    40.88,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 568/692: 2378 - TRINA MICHELLE CLARK
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'OPTIMA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: OPTIMA (fila 569)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('OPTIMA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := -65.36 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2378'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2378';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('TRINA MICHELLE CLARK', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2378', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2378';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2378', 
    'TRINA MICHELLE CLARK', 
    v_insurer_id, 
    v_broker_id,
    -65.36,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 569/692: 2378 - TRINA MICHELLE CLARK
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'OPTIMA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: OPTIMA (fila 570)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('OPTIMA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 65.36 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2378'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2378';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('TRINA MICHELLE CLARK', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2378', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2378';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2378', 
    'TRINA MICHELLE CLARK', 
    v_insurer_id, 
    v_broker_id,
    65.36,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 570/692: 62724 - EDGAR LEONEL BASO DE
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'OPTIMA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: OPTIMA (fila 571)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('OPTIMA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.36 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '62724'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 62724';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('EDGAR LEONEL BASO DE', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '62724', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 62724';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '62724', 
    'EDGAR LEONEL BASO DE', 
    v_insurer_id, 
    v_broker_id,
    8.36,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 571/692: 2190081 - CIRILO  SANDOVAL TEJEIRA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'REGIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: REGIONAL (fila 572)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('REGIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.38 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2190081'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2190081';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CIRILO  SANDOVAL TEJEIRA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2190081', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2190081';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2190081', 
    'CIRILO  SANDOVAL TEJEIRA', 
    v_insurer_id, 
    v_broker_id,
    9.38,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 572/692: 2123480 - ZULEICA ANAYS  SAMANIEGO SAAVEDRA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'REGIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: REGIONAL (fila 573)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('REGIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 51.42 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2123480'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2123480';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ZULEICA ANAYS  SAMANIEGO SAAVEDRA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2123480', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2123480';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2123480', 
    'ZULEICA ANAYS  SAMANIEGO SAAVEDRA', 
    v_insurer_id, 
    v_broker_id,
    51.42,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 573/692: 2198959 - RUBEN DARIO VEGA LA CASA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'REGIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: REGIONAL (fila 574)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('REGIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 30.57 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2198959'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2198959';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('RUBEN DARIO VEGA LA CASA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2198959', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2198959';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2198959', 
    'RUBEN DARIO VEGA LA CASA', 
    v_insurer_id, 
    v_broker_id,
    30.57,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 574/692: 02-93-1213403-0 - YARIBETH OLMOS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 575)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 12.77 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-93-1213403-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-93-1213403-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('YARIBETH OLMOS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-93-1213403-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-93-1213403-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-93-1213403-0', 
    'YARIBETH OLMOS', 
    v_insurer_id, 
    v_broker_id,
    12.77,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 575/692: 02-93-1120932-1 - JESSIKA ORTEGA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 576)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 7.31 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-93-1120932-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-93-1120932-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JESSIKA ORTEGA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-93-1120932-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-93-1120932-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-93-1120932-1', 
    'JESSIKA ORTEGA', 
    v_insurer_id, 
    v_broker_id,
    7.31,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 576/692: 02-39-1163511-1 - GINELA DEL CARMEN GAGO FERNANDEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 577)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 63.27 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-39-1163511-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-39-1163511-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('GINELA DEL CARMEN GAGO FERNANDEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-39-1163511-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-39-1163511-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-39-1163511-1', 
    'GINELA DEL CARMEN GAGO FERNANDEZ', 
    v_insurer_id, 
    v_broker_id,
    63.27,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 577/692: 02-48-1031620-2 - JUAN FERNANDEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 578)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 43.26 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-48-1031620-2'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-48-1031620-2';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JUAN FERNANDEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-48-1031620-2', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-48-1031620-2';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-48-1031620-2', 
    'JUAN FERNANDEZ', 
    v_insurer_id, 
    v_broker_id,
    43.26,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 578/692: 02-93-1120932-1 - JESSIKA ORTEGA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 579)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 125 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-93-1120932-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-93-1120932-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JESSIKA ORTEGA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-93-1120932-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-93-1120932-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-93-1120932-1', 
    'JESSIKA ORTEGA', 
    v_insurer_id, 
    v_broker_id,
    125,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 579/692: 02-93-1115355-1 - "BANCO GENERAL
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'S.A"' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: S.A" (fila 580)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'sura' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('S.A"' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-93-1115355-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-93-1115355-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('"BANCO GENERAL', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-93-1115355-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-93-1115355-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-93-1115355-1', 
    '"BANCO GENERAL', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'sura'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 580/692: 02-92-0930765-3 - CARMEN LISED CORREA RESTREPO DE CABRERA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 581)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  -- Sin broker email
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 30.99 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-92-0930765-3'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-92-0930765-3';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CARMEN LISED CORREA RESTREPO DE CABRERA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-92-0930765-3', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-92-0930765-3';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-92-0930765-3', 
    'CARMEN LISED CORREA RESTREPO DE CABRERA', 
    v_insurer_id, 
    v_broker_id,
    30.99,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', NULL
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 581/692: 14B37335 - SONIA ISABEL ARENAS GOMEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 582)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'soniaa0154@outlook.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.5 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B37335'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-12-01', start_date),
      renewal_date = COALESCE('2026-12-01', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B37335';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('SONIA ISABEL ARENAS GOMEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B37335', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-12-01', '2026-12-01', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B37335';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B37335', 
    'SONIA ISABEL ARENAS GOMEZ', 
    v_insurer_id, 
    v_broker_id,
    0.5,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'soniaa0154@outlook.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 582/692: 02B250691 - ALBA LUCY MORENO MORENO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 583)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'soniaa0154@outlook.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.6 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B250691'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-10-19', start_date),
      renewal_date = COALESCE('2026-10-19', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B250691';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ALBA LUCY MORENO MORENO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B250691', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-10-19', '2026-10-19', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B250691';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B250691', 
    'ALBA LUCY MORENO MORENO', 
    v_insurer_id, 
    v_broker_id,
    11.6,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'soniaa0154@outlook.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 583/692: 15B35461 - PH VILLAS DE COSTA DEL ESTE TORRE D
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 584)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'soniaa0154@outlook.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 27.5 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '15B35461'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-06-27', start_date),
      renewal_date = COALESCE('2026-06-27', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 15B35461';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('PH VILLAS DE COSTA DEL ESTE TORRE D', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '15B35461', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-06-27', '2026-06-27', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 15B35461';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '15B35461', 
    'PH VILLAS DE COSTA DEL ESTE TORRE D', 
    v_insurer_id, 
    v_broker_id,
    27.5,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'soniaa0154@outlook.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 584/692: 70B29410 - BETZY BETZAIDA VERGARA TEJEDOR
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 585)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'soniaa0154@outlook.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 19.12 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '70B29410'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-03-01', start_date),
      renewal_date = COALESCE('2026-03-01', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 70B29410';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('BETZY BETZAIDA VERGARA TEJEDOR', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '70B29410', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-03-01', '2026-03-01', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 70B29410';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '70B29410', 
    'BETZY BETZAIDA VERGARA TEJEDOR', 
    v_insurer_id, 
    v_broker_id,
    19.12,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'soniaa0154@outlook.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 585/692: 02B3412280 - YANKO HEMMEL N PAUL CARDENAS ORTIZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 586)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'soniaa0154@outlook.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.84 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3412280'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-05-05', start_date),
      renewal_date = COALESCE('2026-05-05', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3412280';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('YANKO HEMMEL N PAUL CARDENAS ORTIZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3412280', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-05-05', '2026-05-05', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3412280';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3412280', 
    'YANKO HEMMEL N PAUL CARDENAS ORTIZ', 
    v_insurer_id, 
    v_broker_id,
    8.84,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'soniaa0154@outlook.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 586/692: 03B99902 - JESSICA EMILEIDY RAMIREZ DIAZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 587)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'soniaa0154@outlook.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 2.86 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '03B99902'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-07', start_date),
      renewal_date = COALESCE('2026-11-07', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 03B99902';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JESSICA EMILEIDY RAMIREZ DIAZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '03B99902', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-07', '2026-11-07', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 03B99902';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '03B99902', 
    'JESSICA EMILEIDY RAMIREZ DIAZ', 
    v_insurer_id, 
    v_broker_id,
    2.86,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'soniaa0154@outlook.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 587/692: 15B101146 - JESSICA EMILEIDY RAMIREZ DIAZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 588)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'soniaa0154@outlook.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 2.09 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '15B101146'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-07', start_date),
      renewal_date = COALESCE('2026-11-07', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 15B101146';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JESSICA EMILEIDY RAMIREZ DIAZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '15B101146', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-07', '2026-11-07', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 15B101146';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '15B101146', 
    'JESSICA EMILEIDY RAMIREZ DIAZ', 
    v_insurer_id, 
    v_broker_id,
    2.09,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'soniaa0154@outlook.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 588/692: 02BR2904058 - FERNANDO GUILLERMO PALACIOS VARGAS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 589)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'soniaa0154@outlook.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 36.79 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02BR2904058'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-10-08', start_date),
      renewal_date = COALESCE('2026-10-08', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02BR2904058';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('FERNANDO GUILLERMO PALACIOS VARGAS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02BR2904058', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-10-08', '2026-10-08', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02BR2904058';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02BR2904058', 
    'FERNANDO GUILLERMO PALACIOS VARGAS', 
    v_insurer_id, 
    v_broker_id,
    36.79,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'soniaa0154@outlook.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 589/692: 15B27110 - INVERSIONES AQUALINA  S.A.
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 590)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'soniaa0154@outlook.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 3.25 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '15B27110'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-01-08', start_date),
      renewal_date = COALESCE('2026-01-08', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 15B27110';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('INVERSIONES AQUALINA  S.A.', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '15B27110', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-01-08', '2026-01-08', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 15B27110';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '15B27110', 
    'INVERSIONES AQUALINA  S.A.', 
    v_insurer_id, 
    v_broker_id,
    3.25,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'soniaa0154@outlook.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 590/692: 02B3410166 - RAUL ALEXANDER ALONSO MARROQUIN
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 591)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'soniaa0154@outlook.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.18 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3410166'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-04-11', start_date),
      renewal_date = COALESCE('2026-04-11', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3410166';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('RAUL ALEXANDER ALONSO MARROQUIN', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3410166', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-04-11', '2026-04-11', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3410166';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3410166', 
    'RAUL ALEXANDER ALONSO MARROQUIN', 
    v_insurer_id, 
    v_broker_id,
    9.18,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'soniaa0154@outlook.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 591/692: 02B3393850 - RENE ARCADIO DIAZ CASTILLO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 592)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'soniaa0154@outlook.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.62 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3393850'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-10-10', start_date),
      renewal_date = COALESCE('2026-10-10', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3393850';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('RENE ARCADIO DIAZ CASTILLO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3393850', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-10-10', '2026-10-10', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3393850';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3393850', 
    'RENE ARCADIO DIAZ CASTILLO', 
    v_insurer_id, 
    v_broker_id,
    8.62,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'soniaa0154@outlook.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 592/692: 03B79838 - YAMILETH YARIELA ATENCIO CEDE�O
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 593)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'soniaa0154@outlook.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 22.81 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '03B79838'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-10-15', start_date),
      renewal_date = COALESCE('2026-10-15', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 03B79838';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('YAMILETH YARIELA ATENCIO CEDE�O', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '03B79838', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-10-15', '2026-10-15', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 03B79838';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '03B79838', 
    'YAMILETH YARIELA ATENCIO CEDE�O', 
    v_insurer_id, 
    v_broker_id,
    22.81,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'soniaa0154@outlook.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 593/692: 60B26116 - BETZAIDA MICHELL GONZALEZ PARDO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 594)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'soniaa0154@outlook.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.38 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '60B26116'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-03-03', start_date),
      renewal_date = COALESCE('2026-03-03', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 60B26116';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('BETZAIDA MICHELL GONZALEZ PARDO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '60B26116', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-03-03', '2026-03-03', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 60B26116';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '60B26116', 
    'BETZAIDA MICHELL GONZALEZ PARDO', 
    v_insurer_id, 
    v_broker_id,
    0.38,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'soniaa0154@outlook.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 594/692: 14B78769 - JESSICA EMILEIDY RAMIREZ DIAZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 595)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'soniaa0154@outlook.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 1.2 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B78769'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-08', start_date),
      renewal_date = COALESCE('2026-11-08', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B78769';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JESSICA EMILEIDY RAMIREZ DIAZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B78769', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-08', '2026-11-08', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B78769';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B78769', 
    'JESSICA EMILEIDY RAMIREZ DIAZ', 
    v_insurer_id, 
    v_broker_id,
    1.2,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'soniaa0154@outlook.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 595/692: 60B24995 - YAMILE ANDREA ORTIZ VASQUEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 596)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'soniaa0154@outlook.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.43 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '60B24995'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-12', start_date),
      renewal_date = COALESCE('2026-11-12', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 60B24995';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('YAMILE ANDREA ORTIZ VASQUEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '60B24995', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-12', '2026-11-12', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 60B24995';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '60B24995', 
    'YAMILE ANDREA ORTIZ VASQUEZ', 
    v_insurer_id, 
    v_broker_id,
    0.43,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'soniaa0154@outlook.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 596/692: 60B23362 - SIMON DAVID FOLEY
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 597)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'soniaa0154@outlook.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 1.96 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '60B23362'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-05-06', start_date),
      renewal_date = COALESCE('2026-05-06', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 60B23362';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('SIMON DAVID FOLEY', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '60B23362', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-05-06', '2026-05-06', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 60B23362';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '60B23362', 
    'SIMON DAVID FOLEY', 
    v_insurer_id, 
    v_broker_id,
    1.96,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'soniaa0154@outlook.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 597/692: 14B43024 - ERIKA REBECA NATERA ROSAS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 598)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'soniaa0154@outlook.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 1.02 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B43024'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-01-09', start_date),
      renewal_date = COALESCE('2026-01-09', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B43024';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ERIKA REBECA NATERA ROSAS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B43024', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-01-09', '2026-01-09', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B43024';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B43024', 
    'ERIKA REBECA NATERA ROSAS', 
    v_insurer_id, 
    v_broker_id,
    1.02,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'soniaa0154@outlook.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 598/692: 60B25440 - JOBA LOGISTICS  S.A.
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 599)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'soniaa0154@outlook.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.74 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '60B25440'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2024-12-12', start_date),
      renewal_date = COALESCE('2025-12-12', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 60B25440';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JOBA LOGISTICS  S.A.', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '60B25440', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2024-12-12', '2025-12-12', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 60B25440';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '60B25440', 
    'JOBA LOGISTICS  S.A.', 
    v_insurer_id, 
    v_broker_id,
    0.74,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'soniaa0154@outlook.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 599/692: 60B39328 - ARIS MELVIS MOSQUERA BENITES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 600)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'soniaa0154@outlook.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.58 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '60B39328'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2024-12-04', start_date),
      renewal_date = COALESCE('2025-12-04', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 60B39328';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ARIS MELVIS MOSQUERA BENITES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '60B39328', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2024-12-04', '2025-12-04', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 60B39328';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '60B39328', 
    'ARIS MELVIS MOSQUERA BENITES', 
    v_insurer_id, 
    v_broker_id,
    0.58,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'soniaa0154@outlook.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 600/692: 60B25435 - JOBA LOGISTICS  S.A.
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 601)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'soniaa0154@outlook.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.52 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '60B25435'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2024-12-11', start_date),
      renewal_date = COALESCE('2025-12-11', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 60B25435';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JOBA LOGISTICS  S.A.', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '60B25435', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2024-12-11', '2025-12-11', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 60B25435';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '60B25435', 
    'JOBA LOGISTICS  S.A.', 
    v_insurer_id, 
    v_broker_id,
    0.52,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'soniaa0154@outlook.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 601/692: 14B43725 - KATIA AURELIA GONZALEZ FLORES DE DE LOPERA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 602)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'soniaa0154@outlook.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 1.46 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '14B43725'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-04-12', start_date),
      renewal_date = COALESCE('2026-04-12', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 14B43725';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('KATIA AURELIA GONZALEZ FLORES DE DE LOPERA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '14B43725', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-04-12', '2026-04-12', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 14B43725';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '14B43725', 
    'KATIA AURELIA GONZALEZ FLORES DE DE LOPERA', 
    v_insurer_id, 
    v_broker_id,
    1.46,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'soniaa0154@outlook.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 602/692: 60B25436 - JOBA LOGISTICS  S.A.
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 603)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'soniaa0154@outlook.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.45 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '60B25436'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2024-12-12', start_date),
      renewal_date = COALESCE('2025-12-12', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 60B25436';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JOBA LOGISTICS  S.A.', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '60B25436', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2024-12-12', '2025-12-12', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 60B25436';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '60B25436', 
    'JOBA LOGISTICS  S.A.', 
    v_insurer_id, 
    v_broker_id,
    0.45,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'soniaa0154@outlook.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 603/692: 60B23279 - BEATRIZ MARIA GRANDO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 604)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'soniaa0154@outlook.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 1.19 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '60B23279'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-04-13', start_date),
      renewal_date = COALESCE('2026-04-13', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 60B23279';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('BEATRIZ MARIA GRANDO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '60B23279', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-04-13', '2026-04-13', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 60B23279';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '60B23279', 
    'BEATRIZ MARIA GRANDO', 
    v_insurer_id, 
    v_broker_id,
    1.19,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'soniaa0154@outlook.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 604/692: 60B16944 - HECTOR ENRIQUE EHRMAN VILLAGRA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 605)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'soniaa0154@outlook.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.34 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '60B16944'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-01-07', start_date),
      renewal_date = COALESCE('2026-01-07', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 60B16944';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('HECTOR ENRIQUE EHRMAN VILLAGRA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '60B16944', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-01-07', '2026-01-07', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 60B16944';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '60B16944', 
    'HECTOR ENRIQUE EHRMAN VILLAGRA', 
    v_insurer_id, 
    v_broker_id,
    0.34,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'soniaa0154@outlook.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 605/692: 0122-00215-01 - RED VERDE PANAMA SA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 606)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'soniaa0154@outlook.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 111.68 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0122-00215-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0122-00215-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('RED VERDE PANAMA SA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0122-00215-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0122-00215-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0122-00215-01', 
    'RED VERDE PANAMA SA', 
    v_insurer_id, 
    v_broker_id,
    111.68,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'soniaa0154@outlook.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 606/692: 0522-00006-01 - RED VERDE PANAMA SA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 607)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'soniaa0154@outlook.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 29.93 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0522-00006-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0522-00006-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('RED VERDE PANAMA SA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0522-00006-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0522-00006-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0522-00006-01', 
    'RED VERDE PANAMA SA', 
    v_insurer_id, 
    v_broker_id,
    29.93,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'soniaa0154@outlook.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 607/692: 0922-00715-01 - RED VERDE PANAMA SA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 608)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'soniaa0154@outlook.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 35.63 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0922-00715-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0922-00715-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('RED VERDE PANAMA SA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0922-00715-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0922-00715-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0922-00715-01', 
    'RED VERDE PANAMA SA', 
    v_insurer_id, 
    v_broker_id,
    35.63,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'soniaa0154@outlook.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 608/692: 1522-02049-01 - RED VERDE PANAMA SA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 609)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'soniaa0154@outlook.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 21.38 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1522-02049-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1522-02049-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('RED VERDE PANAMA SA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1522-02049-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1522-02049-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1522-02049-01', 
    'RED VERDE PANAMA SA', 
    v_insurer_id, 
    v_broker_id,
    21.38,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'soniaa0154@outlook.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 609/692: 1-16-27744 - ITZEL DEL CARMEN GARCIA BELE�O
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 610)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'soniaa0154@outlook.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.7 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-27744'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-27744';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ITZEL DEL CARMEN GARCIA BELE�O', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-27744', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-27744';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-27744', 
    'ITZEL DEL CARMEN GARCIA BELE�O', 
    v_insurer_id, 
    v_broker_id,
    8.7,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'soniaa0154@outlook.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 610/692: 1-16-29130 - LISSETTE ARLETTE GARCIA BELE�O
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 611)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'soniaa0154@outlook.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10.5 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-29130'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-29130';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('LISSETTE ARLETTE GARCIA BELE�O', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-29130', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-29130';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-29130', 
    'LISSETTE ARLETTE GARCIA BELE�O', 
    v_insurer_id, 
    v_broker_id,
    10.5,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'soniaa0154@outlook.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 611/692: 1-16-30779 - DALYS DELYS JIMENEZ ROJAS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 612)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'soniaa0154@outlook.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.7 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-30779'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-30779';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('DALYS DELYS JIMENEZ ROJAS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-30779', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-30779';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-30779', 
    'DALYS DELYS JIMENEZ ROJAS', 
    v_insurer_id, 
    v_broker_id,
    8.7,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'soniaa0154@outlook.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 612/692: 1-16-54062 - JAHIR EDGARDO JIMENEZ JOSEPH
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 613)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'soniaa0154@outlook.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 1.24 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-54062'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-54062';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JAHIR EDGARDO JIMENEZ JOSEPH', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-54062', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-54062';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-54062', 
    'JAHIR EDGARDO JIMENEZ JOSEPH', 
    v_insurer_id, 
    v_broker_id,
    1.24,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'soniaa0154@outlook.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 613/692: 1-30-689258 - RICARDO ERNESTO DE LEON CEDE�O
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 614)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'soniaa0154@outlook.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.64 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-30-689258'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-30-689258';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('RICARDO ERNESTO DE LEON CEDE�O', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-30-689258', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-30-689258';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-30-689258', 
    'RICARDO ERNESTO DE LEON CEDE�O', 
    v_insurer_id, 
    v_broker_id,
    9.64,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'soniaa0154@outlook.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 614/692: 1-30-745370 - MARIO ALBERTO MAYORGA ARAUZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 615)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'soniaa0154@outlook.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.51 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-30-745370'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-30-745370';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MARIO ALBERTO MAYORGA ARAUZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-30-745370', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-30-745370';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-30-745370', 
    'MARIO ALBERTO MAYORGA ARAUZ', 
    v_insurer_id, 
    v_broker_id,
    11.51,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'soniaa0154@outlook.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 615/692: 1-30-782853 - "RED VERDE PANAMA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'S.A."' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: S.A." (fila 616)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'internacional' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('S.A."' = 'ASSA' AND 'SONIAA0154@OUTLOOK.COM' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-30-782853'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-30-782853';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('"RED VERDE PANAMA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-30-782853', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-30-782853';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-30-782853', 
    '"RED VERDE PANAMA', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', 'SONIAA0154@OUTLOOK.COM',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'internacional'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 616/692: 1-16-27143 - CARMEN CECILIA CEDE�O DE GRACIA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 617)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'soniaa0154@outlook.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 22.72 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-16-27143'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-16-27143';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CARMEN CECILIA CEDE�O DE GRACIA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-16-27143', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-16-27143';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-16-27143', 
    'CARMEN CECILIA CEDE�O DE GRACIA', 
    v_insurer_id, 
    v_broker_id,
    22.72,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'soniaa0154@outlook.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 617/692: 2162267 - "PANAMERICAN RENTAL SERVICES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'S.A."' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: S.A." (fila 618)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'regional' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('S.A."' = 'ASSA' AND 'SONIAA0154@OUTLOOK.COM' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2162267'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2162267';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('"PANAMERICAN RENTAL SERVICES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2162267', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2162267';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2162267', 
    '"PANAMERICAN RENTAL SERVICES', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', 'SONIAA0154@OUTLOOK.COM',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'regional'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 618/692: 03030041607 - EDITH AMERICA BARRIOS CARDENAS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 619)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'soniaa0154@outlook.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 20.07 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '03030041607'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 03030041607';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('EDITH AMERICA BARRIOS CARDENAS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '03030041607', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 03030041607';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '03030041607', 
    'EDITH AMERICA BARRIOS CARDENAS', 
    v_insurer_id, 
    v_broker_id,
    20.07,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'soniaa0154@outlook.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 619/692: 0221-02619-09 - JAIME  MORALES SANCHEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 620)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'stephyelain1416@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.43 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0221-02619-09'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0221-02619-09';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JAIME  MORALES SANCHEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0221-02619-09', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0221-02619-09';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0221-02619-09', 
    'JAIME  MORALES SANCHEZ', 
    v_insurer_id, 
    v_broker_id,
    9.43,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'stephyelain1416@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 620/692: 59331 - RUBEN DARIO DIAZ COSSU
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'OPTIMA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: OPTIMA (fila 621)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'stephyelain1416@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('OPTIMA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10.33 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '59331'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 59331';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('RUBEN DARIO DIAZ COSSU', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '59331', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 59331';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '59331', 
    'RUBEN DARIO DIAZ COSSU', 
    v_insurer_id, 
    v_broker_id,
    10.33,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'stephyelain1416@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 621/692: 02B3378993 - VANESSA MICHELLE ALGANDONA CHAVARRIA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 622)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'stheysi1725@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'AUTO' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 6.98 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3378993'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-04-01', start_date),
      renewal_date = COALESCE('2026-04-01', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3378993';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('VANESSA MICHELLE ALGANDONA CHAVARRIA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3378993', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-04-01', '2026-04-01', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3378993';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3378993', 
    'VANESSA MICHELLE ALGANDONA CHAVARRIA', 
    v_insurer_id, 
    v_broker_id,
    6.98,
    jsonb_build_object(
      'policy_type', 'AUTO',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'stheysi1725@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 622/692: 04-04-1396947-2 - MIREYA FRANCO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 623)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'stheysi1725@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.68 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-1396947-2'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-07-16', start_date),
      renewal_date = COALESCE('2026-07-16', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-1396947-2';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MIREYA FRANCO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-1396947-2', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-07-16', '2026-07-16', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-1396947-2';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-1396947-2', 
    'MIREYA FRANCO', 
    v_insurer_id, 
    v_broker_id,
    8.68,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'stheysi1725@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 623/692: 04-04-1314214-2 - EDUARDO PEREZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 624)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'stheysi1725@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.69 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-1314214-2'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-02-04', start_date),
      renewal_date = COALESCE('2026-02-04', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-1314214-2';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('EDUARDO PEREZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-1314214-2', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-02-04', '2026-02-04', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-1314214-2';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-1314214-2', 
    'EDUARDO PEREZ', 
    v_insurer_id, 
    v_broker_id,
    8.69,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'stheysi1725@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 624/692: 04-04-1941810-0 - HECTOR ZERNA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 625)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'stheysi1725@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.18 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-1941810-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-06-10', start_date),
      renewal_date = COALESCE('2026-06-10', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-1941810-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('HECTOR ZERNA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-1941810-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-06-10', '2026-06-10', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-1941810-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-1941810-0', 
    'HECTOR ZERNA', 
    v_insurer_id, 
    v_broker_id,
    9.18,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'stheysi1725@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 625/692: 04-04-1314214-2 - EDUARDO PEREZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 626)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'stheysi1725@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.01 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-1314214-2'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-02-04', start_date),
      renewal_date = COALESCE('2026-02-04', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-1314214-2';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('EDUARDO PEREZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-1314214-2', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-02-04', '2026-02-04', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-1314214-2';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-1314214-2', 
    'EDUARDO PEREZ', 
    v_insurer_id, 
    v_broker_id,
    0.01,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'stheysi1725@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 626/692: 04-05-1748576-1 - EDUARDO ARAUZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 627)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'stheysi1725@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 17.22 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-05-1748576-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-30', start_date),
      renewal_date = COALESCE('2026-09-30', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-05-1748576-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('EDUARDO ARAUZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-05-1748576-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-30', '2026-09-30', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-05-1748576-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-05-1748576-1', 
    'EDUARDO ARAUZ', 
    v_insurer_id, 
    v_broker_id,
    17.22,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'stheysi1725@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 627/692: 04-72-2018887-0 - ESTHER BARRIOS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 628)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'stheysi1725@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 13.29 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-72-2018887-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-22', start_date),
      renewal_date = COALESCE('2026-09-22', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-72-2018887-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ESTHER BARRIOS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-72-2018887-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-22', '2026-09-22', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-72-2018887-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-72-2018887-0', 
    'ESTHER BARRIOS', 
    v_insurer_id, 
    v_broker_id,
    13.29,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'stheysi1725@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 628/692: 04-04-1859172-0 - ARMANDO GARCIA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 629)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'stheysi1725@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 7.92 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-1859172-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-02-25', start_date),
      renewal_date = COALESCE('2026-02-25', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-1859172-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ARMANDO GARCIA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-1859172-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-02-25', '2026-02-25', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-1859172-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-1859172-0', 
    'ARMANDO GARCIA', 
    v_insurer_id, 
    v_broker_id,
    7.92,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'stheysi1725@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 629/692: 04-05-2033735-0 - EGNY RICAURTE
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 630)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'stheysi1725@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 13.21 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-05-2033735-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-10-13', start_date),
      renewal_date = COALESCE('2026-10-13', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-05-2033735-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('EGNY RICAURTE', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-05-2033735-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-10-13', '2026-10-13', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-05-2033735-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-05-2033735-0', 
    'EGNY RICAURTE', 
    v_insurer_id, 
    v_broker_id,
    13.21,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'stheysi1725@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 630/692: 04-04-1946042-0 - YADIRA DEL CARMEN RAMOS RONER DE JIMENEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 631)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'stheysi1725@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.11 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-1946042-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-06-16', start_date),
      renewal_date = COALESCE('2026-06-16', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-1946042-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('YADIRA DEL CARMEN RAMOS RONER DE JIMENEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-1946042-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-06-16', '2026-06-16', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-1946042-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-1946042-0', 
    'YADIRA DEL CARMEN RAMOS RONER DE JIMENEZ', 
    v_insurer_id, 
    v_broker_id,
    8.11,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'stheysi1725@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 631/692: 1-30-745364 - MARTA GLORIA URUBURU RODRIGUEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 632)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'stheysi1725@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 39.25 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-30-745364'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-30-745364';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MARTA GLORIA URUBURU RODRIGUEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-30-745364', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-30-745364';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-30-745364', 
    'MARTA GLORIA URUBURU RODRIGUEZ', 
    v_insurer_id, 
    v_broker_id,
    39.25,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'stheysi1725@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 632/692: 2151194 - DAYARIZ RAQUEL VERGARA CRUZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'REGIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: REGIONAL (fila 633)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'stheysi1725@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('REGIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.02 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2151194'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2151194';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('DAYARIZ RAQUEL VERGARA CRUZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2151194', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2151194';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2151194', 
    'DAYARIZ RAQUEL VERGARA CRUZ', 
    v_insurer_id, 
    v_broker_id,
    8.02,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'stheysi1725@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 633/692: 2187901 - "VEJARANO VEGA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'MARYORIE ELIZBETH"' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: MARYORIE ELIZBETH" (fila 634)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'regional' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('MARYORIE ELIZBETH"' = 'ASSA' AND 'STHEYSI1725@GMAIL.COM' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2187901'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2187901';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('"VEJARANO VEGA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2187901', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2187901';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2187901', 
    '"VEJARANO VEGA', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', 'STHEYSI1725@GMAIL.COM',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'regional'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 634/692: 2146876 - REYNALDO EVERALDO JARAMILLO MEDINA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'REGIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: REGIONAL (fila 635)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'stheysi1725@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('REGIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 30.57 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2146876'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2146876';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('REYNALDO EVERALDO JARAMILLO MEDINA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2146876', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2146876';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2146876', 
    'REYNALDO EVERALDO JARAMILLO MEDINA', 
    v_insurer_id, 
    v_broker_id,
    30.57,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'stheysi1725@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 635/692: 60B19558 - SUJEY ESTELA SAMUDIO RODRIGUEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 636)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'sujeysamudio@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'VIDA' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.22 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '60B19558'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-10-22', start_date),
      renewal_date = COALESCE('2026-10-22', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 60B19558';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('SUJEY ESTELA SAMUDIO RODRIGUEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '60B19558', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-10-22', '2026-10-22', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 60B19558';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '60B19558', 
    'SUJEY ESTELA SAMUDIO RODRIGUEZ', 
    v_insurer_id, 
    v_broker_id,
    0.22,
    jsonb_build_object(
      'policy_type', 'VIDA',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'sujeysamudio@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 636/692: 5-4-3804 - SUJEY ESTELA SAMUDIO RODRIGUEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 637)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'sujeysamudio@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10.29 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '5-4-3804'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 5-4-3804';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('SUJEY ESTELA SAMUDIO RODRIGUEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '5-4-3804', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 5-4-3804';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '5-4-3804', 
    'SUJEY ESTELA SAMUDIO RODRIGUEZ', 
    v_insurer_id, 
    v_broker_id,
    10.29,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'sujeysamudio@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 637/692: 103238 - OSCAR MANUEL BAZAN RIBBECK
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'OPTIMA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: OPTIMA (fila 638)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'vhenriquez@hotmail.es' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('OPTIMA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 16.68 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '103238'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 103238';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('OSCAR MANUEL BAZAN RIBBECK', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '103238', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 103238';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '103238', 
    'OSCAR MANUEL BAZAN RIBBECK', 
    v_insurer_id, 
    v_broker_id,
    16.68,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'vhenriquez@hotmail.es'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 638/692: 02-48-1233223-0 - KATHIA MARIEL CIGARRUISTA CABALLERO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 639)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'vhenriquez@hotmail.es' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.51 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-48-1233223-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-48-1233223-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('KATHIA MARIEL CIGARRUISTA CABALLERO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-48-1233223-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-48-1233223-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-48-1233223-0', 
    'KATHIA MARIEL CIGARRUISTA CABALLERO', 
    v_insurer_id, 
    v_broker_id,
    8.51,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'vhenriquez@hotmail.es'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 639/692: 02-48-1222580-0 - KATHIA MARIEL CIGARRUISTA CABALLERO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 640)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'vhenriquez@hotmail.es' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.38 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-48-1222580-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-48-1222580-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('KATHIA MARIEL CIGARRUISTA CABALLERO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-48-1222580-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-48-1222580-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-48-1222580-0', 
    'KATHIA MARIEL CIGARRUISTA CABALLERO', 
    v_insurer_id, 
    v_broker_id,
    11.38,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'vhenriquez@hotmail.es'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 640/692: 02-48-1222580-0 - KATHIA MARIEL CIGARRUISTA CABALLERO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 641)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'vhenriquez@hotmail.es' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.38 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-48-1222580-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-48-1222580-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('KATHIA MARIEL CIGARRUISTA CABALLERO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-48-1222580-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-48-1222580-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-48-1222580-0', 
    'KATHIA MARIEL CIGARRUISTA CABALLERO', 
    v_insurer_id, 
    v_broker_id,
    11.38,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'vhenriquez@hotmail.es'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 641/692: 02B3391804 - RENE LUIS LINARES ATENCIO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 642)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'segurosyania@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.72 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3391804'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-14', start_date),
      renewal_date = COALESCE('2026-09-14', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3391804';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('RENE LUIS LINARES ATENCIO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3391804', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-14', '2026-09-14', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3391804';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3391804', 
    'RENE LUIS LINARES ATENCIO', 
    v_insurer_id, 
    v_broker_id,
    8.72,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'segurosyania@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 642/692: 0217-01572-09 - EDITH ARACELIS SALAZAR GUEVARA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 643)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'segurosyania@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 6.88 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0217-01572-09'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0217-01572-09';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('EDITH ARACELIS SALAZAR GUEVARA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0217-01572-09', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0217-01572-09';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0217-01572-09', 
    'EDITH ARACELIS SALAZAR GUEVARA', 
    v_insurer_id, 
    v_broker_id,
    6.88,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'segurosyania@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 643/692: 04-72-1692251-1 - ELBA VASQUEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 644)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'segurosyania@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 26.58 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-72-1692251-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-08-15', start_date),
      renewal_date = COALESCE('2026-08-15', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-72-1692251-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ELBA VASQUEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-72-1692251-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-08-15', '2026-08-15', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-72-1692251-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-72-1692251-1', 
    'ELBA VASQUEZ', 
    v_insurer_id, 
    v_broker_id,
    26.58,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'segurosyania@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 644/692: 2125898 - "CONSUEGRA NU�EZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'OSIRIS CAROLA"' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: OSIRIS CAROLA" (fila 645)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'regional' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('OSIRIS CAROLA"' = 'ASSA' AND 'SEGUROSYANIA@GMAIL.COM' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2125898'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2125898';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('"CONSUEGRA NU�EZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2125898', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2125898';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2125898', 
    '"CONSUEGRA NU�EZ', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', 'SEGUROSYANIA@GMAIL.COM',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'regional'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 645/692: 2149297 - JENNY EDITH ORTEGA AYOLA SAENZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'REGIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: REGIONAL (fila 646)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'segurosyania@gmail.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('REGIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 7.94 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2149297'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2149297';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JENNY EDITH ORTEGA AYOLA SAENZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2149297', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2149297';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2149297', 
    'JENNY EDITH ORTEGA AYOLA SAENZ', 
    v_insurer_id, 
    v_broker_id,
    7.94,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'segurosyania@gmail.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 646/692: 2153396 - "ZUNIGA OTERO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'RICARDO ANTONIO"' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: RICARDO ANTONIO" (fila 647)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'regional' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('RICARDO ANTONIO"' = 'ASSA' AND 'SEGUROSYANIA@GMAIL.COM' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2153396'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2153396';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('"ZUNIGA OTERO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2153396', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2153396';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2153396', 
    '"ZUNIGA OTERO', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', 'SEGUROSYANIA@GMAIL.COM',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'regional'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 647/692: 2153396 - "ZUNIGA OTERO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'RICARDO ANTONIO"' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: RICARDO ANTONIO" (fila 648)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'regional' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('RICARDO ANTONIO"' = 'ASSA' AND 'SEGUROSYANIA@GMAIL.COM' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2153396'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2153396';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('"ZUNIGA OTERO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2153396', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2153396';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2153396', 
    '"ZUNIGA OTERO', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', 'SEGUROSYANIA@GMAIL.COM',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'regional'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 648/692: 2153396 - "ZUNIGA OTERO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'RICARDO ANTONIO"' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: RICARDO ANTONIO" (fila 649)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'regional' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('RICARDO ANTONIO"' = 'ASSA' AND 'SEGUROSYANIA@GMAIL.COM' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2153396'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2153396';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('"ZUNIGA OTERO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2153396', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2153396';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2153396', 
    '"ZUNIGA OTERO', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', 'SEGUROSYANIA@GMAIL.COM',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'regional'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 649/692: 02B3403553 - KATHERIN LISBETH CAMARGO ZUNIGA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 650)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yanitzajustiniani@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.03 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3403553'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-02-01', start_date),
      renewal_date = COALESCE('2026-02-01', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3403553';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('KATHERIN LISBETH CAMARGO ZUNIGA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3403553', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-02-01', '2026-02-01', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3403553';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3403553', 
    'KATHERIN LISBETH CAMARGO ZUNIGA', 
    v_insurer_id, 
    v_broker_id,
    11.03,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yanitzajustiniani@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 650/692: 02B3396599 - ROSANA SANCHEZ SALAS DE JUSTINIANI
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 651)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yanitzajustiniani@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 12.66 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3396599'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-09', start_date),
      renewal_date = COALESCE('2026-11-09', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3396599';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ROSANA SANCHEZ SALAS DE JUSTINIANI', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3396599', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-09', '2026-11-09', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3396599';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3396599', 
    'ROSANA SANCHEZ SALAS DE JUSTINIANI', 
    v_insurer_id, 
    v_broker_id,
    12.66,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yanitzajustiniani@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 651/692: 02B3377558 - KEIDYS YASIEL QUINTERO SANCHEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 652)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yanitzajustiniani@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.81 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3377558'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-03-13', start_date),
      renewal_date = COALESCE('2026-03-13', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3377558';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('KEIDYS YASIEL QUINTERO SANCHEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3377558', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-03-13', '2026-03-13', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3377558';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3377558', 
    'KEIDYS YASIEL QUINTERO SANCHEZ', 
    v_insurer_id, 
    v_broker_id,
    11.81,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yanitzajustiniani@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 652/692: 02B3399131 - NINOSKA MAYERLINE VALENCIA GONZALEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 653)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yanitzajustiniani@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.99 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3399131'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2024-12-13', start_date),
      renewal_date = COALESCE('2025-12-13', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3399131';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('NINOSKA MAYERLINE VALENCIA GONZALEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3399131', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2024-12-13', '2025-12-13', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3399131';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3399131', 
    'NINOSKA MAYERLINE VALENCIA GONZALEZ', 
    v_insurer_id, 
    v_broker_id,
    9.99,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yanitzajustiniani@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 653/692: 02B3424189 - MEL ADRIANA GARCERAN REYES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 654)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yanitzajustiniani@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 14.64 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3424189'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-09', start_date),
      renewal_date = COALESCE('2026-09-09', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3424189';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MEL ADRIANA GARCERAN REYES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3424189', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-09', '2026-09-09', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3424189';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3424189', 
    'MEL ADRIANA GARCERAN REYES', 
    v_insurer_id, 
    v_broker_id,
    14.64,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yanitzajustiniani@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 654/692: 02BR2925186 - ELADIO CAMPOS CHAVEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 655)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yanitzajustiniani@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 17.45 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02BR2925186'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-10-02', start_date),
      renewal_date = COALESCE('2026-10-02', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02BR2925186';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ELADIO CAMPOS CHAVEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02BR2925186', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-10-02', '2026-10-02', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02BR2925186';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02BR2925186', 
    'ELADIO CAMPOS CHAVEZ', 
    v_insurer_id, 
    v_broker_id,
    17.45,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yanitzajustiniani@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 655/692: 0221-01529-01 - ITZA ITZEL CARRERA RIVAS DE SANTOS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 656)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yanitzajustiniani@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10.34 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0221-01529-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0221-01529-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ITZA ITZEL CARRERA RIVAS DE SANTOS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0221-01529-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0221-01529-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0221-01529-01', 
    'ITZA ITZEL CARRERA RIVAS DE SANTOS', 
    v_insurer_id, 
    v_broker_id,
    10.34,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yanitzajustiniani@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 656/692: 0223-10164-09 - CESAR AUGUSTO ORTIZ ESTRADA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 657)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yanitzajustiniani@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 12.34 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0223-10164-09'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0223-10164-09';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('CESAR AUGUSTO ORTIZ ESTRADA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0223-10164-09', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0223-10164-09';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0223-10164-09', 
    'CESAR AUGUSTO ORTIZ ESTRADA', 
    v_insurer_id, 
    v_broker_id,
    12.34,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yanitzajustiniani@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 657/692: 0223-03134-01 - GABRIEL ANTONIO CAMPINES PINEDA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 658)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yanitzajustiniani@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 16.07 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0223-03134-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0223-03134-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('GABRIEL ANTONIO CAMPINES PINEDA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0223-03134-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0223-03134-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0223-03134-01', 
    'GABRIEL ANTONIO CAMPINES PINEDA', 
    v_insurer_id, 
    v_broker_id,
    16.07,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yanitzajustiniani@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 658/692: 0223-03135-01 - GABRIEL ANTONIO CAMPINES PINEDA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 659)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yanitzajustiniani@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 12.6 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0223-03135-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0223-03135-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('GABRIEL ANTONIO CAMPINES PINEDA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0223-03135-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0223-03135-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0223-03135-01', 
    'GABRIEL ANTONIO CAMPINES PINEDA', 
    v_insurer_id, 
    v_broker_id,
    12.6,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yanitzajustiniani@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 659/692: 0221-01517-01 - ITZA ITZEL CARRERA RIVAS DE SANTOS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 660)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yanitzajustiniani@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 10.34 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0221-01517-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0221-01517-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ITZA ITZEL CARRERA RIVAS DE SANTOS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0221-01517-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0221-01517-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0221-01517-01', 
    'ITZA ITZEL CARRERA RIVAS DE SANTOS', 
    v_insurer_id, 
    v_broker_id,
    10.34,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yanitzajustiniani@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 660/692: 0224-00931-01 - EDBERTO ANTONIO NIETO CARRERA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 661)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yanitzajustiniani@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.99 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0224-00931-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0224-00931-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('EDBERTO ANTONIO NIETO CARRERA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0224-00931-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0224-00931-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0224-00931-01', 
    'EDBERTO ANTONIO NIETO CARRERA', 
    v_insurer_id, 
    v_broker_id,
    9.99,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yanitzajustiniani@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 661/692: 1923-00200-01 - ARTURO ANTONIO JUSTINIANI CASTILLO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 662)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yanitzajustiniani@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 1.18 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1923-00200-01'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1923-00200-01';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ARTURO ANTONIO JUSTINIANI CASTILLO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1923-00200-01', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1923-00200-01';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1923-00200-01', 
    'ARTURO ANTONIO JUSTINIANI CASTILLO', 
    v_insurer_id, 
    v_broker_id,
    1.18,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yanitzajustiniani@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 662/692: 04-05-1744774-1 - ERIC BRIAS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 663)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yanitzajustiniani@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 28.3 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-05-1744774-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-26', start_date),
      renewal_date = COALESCE('2026-09-26', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-05-1744774-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ERIC BRIAS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-05-1744774-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-26', '2026-09-26', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-05-1744774-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-05-1744774-1', 
    'ERIC BRIAS', 
    v_insurer_id, 
    v_broker_id,
    28.3,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yanitzajustiniani@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 663/692: 04-05-1777673-1 - NULMIS JANETH MIRANDA GONZALEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 664)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yanitzajustiniani@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 28.3 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-05-1777673-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-10', start_date),
      renewal_date = COALESCE('2026-11-10', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-05-1777673-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('NULMIS JANETH MIRANDA GONZALEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-05-1777673-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-10', '2026-11-10', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-05-1777673-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-05-1777673-1', 
    'NULMIS JANETH MIRANDA GONZALEZ', 
    v_insurer_id, 
    v_broker_id,
    28.3,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yanitzajustiniani@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 664/692: 04-05-2052121-0 - ARIEL PEREA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 665)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yanitzajustiniani@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 17.23 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-05-2052121-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-07', start_date),
      renewal_date = COALESCE('2026-11-07', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-05-2052121-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ARIEL PEREA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-05-2052121-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-07', '2026-11-07', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-05-2052121-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-05-2052121-0', 
    'ARIEL PEREA', 
    v_insurer_id, 
    v_broker_id,
    17.23,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yanitzajustiniani@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 665/692: 04-04-1201929-3 - SAMIR QUINTERO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 666)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yanitzajustiniani@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := -5.93 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-1201929-3'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-08-08', start_date),
      renewal_date = COALESCE('2026-08-08', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-1201929-3';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('SAMIR QUINTERO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-1201929-3', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-08-08', '2026-08-08', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-1201929-3';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-1201929-3', 
    'SAMIR QUINTERO', 
    v_insurer_id, 
    v_broker_id,
    -5.93,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yanitzajustiniani@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 666/692: 04-72-1777669-1 - GABRIEL A�INO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 667)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yanitzajustiniani@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 15.66 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-72-1777669-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-11', start_date),
      renewal_date = COALESCE('2026-11-11', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-72-1777669-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('GABRIEL A�INO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-72-1777669-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-11', '2026-11-11', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-72-1777669-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-72-1777669-1', 
    'GABRIEL A�INO', 
    v_insurer_id, 
    v_broker_id,
    15.66,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yanitzajustiniani@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 667/692: 06-72-1777671-1 - GABRIEL A�INO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 668)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yanitzajustiniani@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 3.9 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '06-72-1777671-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-11', start_date),
      renewal_date = COALESCE('2026-11-11', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 06-72-1777671-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('GABRIEL A�INO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '06-72-1777671-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-11', '2026-11-11', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 06-72-1777671-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '06-72-1777671-1', 
    'GABRIEL A�INO', 
    v_insurer_id, 
    v_broker_id,
    3.9,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yanitzajustiniani@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 668/692: 04-18-1395561-2 - ANA BALLESTA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 669)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yanitzajustiniani@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.23 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-18-1395561-2'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-06-20', start_date),
      renewal_date = COALESCE('2026-06-20', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-18-1395561-2';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ANA BALLESTA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-18-1395561-2', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-06-20', '2026-06-20', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-18-1395561-2';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-18-1395561-2', 
    'ANA BALLESTA', 
    v_insurer_id, 
    v_broker_id,
    9.23,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yanitzajustiniani@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 669/692: 04-05-1775384-1 - SOLANGEL DOMINGUEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 670)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yanitzajustiniani@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 21.7 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-05-1775384-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-06', start_date),
      renewal_date = COALESCE('2026-11-06', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-05-1775384-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('SOLANGEL DOMINGUEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-05-1775384-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-06', '2026-11-06', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-05-1775384-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-05-1775384-1', 
    'SOLANGEL DOMINGUEZ', 
    v_insurer_id, 
    v_broker_id,
    21.7,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yanitzajustiniani@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 670/692: 06-72-1767050-1 - MAYULI BALOY
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 671)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yanitzajustiniani@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 3.9 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '06-72-1767050-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-10-31', start_date),
      renewal_date = COALESCE('2026-10-31', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 06-72-1767050-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MAYULI BALOY', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '06-72-1767050-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-10-31', '2026-10-31', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 06-72-1767050-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '06-72-1767050-1', 
    'MAYULI BALOY', 
    v_insurer_id, 
    v_broker_id,
    3.9,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yanitzajustiniani@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 671/692: 04-72-1767046-1 - MAYULI BALOY
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 672)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yanitzajustiniani@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 15.65 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-72-1767046-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-10-31', start_date),
      renewal_date = COALESCE('2026-10-31', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-72-1767046-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MAYULI BALOY', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-72-1767046-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-10-31', '2026-10-31', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-72-1767046-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-72-1767046-1', 
    'MAYULI BALOY', 
    v_insurer_id, 
    v_broker_id,
    15.65,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yanitzajustiniani@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 672/692: 04-05-2056889-0 - RICAURTE LOPEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 673)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yanitzajustiniani@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 28.3 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-05-2056889-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-17', start_date),
      renewal_date = COALESCE('2026-11-17', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-05-2056889-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('RICAURTE LOPEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-05-2056889-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-17', '2026-11-17', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-05-2056889-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-05-2056889-0', 
    'RICAURTE LOPEZ', 
    v_insurer_id, 
    v_broker_id,
    28.3,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yanitzajustiniani@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 673/692: 04-04-1740200-1 - ELMIR PERALTA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 674)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yanitzajustiniani@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 22.64 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-1740200-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-19', start_date),
      renewal_date = COALESCE('2026-09-19', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-1740200-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ELMIR PERALTA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-1740200-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-19', '2026-09-19', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-1740200-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-1740200-1', 
    'ELMIR PERALTA', 
    v_insurer_id, 
    v_broker_id,
    22.64,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yanitzajustiniani@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 674/692: 04-05-2020818-0 - DIVA ANGELINA BISHOP
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 675)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yanitzajustiniani@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 13.21 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-05-2020818-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-25', start_date),
      renewal_date = COALESCE('2026-09-25', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-05-2020818-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('DIVA ANGELINA BISHOP', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-05-2020818-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-25', '2026-09-25', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-05-2020818-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-05-2020818-0', 
    'DIVA ANGELINA BISHOP', 
    v_insurer_id, 
    v_broker_id,
    13.21,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yanitzajustiniani@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 675/692: 04-05-2013525-0 - DIANA SANTANA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 676)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yanitzajustiniani@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 13.21 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-05-2013525-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-09-15', start_date),
      renewal_date = COALESCE('2026-09-15', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-05-2013525-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('DIANA SANTANA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-05-2013525-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-09-15', '2026-09-15', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-05-2013525-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-05-2013525-0', 
    'DIANA SANTANA', 
    v_insurer_id, 
    v_broker_id,
    13.21,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yanitzajustiniani@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 676/692: 04-05-2056532-0 - EUSEBIA  RODRIGUEZ CAMARGO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 677)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yanitzajustiniani@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 28.3 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-05-2056532-0'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-19', start_date),
      renewal_date = COALESCE('2026-11-19', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-05-2056532-0';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('EUSEBIA  RODRIGUEZ CAMARGO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-05-2056532-0', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-19', '2026-11-19', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-05-2056532-0';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-05-2056532-0', 
    'EUSEBIA  RODRIGUEZ CAMARGO', 
    v_insurer_id, 
    v_broker_id,
    28.3,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yanitzajustiniani@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 677/692: 04-05-1763159-1 - KATHERINE DUTARY
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 678)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yanitzajustiniani@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 28.3 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-05-1763159-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-11-12', start_date),
      renewal_date = COALESCE('2026-11-12', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-05-1763159-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('KATHERINE DUTARY', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-05-1763159-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-11-12', '2026-11-12', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-05-1763159-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-05-1763159-1', 
    'KATHERINE DUTARY', 
    v_insurer_id, 
    v_broker_id,
    28.3,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yanitzajustiniani@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 678/692: 7-30-31022 - ZOBEIDA DIANIBETH CEDE�O QUINTERO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 679)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yanitzajustiniani@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 16.92 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '7-30-31022'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 7-30-31022';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ZOBEIDA DIANIBETH CEDE�O QUINTERO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '7-30-31022', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 7-30-31022';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '7-30-31022', 
    'ZOBEIDA DIANIBETH CEDE�O QUINTERO', 
    v_insurer_id, 
    v_broker_id,
    16.92,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yanitzajustiniani@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 679/692: 2154583 - KIARA LERILLET HERNANDEZ DE LEON
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'REGIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: REGIONAL (fila 680)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yanitzajustiniani@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('REGIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 8.5 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2154583'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2154583';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('KIARA LERILLET HERNANDEZ DE LEON', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2154583', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2154583';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2154583', 
    'KIARA LERILLET HERNANDEZ DE LEON', 
    v_insurer_id, 
    v_broker_id,
    8.5,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yanitzajustiniani@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 680/692: 2154443 - "JUSTINIANI CASTILLO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ARTURO ANTONIO"' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ARTURO ANTONIO" (fila 681)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'regional' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ARTURO ANTONIO"' = 'ASSA' AND 'YANITZAJUSTINIANI@LIDERESENSEGUROS.COM' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2154443'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2154443';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('"JUSTINIANI CASTILLO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2154443', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2154443';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2154443', 
    '"JUSTINIANI CASTILLO', 
    v_insurer_id, 
    v_broker_id,
    0,
    jsonb_build_object(
      'policy_type', 'YANITZAJUSTINIANI@LIDERESENSEGUROS.COM',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'regional'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 681/692: 2156325 - DAMARIS ISELA TORRES DE QUINTERO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'REGIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: REGIONAL (fila 682)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yanitzajustiniani@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('REGIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 9.04 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2156325'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2156325';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('DAMARIS ISELA TORRES DE QUINTERO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2156325', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2156325';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2156325', 
    'DAMARIS ISELA TORRES DE QUINTERO', 
    v_insurer_id, 
    v_broker_id,
    9.04,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yanitzajustiniani@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 682/692: 2132660 - INNAIR DEISY LACEY DE LEON
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'REGIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: REGIONAL (fila 683)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yanitzajustiniani@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('REGIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 6.83 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2132660'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2132660';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('INNAIR DEISY LACEY DE LEON', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2132660', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2132660';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2132660', 
    'INNAIR DEISY LACEY DE LEON', 
    v_insurer_id, 
    v_broker_id,
    6.83,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yanitzajustiniani@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 683/692: 02-93-1121600-1 - DAYNETH CA�IZALES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 684)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yanitzajustiniani@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 98.81 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-93-1121600-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-93-1121600-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('DAYNETH CA�IZALES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-93-1121600-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-93-1121600-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-93-1121600-1', 
    'DAYNETH CA�IZALES', 
    v_insurer_id, 
    v_broker_id,
    98.81,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yanitzajustiniani@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 684/692: 02-93-1121600-1 - DAYNETH CA�IZALES
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'SURA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: SURA (fila 685)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yanitzajustiniani@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('SURA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 5.47 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02-93-1121600-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02-93-1121600-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('DAYNETH CA�IZALES', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02-93-1121600-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02-93-1121600-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02-93-1121600-1', 
    'DAYNETH CA�IZALES', 
    v_insurer_id, 
    v_broker_id,
    5.47,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yanitzajustiniani@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 685/692: 70B36930 - MAVILYN JASIEL VALDES RODRIGUEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 686)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yiraramos@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND 'SALUD' = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 7.1 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '70B36930'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-08-23', start_date),
      renewal_date = COALESCE('2026-08-23', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 70B36930';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MAVILYN JASIEL VALDES RODRIGUEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '70B36930', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-08-23', '2026-08-23', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 70B36930';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '70B36930', 
    'MAVILYN JASIEL VALDES RODRIGUEZ', 
    v_insurer_id, 
    v_broker_id,
    7.1,
    jsonb_build_object(
      'policy_type', 'SALUD',
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yiraramos@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 686/692: 02B3388777 - MAVILYN JASIEL VALDES RODRIGUEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ASSA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ASSA (fila 687)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yiraramos@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ASSA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 11.32 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '02B3388777'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-08-07', start_date),
      renewal_date = COALESCE('2026-08-07', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 02B3388777';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MAVILYN JASIEL VALDES RODRIGUEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '02B3388777', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-08-07', '2026-08-07', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 02B3388777';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '02B3388777', 
    'MAVILYN JASIEL VALDES RODRIGUEZ', 
    v_insurer_id, 
    v_broker_id,
    11.32,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yiraramos@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 687/692: 0223-02971-09 - ERIKA MABEL QUIROZ RODRIGUEZ
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'ANCON' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: ANCON (fila 688)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yiraramos@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('ANCON' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 7.35 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '0223-02971-09'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 0223-02971-09';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('ERIKA MABEL QUIROZ RODRIGUEZ', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '0223-02971-09', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 0223-02971-09';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '0223-02971-09', 
    'ERIKA MABEL QUIROZ RODRIGUEZ', 
    v_insurer_id, 
    v_broker_id,
    7.35,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yiraramos@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 688/692: 04-04-1568727-1 - MARIO MORENO
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'FEDPA' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: FEDPA (fila 689)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yiraramos@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('FEDPA' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 6.6 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '04-04-1568727-1'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE('2025-03-02', start_date),
      renewal_date = COALESCE('2026-03-02', renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 04-04-1568727-1';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('MARIO MORENO', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '04-04-1568727-1', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      '2025-03-02', '2026-03-02', CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 04-04-1568727-1';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '04-04-1568727-1', 
    'MARIO MORENO', 
    v_insurer_id, 
    v_broker_id,
    6.6,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yiraramos@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 689/692: 1-33-212202 - YIRA ELIZABETH RAMOS ALMANZA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 690)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yiraramos@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 1.44 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-33-212202'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-33-212202';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('YIRA ELIZABETH RAMOS ALMANZA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-33-212202', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-33-212202';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-33-212202', 
    'YIRA ELIZABETH RAMOS ALMANZA', 
    v_insurer_id, 
    v_broker_id,
    1.44,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yiraramos@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 690/692: 1-34-212202 - YIRA ELIZABETH RAMOS ALMANZA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 691)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yiraramos@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.16 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-34-212202'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-34-212202';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('YIRA ELIZABETH RAMOS ALMANZA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-34-212202', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-34-212202';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-34-212202', 
    'YIRA ELIZABETH RAMOS ALMANZA', 
    v_insurer_id, 
    v_broker_id,
    0.16,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yiraramos@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 691/692: 1-1-9336 - YIRA ELIZABETH RAMOS ALMANZA
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'INTERNACIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: INTERNACIONAL (fila 692)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yiraramos@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('INTERNACIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 0.15 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '1-1-9336'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 1-1-9336';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('YIRA ELIZABETH RAMOS ALMANZA', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '1-1-9336', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 1-1-9336';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '1-1-9336', 
    'YIRA ELIZABETH RAMOS ALMANZA', 
    v_insurer_id, 
    v_broker_id,
    0.15,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yiraramos@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- FILA 692/692: 2148138 - JOSE ANGEL RODRIGUEZ RAMOS
  -- =====================================================
  
  -- Buscar aseguradora
  SELECT id INTO v_insurer_id FROM insurers WHERE UPPER(name) = 'REGIONAL' LIMIT 1;
  
  IF v_insurer_id IS NULL THEN
    RAISE WARNING 'Aseguradora no encontrada: REGIONAL (fila 693)';
  END IF;

  -- Buscar broker por email
  v_broker_id := NULL;
  SELECT id INTO v_broker_id FROM brokers WHERE LOWER(email) = 'yiraramos@lideresenseguros.com' LIMIT 1;
  
  -- Determinar porcentaje
  v_is_vida_assa := ('REGIONAL' = 'ASSA' AND NULL = 'VIDA');
  
  IF v_is_vida_assa THEN
    v_percentage := 1.0; -- 100% para VIDA en ASSA
  ELSIF v_broker_id IS NOT NULL THEN
    SELECT percent_default INTO v_percentage FROM brokers WHERE id = v_broker_id;
  ELSE
    v_percentage := 0; -- Sin broker = 0%
  END IF;
  
  v_net_amount := 2.83 * v_percentage;

  -- Buscar póliza existente
  SELECT id, client_id INTO v_policy_id, v_client_id 
  FROM policies 
  WHERE policy_number = '2148138'
  LIMIT 1;

  IF v_policy_id IS NOT NULL THEN
    -- Póliza existe: actualizar
    UPDATE policies SET
      broker_id = COALESCE(v_broker_id, broker_id),
      insurer_id = COALESCE(v_insurer_id, insurer_id),
      start_date = COALESCE(NULL, start_date),
      renewal_date = COALESCE(NULL, renewal_date),
      percent_override = CASE WHEN v_is_vida_assa THEN 1.0 ELSE percent_override END
    WHERE id = v_policy_id;
    
    RAISE NOTICE 'Póliza actualizada: 2148138';
  ELSE
    -- Póliza NO existe: crear cliente y póliza
    
    -- Crear cliente
    INSERT INTO clients (name, broker_id, active, created_at)
    VALUES ('JOSE ANGEL RODRIGUEZ RAMOS', COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), true, NOW())
    RETURNING id INTO v_client_id;
    
    -- Crear póliza
    INSERT INTO policies (
      policy_number, client_id, broker_id, insurer_id, 
      start_date, renewal_date, percent_override, status, created_at
    )
    VALUES (
      '2148138', v_client_id, COALESCE(v_broker_id, (SELECT id FROM brokers LIMIT 1)), v_insurer_id,
      NULL, NULL, CASE WHEN v_is_vida_assa THEN 1.0 ELSE NULL END, 'ACTIVA', NOW()
    )
    RETURNING id INTO v_policy_id;
    
    RAISE NOTICE 'Cliente y póliza creados: 2148138';
  END IF;

  -- Crear comm_item
  INSERT INTO comm_items (
    import_id, policy_number, insured_name, insurer_id, broker_id, gross_amount, raw_row, created_at
  )
  VALUES (
    v_import_id, 
    '2148138', 
    'JOSE ANGEL RODRIGUEZ RAMOS', 
    v_insurer_id, 
    v_broker_id,
    2.83,
    jsonb_build_object(
      'policy_type', NULL,
      'percentage_applied', v_percentage,
      'net_amount', v_net_amount,
      'is_vida_assa', v_is_vida_assa,
      'broker_email', 'yiraramos@lideresenseguros.com'
    ),
    NOW()
  );

  -- =====================================================
  -- 3. ACTUALIZAR FORTNIGHT_BROKER_TOTALS
  -- =====================================================
  
  -- Insertar o actualizar totales por broker
  INSERT INTO fortnight_broker_totals (fortnight_id, broker_id, gross_amount, net_amount, discounts_json, created_at)
  SELECT 
    v_fortnight_id,
    ci.broker_id,
    SUM(ci.gross_amount),
    SUM((ci.raw_row->>'net_amount')::NUMERIC),
    '{}'::jsonb,
    NOW()
  FROM comm_items ci
  WHERE ci.import_id = v_import_id
    AND ci.broker_id IS NOT NULL
  GROUP BY ci.broker_id
  ON CONFLICT (fortnight_id, broker_id) 
  DO UPDATE SET
    gross_amount = EXCLUDED.gross_amount,
    net_amount = EXCLUDED.net_amount;

  -- =====================================================
  -- RESUMEN
  -- =====================================================
  
  RAISE NOTICE '========================================';
  RAISE NOTICE 'BULK UPLOAD COMPLETADO';
  RAISE NOTICE '========================================';
  RAISE NOTICE 'Quincena ID: %', v_fortnight_id;
  RAISE NOTICE 'Import ID: %', v_import_id;
  RAISE NOTICE 'Total comisiones: 692';
  RAISE NOTICE '========================================';
  
  -- Mostrar resumen por broker
  FOR v_broker_id IN 
    SELECT DISTINCT broker_id FROM comm_items WHERE import_id = v_import_id AND broker_id IS NOT NULL
  LOOP
    RAISE NOTICE 'Broker ID: % | Comisiones: % | Neto: %',
      v_broker_id,
      (SELECT COUNT(*) FROM comm_items WHERE import_id = v_import_id AND broker_id = v_broker_id),
      (SELECT SUM((raw_row->>'net_amount')::NUMERIC) FROM comm_items WHERE import_id = v_import_id AND broker_id = v_broker_id);
  END LOOP;
  
  -- Sin identificar
  RAISE NOTICE 'Sin identificar: %', (SELECT COUNT(*) FROM comm_items WHERE import_id = v_import_id AND broker_id IS NULL);

END $$;

COMMIT;

-- =====================================================
-- VERIFICACIÓN
-- =====================================================

-- Ver quincena creada
SELECT * FROM fortnights WHERE period_start = '2025-11-01' AND period_end = '2025-11-15';

-- Ver totales por broker
SELECT 
  b.name,
  fbt.gross_amount,
  fbt.net_amount,
  (SELECT COUNT(*) FROM comm_items ci WHERE ci.broker_id = b.id AND ci.import_id IN (SELECT id FROM comm_imports WHERE period_label IN (SELECT id FROM fortnights WHERE period_start = '2025-11-01'))) as num_comisiones
FROM fortnight_broker_totals fbt
JOIN brokers b ON b.id = fbt.broker_id
WHERE fbt.fortnight_id IN (SELECT id FROM fortnights WHERE period_start = '2025-11-01')
ORDER BY fbt.net_amount DESC;

-- Ver comisiones sin identificar
SELECT policy_number, insured_name, gross_amount
FROM comm_items
WHERE broker_id IS NULL
  AND import_id IN (SELECT id FROM comm_imports WHERE period_label IN (SELECT id FROM fortnights WHERE period_start = '2025-11-01'))
LIMIT 20;
